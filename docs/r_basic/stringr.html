<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>R语言学习笔记：从数据清洗到高级统计学和生物信息学 - 基于stringr的字符串处理</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../r_basic/regular_expressions.html" rel="next">
<link href="../r_basic/vector_transform.html" rel="prev">
<link href="../images/logo.jpg" rel="icon" type="image/jpeg">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G2HZEXHNCE"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-G2HZEXHNCE', { 'anonymize_ip': true});
</script><script type="application/json" class="js-hypothesis-config">
{
  "theme": "classic",
  "openSidebar": false,
  "showHighlights": "always",
  "enableExperimentalNewNoteButton": true
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<meta property="og:title" content="R语言学习笔记：从数据清洗到高级统计学和生物信息学 - 基于stringr的字符串处理">
<meta property="og:description" content="">
<meta property="og:site_name" content="R语言学习笔记：从数据清洗到高级统计学和生物信息学">
<meta name="twitter:title" content="R语言学习笔记：从数据清洗到高级统计学和生物信息学 - 基于stringr的字符串处理">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../images/logo.jpg" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">R语言学习笔记</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../r_basic/r_basics.html"> 
<span class="menu-text">R语言基础</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">单细胞数据分析</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">
<li>
    <a class="dropdown-item" href="../single_cell/single_cell_intro.html">
 <span class="dropdown-text">单细胞数据分析介绍</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../single_cell/seurat/seurat_intro.html">
 <span class="dropdown-text">Seurat v5官方文档</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../single_cell/scRNA-seq_online/00_intro.html">
 <span class="dropdown-text">scRNA-seq_online学习材料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../single_cell/sc_supplementary/sc_supplementary_intro.html">
 <span class="dropdown-text">单细胞补充内容</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../quarto_foundation/quarto_foundation.html"> 
<span class="menu-text">Quarto基础</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="https://bookdown.org"> <i class="bi bi-book-fill" role="img">
</i> 
<span class="menu-text">Bookdown</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/djhcod/r-notes" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../r_basic/r_basics.html">R语言基础</a></li><li class="breadcrumb-item"><a href="../r_basic/stringr.html">基于stringr的字符串处理</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">主页</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../r_basic/r_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R语言基础</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/environment_configuration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rstudio环境配置</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/data_input_output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据的读取与输出</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/basic_data_function.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据处理基本函数</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基于dplyr包的数据整理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/tidyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基于tidyr的长/宽数据转换</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/vector_transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">不同类型向量的处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/stringr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">基于stringr的字符串处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/regular_expressions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">正则表达式</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/loop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">循环</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../r_basic/data_visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据可视化</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../single_cell/single_cell_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞数据分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞测序技术介绍</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/generation_of_count_matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞RNA测序—从raw data到count matrix</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../single_cell/seurat/seurat_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat v5官方文档</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/seurat_command_list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat常用函数清单</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/seurat_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat细胞分群官方教程</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/data_visualization_methods_in_seurat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat中的数据可视化方法</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/sctransform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基于SCTransform的单细胞数据标准化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/cell_cycle_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">消除细胞周期的影响</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">整合（integration）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/integrative_analysis_in_seurat_v5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat v5单细胞数据整合分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/marker_gene_identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">寻找marker gene</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/de_vignette.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">寻找不同样本类型间同一细胞类型内的差异基因</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/seurat/mapping_and_annotating_query_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基于参考集的细胞注释</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../single_cell/scRNA-seq_online/00_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">scRNA-seq_online学习材料</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/03_SC_quality_control-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据导入与Seurat对象构建</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/04_SC_quality_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">质控</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/postQC_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Single-cell RNA-seq Clustering Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/05_theory_of_PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PCA原理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/06_SC_SCT_normalization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normalization and regressing out unwanted variation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/06_integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞数据整合（Integration）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/07_SC_clustering_cells_SCT.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">细胞聚类（clustering analysis）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/08_SC_clustering_quality_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">细胞分群质量评估</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/scRNA-seq_online/09_merged_SC_marker_identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">寻找marker基因+细胞注释</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../single_cell/sc_supplementary/sc_supplementary_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞补充内容</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/sc_supplementary/read_sc_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">读取非标准格式的单细胞数据</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/sc_supplementary/universal_marker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">细胞分群通用marker</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/sc_supplementary/integrated_analysis_multiple_single_cell_datasets_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">多个单细胞数据集整合分析（上）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/sc_supplementary/integrated_analysis_multiple_single_cell_datasets_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">多个单细胞数据集整合分析（下）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../single_cell/sc_supplementary/DecontX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">预测和去除单细胞转录组的环境游离RNA污染</span></a>
  </div>
</li>
      </ul>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../quarto_foundation/quarto_foundation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto基础</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto_foundation/yaml_settings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">YAML设置</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto_foundation/images_settings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">图片设置</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto_foundation/cross_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">交叉引用</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto_foundation/insert_other_content.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">插入其他内容</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto_foundation/quarto_shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">在Quarto中嵌入Shiny应用程序</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto_foundation/quarto_books.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Books</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quarto_foundation/github_pages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">发布到GitHub Pages</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#%E5%8A%A0%E8%BD%BD%E5%8C%85" id="toc-加载包" class="nav-link active" data-scroll-target="#%E5%8A%A0%E8%BD%BD%E5%8C%85"><span class="header-section-number">1</span> 加载包</a></li>
  <li>
<a href="#%E6%9F%A5%E6%89%BE%E5%AD%97%E7%AC%A6" id="toc-查找字符" class="nav-link" data-scroll-target="#%E6%9F%A5%E6%89%BE%E5%AD%97%E7%AC%A6"><span class="header-section-number">2</span> 查找字符</a>
  <ul class="collapse">
<li><a href="#str_dect-%E5%92%8C-str_starts" id="toc-str_dect-和-str_starts" class="nav-link" data-scroll-target="#str_dect-%E5%92%8C-str_starts"><span class="header-section-number">2.1</span> <code>str_dect()</code> 和 <code>str_starts()</code></a></li>
  <li><a href="#str_which" id="toc-str_which" class="nav-link" data-scroll-target="#str_which"><span class="header-section-number">2.2</span> <code>str_which()</code></a></li>
  <li><a href="#str_view" id="toc-str_view" class="nav-link" data-scroll-target="#str_view"><span class="header-section-number">2.3</span> <code>str_view()</code></a></li>
  </ul>
</li>
  <li>
<a href="#%E6%88%AA%E5%8F%96%E5%AD%97%E7%AC%A6" id="toc-截取字符" class="nav-link" data-scroll-target="#%E6%88%AA%E5%8F%96%E5%AD%97%E7%AC%A6"><span class="header-section-number">3</span> 截取字符</a>
  <ul class="collapse">
<li><a href="#sec-str_sub" id="toc-sec-str_sub" class="nav-link" data-scroll-target="#sec-str_sub"><span class="header-section-number">3.1</span> <code>str_sub()</code></a></li>
  <li><a href="#str_subset" id="toc-str_subset" class="nav-link" data-scroll-target="#str_subset"><span class="header-section-number">3.2</span> <code>str_subset()</code></a></li>
  </ul>
</li>
  <li>
<a href="#sec-%E6%9B%BF%E6%8D%A2%E5%AD%97%E7%AC%A6" id="toc-sec-替换字符" class="nav-link" data-scroll-target="#sec-%E6%9B%BF%E6%8D%A2%E5%AD%97%E7%AC%A6"><span class="header-section-number">4</span> 替换字符</a>
  <ul class="collapse">
<li><a href="#str_sub---value" id="toc-str_sub---value" class="nav-link" data-scroll-target="#str_sub---value"><span class="header-section-number">4.1</span> <code>str_sub() &lt;- value</code></a></li>
  <li><a href="#str_replace" id="toc-str_replace" class="nav-link" data-scroll-target="#str_replace"><span class="header-section-number">4.2</span> <code>str_replace()</code></a></li>
  <li><a href="#str_remove" id="toc-str_remove" class="nav-link" data-scroll-target="#str_remove"><span class="header-section-number">4.3</span> <code>str_remove()</code></a></li>
  <li><a href="#%E8%BD%AC%E6%8D%A2%E5%A4%A7%E5%B0%8F%E5%86%99" id="toc-转换大小写" class="nav-link" data-scroll-target="#%E8%BD%AC%E6%8D%A2%E5%A4%A7%E5%B0%8F%E5%86%99"><span class="header-section-number">4.4</span> 转换大小写</a></li>
  </ul>
</li>
  <li>
<a href="#sec-%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2" id="toc-sec-拼接字符串" class="nav-link" data-scroll-target="#sec-%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="header-section-number">5</span> 拼接字符</a>
  <ul class="collapse">
<li><a href="#str_c" id="toc-str_c" class="nav-link" data-scroll-target="#str_c"><span class="header-section-number">5.1</span> <code>str_c()</code></a></li>
  <li>
<a href="#str_glue-%E5%92%8C-str_glu_data" id="toc-str_glue-和-str_glu_data" class="nav-link" data-scroll-target="#str_glue-%E5%92%8C-str_glu_data"><span class="header-section-number">5.2</span> <code>str_glue()</code> 和 <code>str_glu_data()</code></a>
  <ul class="collapse">
<li><a href="#str_glue_data" id="toc-str_glue_data" class="nav-link" data-scroll-target="#str_glue_data"><span class="header-section-number">5.2.1</span> <code>str_glue_data()</code></a></li>
  </ul>
</li>
  <li><a href="#str_flatten" id="toc-str_flatten" class="nav-link" data-scroll-target="#str_flatten"><span class="header-section-number">5.3</span> <code>str_flatten()</code></a></li>
  </ul>
</li>
  <li>
<a href="#%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6" id="toc-分割字符" class="nav-link" data-scroll-target="#%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6"><span class="header-section-number">6</span> 分割字符</a>
  <ul class="collapse">
<li>
<a href="#sec-%E5%AD%97%E7%AC%A6%E5%88%97%E7%9A%84%E5%88%86%E5%89%B2" id="toc-sec-字符列的分割" class="nav-link" data-scroll-target="#sec-%E5%AD%97%E7%AC%A6%E5%88%97%E7%9A%84%E5%88%86%E5%89%B2"><span class="header-section-number">6.1</span> 字符列的分割</a>
  <ul class="collapse">
<li><a href="#separate_wider_delim" id="toc-separate_wider_delim" class="nav-link" data-scroll-target="#separate_wider_delim"><span class="header-section-number">6.1.1</span> <code>separate_wider_delim()</code></a></li>
  <li><a href="#separate_wider_regex" id="toc-separate_wider_regex" class="nav-link" data-scroll-target="#separate_wider_regex"><span class="header-section-number">6.1.2</span> <code>separate_wider_regex()</code></a></li>
  <li><a href="#separate_wider_position" id="toc-separate_wider_position" class="nav-link" data-scroll-target="#separate_wider_position"><span class="header-section-number">6.1.3</span> <code>separate_wider_position()</code></a></li>
  <li><a href="#%E6%8B%86%E5%88%86%E9%94%99%E8%AF%AF%E8%B0%83%E8%AF%95" id="toc-拆分错误调试" class="nav-link" data-scroll-target="#%E6%8B%86%E5%88%86%E9%94%99%E8%AF%AF%E8%B0%83%E8%AF%95"><span class="header-section-number">6.1.4</span> 拆分错误调试</a></li>
  </ul>
</li>
  </ul>
</li>
  <li><a href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E7%AC%A6%E9%95%BF%E5%BA%A6" id="toc-计算字符长度" class="nav-link" data-scroll-target="#%E8%AE%A1%E7%AE%97%E5%AD%97%E7%AC%A6%E9%95%BF%E5%BA%A6"><span class="header-section-number">7</span> 计算字符长度</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/djhcod/r-notes/blob/main/r_basic/stringr.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/djhcod/r-notes/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../r_basic/r_basics.html">R语言基础</a></li><li class="breadcrumb-item"><a href="../r_basic/stringr.html">基于stringr的字符串处理</a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">基于stringr的字符串处理</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><blockquote class="blockquote">
<p>参考：<a href="https://r4ds.hadley.nz/strings" class="uri">https://r4ds.hadley.nz/strings</a></p>
</blockquote>
<p><a href="https://stringr.tidyverse.org"><img src="images/logo-2-01.png" class="img-fluid" width="145"></a></p>
<p>本章主要介绍基于 <a href="https://stringr.tidyverse.org"><code>stringr</code> 包</a>的字符串和字符向量的处理。我们需要记住 <code>stringr</code> 中用于字符串处理的函数大多都以&nbsp;<code>str_</code>&nbsp;开头，这样我们在 RStudio 通过键入&nbsp;<code>str_</code>&nbsp;就能方便的浏览并选择我们需要的函数：</p>
<p><img src="images/stringr-autocomplete.png" class="img-fluid" width="643"></p>
<p>和字符处理密切相关的一个内容是<strong>正则表达式（regular expressions）</strong>，由于这一部分内容较多，我们将在<a href="../r_basic/regular_expressions.html">下一章</a>介绍。</p>
<section id="加载包" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> 加载包</h1>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames">babynames</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>本章用到的案例数据集“babynames”记录了美国婴儿的姓名分布数据。</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">babynames</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,924,665 × 5
    year sex   name          n   prop
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
 1  1880 F     Mary       7065 0.0724
 2  1880 F     Anna       2604 0.0267
 3  1880 F     Emma       2003 0.0205
 4  1880 F     Elizabeth  1939 0.0199
 5  1880 F     Minnie     1746 0.0179
 6  1880 F     Margaret   1578 0.0162
 7  1880 F     Ida        1472 0.0151
 8  1880 F     Alice      1414 0.0145
 9  1880 F     Bertha     1320 0.0135
10  1880 F     Sarah      1288 0.0132
# ℹ 1,924,655 more rows</code></pre>
</div>
</div>
</section><section id="查找字符" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> 查找字符</h1>
<p>下面是 <code>stringr</code> 包中用于查找字符的函数，它们接受<strong>字符向量</strong>输入，常常和<strong>正则表达式</strong>配合使用：</p>
<p><img src="images/截屏2024-03-07 17.24.08.png" class="img-fluid" width="474"></p>
<section id="str_dect-和-str_starts" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="str_dect-和-str_starts">
<span class="header-section-number">2.1</span> <code>str_dect()</code> 和 <code>str_starts()</code>
</h2>
<p><code>str_dect(string, pattern)</code> 查找 <code>string</code> 中是否有包含目标字符 <code>pattern</code> 的对象，<strong>返回一个逻辑向量</strong>。<code>str_starts(string, pattern)</code> 查找 <code>string</code> 中是否有<strong>开头</strong>为目标字符 <code>pattern</code> 的对象。</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">names</span> <span class="op">&lt;-</span> <span class="va">babynames</span><span class="op">$</span><span class="va">name</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="va">names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Mary"      "Anna"      "Emma"      "Elizabeth" "Minnie"    "Margaret" 
 [7] "Ida"       "Alice"     "Bertha"    "Sarah"    </code></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 查找“names”中是否有以“M”开头的对象</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">names</span>, <span class="st">"^M"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 也可以用str_starts()</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html">str_starts</a></span><span class="op">(</span><span class="va">names</span>, <span class="st">"M"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>【练习】统计每年有多少名婴儿的名字中包含了“x”，并用折线图可视化这些婴儿每年的占比情况：</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">babynames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x_count <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"x"</span><span class="op">)</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>prop_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x_count</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">prop_x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="stringr_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="str_which" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="str_which">
<span class="header-section-number">2.2</span> <code>str_which()</code>
</h2>
<p><code>str_which(string, pattern)</code> 查找 <code>string</code> 中是否有包含目标字符 <code>pattern</code> 的对象，<strong>返回匹配到的对象的位置</strong>。</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_which.html">str_which</a></span><span class="op">(</span><span class="va">names</span>, <span class="st">"^M"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 5 6</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>stringr</code> 包的字符查找函数中的 <code>pattern</code> 是要区分大小写的，也意味着这些函数在查找时会区分大小写。</p>
<p>上述函数都可以添加一个 <code>negate = TRUE</code> 参数，表示查找没有包含目标字符的对象，如：</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">names</span>, <span class="st">"^M"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_which.html">str_which</a></span><span class="op">(</span><span class="va">names</span>, <span class="st">"^M"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  3  4  7  8  9 10</code></pre>
</div>
</div>
</div>
</div>
</section><section id="str_view" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="str_view">
<span class="header-section-number">2.3</span> <code>str_view()</code>
</h2>
<p><img src="images/截屏2024-03-10 10.44.21.png" class="img-fluid" width="463"></p>
<p><code>str_view(string, pattern)</code> 是一个比较特殊的字符查找函数，它返回的结果以HTML渲染样式来返回 <code>string</code> 中所有匹配的字符，并且<strong>会将其中的 <code>pattern</code> 以“&lt;&gt;”标记出来</strong>：</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html">str_view</a></span><span class="op">(</span><span class="va">names</span>, <span class="st">"^M"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] │ &lt;M&gt;ary
[5] │ &lt;M&gt;innie
[6] │ &lt;M&gt;argaret</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>base</code> 包中的字符查找函数
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<section id="in" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="in">
<span class="header-section-number">2.3.1</span> <strong><code>%in%</code></strong>
</h3>
<p>查找字符向量中是否有<strong>任何</strong>目标字符串。它会把每个字符串当成判断的最小单位，即<strong>完全匹配</strong>，所以不能用来判断/查找”长字符串中是否含有特定的短字符串”。例如：</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">places</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"中国四川"</span>,<span class="st">"中国北京"</span>,<span class="st">"中国安徽"</span>,<span class="st">"北京天安门"</span><span class="op">)</span></span>
<span><span class="st">"中国四川"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">"中国"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">places</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
</section><section id="grep函数" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="grep函数">
<span class="header-section-number">2.3.2</span> <strong><code>grep()</code>函数</strong>
</h3>
<p>grep 的全称是“global search regular expression and print out the line”，类似于 <code>stringr</code> 包中的 <code><a href="https://stringr.tidyverse.org/reference/str_which.html">str_which()</a></code> ，返回匹配到的目标字符的位置。当添加了 <code>value = TRUE</code> 参数时，类似于 <code><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset()</a></code> 函数（见<a href="#sec-str_sub">下文</a>），返回包含目标字符的所有对象。</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span></span>
<span>  pattern <span class="op">=</span> <span class="st">"^M"</span>, <span class="co"># 需要找找的字符</span></span>
<span>  x <span class="op">=</span> <span class="va">names</span>, <span class="co"># 从哪里查找</span></span>
<span>  ignore.case <span class="op">=</span> <span class="cn">F</span>, <span class="co"># 是否忽略大小写，默认为FALSE</span></span>
<span>  value <span class="op">=</span> <span class="cn">F</span>, <span class="co"># 默认为FALSE，表示返回匹配到的字符所在的位置；TRUE则返回查找到的值</span></span>
<span>  invert <span class="op">=</span> <span class="cn">F</span> <span class="co"># 如果为TRUE，则返回未匹配到的字符的值或位置</span></span>
<span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 5 6</code></pre>
</div>
</div>
</section><section id="grepl" class="level3" data-number="2.3.3"><h3 data-number="2.3.3" class="anchored" data-anchor-id="grepl">
<span class="header-section-number">2.3.3</span> <strong><code>grepl()</code></strong>
</h3>
<p><code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code> 类似于 <code>stringr</code> 包中的 <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> ，返回是否匹配到目标字符的逻辑向量：</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span></span>
<span>  pattern <span class="op">=</span> <span class="st">"^M"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">names</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section></section><section id="截取字符" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> 截取字符</h1>
<p><img src="images/截屏2024-03-07 18.08.32.png" class="img-fluid" width="459"></p>
<section id="sec-str_sub" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="sec-str_sub">
<span class="header-section-number">3.1</span> <code>str_sub()</code>
</h2>
<p><code>str_sub(string，start，end)</code> 用于提取指定长度和位置的字符串，其中 <code>start</code> 和 <code>end</code> 是截取字符串应该开始和结束的位置。返回的字符串的长度 = <code>end</code> - <code>start</code> + 1。<code>base</code> 包中与之对应的函数是 <code><a href="https://rdrr.io/r/base/substr.html">substr()</a></code> 。</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fruit_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A_p ple"</span>, <span class="st">" Banana"</span>, <span class="st">"Pear"</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">fruit_list</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A_p" " Ba" "Pea" NA   </code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 负号表示距末尾多少个字符截取：</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">fruit_list</span>, <span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ple" "ana" "ear" NA   </code></pre>
</div>
</div>
<p><code><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub()</a></code> 在其后方添加赋值后还可以实现对特定位置字符的替换，见<a href="#sec-%E6%9B%BF%E6%8D%A2%E5%AD%97%E7%AC%A6">下文</a>。</p>
</section><section id="str_subset" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="str_subset">
<span class="header-section-number">3.2</span> <code>str_subset()</code>
</h2>
<p><code>str_subset(string, pattern)</code> 返回 <code>string</code> 中包含 <code>pattern</code> 的所有对象。功能类似于添加了 <code>value = TRUE</code> 参数时的 <code><a href="https://rdrr.io/r/base/grep.html">grep()</a></code> 函数。</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 返回“names”中开头为“M”的对象</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span><span class="va">names</span>, <span class="st">"^M"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Mary"     "Minnie"   "Margaret"</code></pre>
</div>
</div>
</section></section><section id="sec-替换字符" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> 替换字符</h1>
<p><img src="images/截屏2024-03-07 18.37.53.png" class="img-fluid" width="499"></p>
<section id="str_sub---value" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="str_sub---value">
<span class="header-section-number">4.1</span> <code>str_sub() &lt;- value</code>
</h2>
<p>用 <code>str_sub() &lt;- value</code> 可以实现对特定位置字符的替换。例如将“fruit_list”中的第1-3位字符替换成“***”：</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="va">fruit_list</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"***"</span></span>
<span><span class="va">fruit_list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "*** ple" "***nana" "***r"    NA       </code></pre>
</div>
</div>
</section><section id="str_replace" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="str_replace">
<span class="header-section-number">4.2</span> <code>str_replace()</code>
</h2>
<ul>
<li><p><code>str_replace(string, pattern, replacement)</code> 将 <code>string</code> 中的<strong>第一个</strong> <code>pattern</code> 替换成 <code>replacement</code> 。</p></li>
<li><p><code>str_replace_all(string, pattern, replacement)</code> 将 <code>string</code> 中的<strong>所有</strong> <code>pattern</code> 替换成 <code>replacement</code> 。</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fruit_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A_p p le"</span>, <span class="st">" B anana"</span>, <span class="st">"Pear "</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 将“fruit_list”中的第一个空格替换成“#”</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">fruit_list</span>, pattern <span class="op">=</span> <span class="st">" "</span>, replacement <span class="op">=</span> <span class="st">"#"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A_p#p le" "#B anana" "Pear#"    NA        </code></pre>
</div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 将“fruit_list”中的所有空格替换成“#”</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">fruit_list</span>, pattern <span class="op">=</span> <span class="st">" "</span>, replacement <span class="op">=</span> <span class="st">"#"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A_p#p#le" "#B#anana" "Pear#"    NA        </code></pre>
</div>
</div>
</section><section id="str_remove" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="str_remove">
<span class="header-section-number">4.3</span> <code>str_remove()</code>
</h2>
<ul>
<li><p><code>str_remove(string, pattern)</code> 将 <code>string</code> 中的<strong>第一个</strong> <code>pattern</code> 删除。</p></li>
<li><p><code>str_remove_all(string, pattern)</code> 将 <code>string</code> 中的<strong>所有</strong> <code>pattern</code> 删除。</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 删除“fruit_list”中的第一个空格</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">fruit_list</span>, pattern <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A_pp le" "B anana" "Pear"    NA       </code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 删除“fruit_list”中的所有空格</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">fruit_list</span>, pattern <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A_pple" "Banana" "Pear"   NA      </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
base 包中的字符替换函数
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>在 base 包中与 <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all()</a></code> 和 <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all()</a></code> 对应的函数是 <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> ：</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fruit_list</span>, pattern <span class="op">=</span> <span class="st">" "</span>, replacement <span class="op">=</span> <span class="st">"#"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A_p#p#le" "#B#anana" "Pear#"    NA        </code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="转换大小写" class="level2" data-number="4.4"><h2 data-number="4.4" class="anchored" data-anchor-id="转换大小写">
<span class="header-section-number">4.4</span> 转换大小写</h2>
<p><img src="images/截屏2024-03-07 17.12.05.png" class="img-fluid" width="429"></p>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_upper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abc"</span>, <span class="st">"def"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ABC" "DEF"</code></pre>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_lower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ABC"</span>, <span class="st">"DEF"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "abc" "def"</code></pre>
</div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html">str_to_title</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ABC"</span>, <span class="st">"DEF"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Abc" "Def"</code></pre>
</div>
</div>
<p><code>base</code> 包中与之对应的函数是 <code><a href="https://rdrr.io/r/base/chartr.html">toupper()</a></code> 和 <code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code> 。</p>
</section></section><section id="sec-拼接字符串" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> 拼接字符</h1>
<p><img src="images/截屏2024-03-07 19.18 拷贝.jpg" class="img-fluid" width="422"></p>
<section id="str_c" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="str_c">
<span class="header-section-number">5.1</span> <code>str_c()</code>
</h2>
<p><code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 和 <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> 用于拼接字符。<code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 与 <code>base</code> 包的 <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> 的用法非常相似，但前者遵循 tidyverse 规则，不会对缺失值进行处理，能够更好的与 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> 配合使用：</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Flora"</span>, <span class="st">"David"</span>, <span class="st">"Terra"</span>, <span class="cn">NA</span>, <span class="st">"Eric"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>greeting <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"Hi "</span>, <span class="va">name</span>, <span class="st">"!"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  name  greeting 
  &lt;chr&gt; &lt;chr&gt;    
1 Flora Hi Flora!
2 David Hi David!
3 Terra Hi Terra!
4 &lt;NA&gt;  &lt;NA&gt;     
5 Eric  Hi Eric! 
6 &lt;NA&gt;  &lt;NA&gt;     </code></pre>
</div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 用paste0()的效果</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>greeting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Hi "</span>, <span class="va">name</span>, <span class="st">"!"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  name  greeting 
  &lt;chr&gt; &lt;chr&gt;    
1 Flora Hi Flora!
2 David Hi David!
3 Terra Hi Terra!
4 &lt;NA&gt;  Hi NA!   
5 Eric  Hi Eric! 
6 &lt;NA&gt;  Hi NA!   </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>从上面的例子中可以发现，<code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 和 <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> 的一个最重要的区别是 <strong><code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 会忽略缺失值，而 <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> 会将缺失值也作为一个字符处理。</strong></p>
</div>
</div>
<p>如果希望在遇到缺失值时以其他字符替换显示，可以使用 <code>coalesce(x, "y")</code> ，它会将x中的所有缺失值替换成“y”。根据需要，可以在 <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 内部或外部使用它：</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 演示coalesc()的作用</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">name</span>, <span class="st">"you"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Flora" "David" "Terra" "you"   "Eric"  "you"  </code></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    greeting1 <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"Hi "</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"you"</span><span class="op">)</span>, <span class="st">"!"</span><span class="op">)</span>,</span>
<span>    greeting2 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="st">"Hi "</span>, <span class="va">name</span>, <span class="st">"!"</span><span class="op">)</span>, <span class="st">"Hi someone!"</span><span class="op">)</span>, </span>
<span>    .keep <span class="op">=</span> <span class="st">"used"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  name  greeting1 greeting2  
  &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;      
1 Flora Hi Flora! Hi Flora!  
2 David Hi David! Hi David!  
3 Terra Hi Terra! Hi Terra!  
4 &lt;NA&gt;  Hi you!   Hi someone!
5 Eric  Hi Eric!  Hi Eric!   
6 &lt;NA&gt;  Hi you!   Hi someone!</code></pre>
</div>
</div>
<p>可以通过添加 <code>sep</code> 参数，以固定的分隔符分隔多个字符向量，类似于 <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> 中的 <code>sep</code> 参数（两者对待缺失值的行为不一样）：</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">16</span>, <span class="fl">20</span>, <span class="fl">18</span>, <span class="cn">NA</span>, <span class="fl">22</span><span class="op">)</span>,</span>
<span>    height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">116</span>, <span class="fl">170</span>, <span class="cn">NA</span>, <span class="fl">180</span>, <span class="cn">NA</span>, <span class="fl">177</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    combine <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"unknown"</span><span class="op">)</span>, <span class="va">age</span>, <span class="va">height</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name    age height combine       
  &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;         
1 Flora    11    116 Flora-11-116  
2 David    16    170 David-16-170  
3 Terra    20     NA &lt;NA&gt;          
4 &lt;NA&gt;     18    180 unknown-18-180
5 Eric     NA     NA &lt;NA&gt;          
6 &lt;NA&gt;     22    177 unknown-22-177</code></pre>
</div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 用paste()替换str_c()</span></span>
<span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    combine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"unknown"</span><span class="op">)</span>, <span class="va">age</span>, <span class="va">height</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name    age height combine       
  &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;         
1 Flora    11    116 Flora-11-116  
2 David    16    170 David-16-170  
3 Terra    20     NA Terra-20-NA   
4 &lt;NA&gt;     18    180 unknown-18-180
5 Eric     NA     NA Eric-NA-NA    
6 &lt;NA&gt;     22    177 unknown-22-177</code></pre>
</div>
</div>
<p>如果给 <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 只提供了<strong>一个字符向量</strong>，这个时候如果需要将该向量内的字符以固定的分隔符<strong>合并为一个字符</strong>，则需要指定 <code>collapse</code> 参数。这种情况可以和 <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> 配合使用，并且一般会使用另一个字符连接函数 <code><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten()</a></code> （见）。</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">name</span>, <span class="st">"unknown"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Flora-David-Terra-unknown-Eric-unknown"</code></pre>
</div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">name</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Flora-David-Terra-NA-Eric-NA"</code></pre>
</div>
</div>
</section><section id="str_glue-和-str_glu_data" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="str_glue-和-str_glu_data">
<span class="header-section-number">5.2</span> <code>str_glue()</code> 和 <code>str_glu_data()</code>
</h2>
<p>如果你需要将很多字符串向量和多个固定字符粘贴起来，如果这时候仍然用 <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 会让代码看上去比较混乱和难以理解。这种情况我们可以使用 <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> 来简化代码。 <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> 将需要调用的字符向量放到“{}”内，括号外可以输入任意自定义字符。</p>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    greeting <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span></span>
<span>      <span class="st">"My name is {name}, "</span>,</span>
<span>      <span class="st">"my age is {age}, "</span>,</span>
<span>      <span class="st">"my height is {height/100} meters."</span>,</span>
<span>      .na <span class="op">=</span> <span class="st">"**"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  name    age height greeting                                                 
  &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;glue&gt;                                                   
1 Flora    11    116 My name is Flora, my age is 11, my height is 1.16 meters.
2 David    16    170 My name is David, my age is 16, my height is 1.7 meters. 
3 Terra    20     NA My name is Terra, my age is 20, my height is ** meters.  
4 &lt;NA&gt;     18    180 My name is **, my age is 18, my height is 1.8 meters.    
5 Eric     NA     NA My name is Eric, my age is **, my height is ** meters.   
6 &lt;NA&gt;     22    177 My name is **, my age is 22, my height is 1.77 meters.   </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> 默认情况下会将缺失值转换为字符串 “NA”，这一点与 <code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 不一致。可以通过添加 <code>.na</code> 参数指定将缺失值替换成什么。</p>
</div>
</div>
<section id="str_glue_data" class="level3" data-number="5.2.1"><h3 data-number="5.2.1" class="anchored" data-anchor-id="str_glue_data">
<span class="header-section-number">5.2.1</span> <code>str_glue_data()</code>
</h3>
<p>如果你想脱离 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>，在一个表格中简单的通过连接几列来<strong>返回一个字符向量</strong>，那么用 <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue_data()</a></code> 可能更合适。其语法为：<code>str_glue_data(.x, ..., .sep, .na = "NA")</code> 。</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">cars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue_data</a></span><span class="op">(</span><span class="va">cars</span>, <span class="st">"{rownames(cars)} has {hp} hp"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mazda RX4 has 110 hp
Mazda RX4 Wag has 110 hp
Datsun 710 has 93 hp
Hornet 4 Drive has 110 hp
Hornet Sportabout has 175 hp
Valiant has 105 hp</code></pre>
</div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 在mutate()外使用str_glue()实现同样的目的需要反复调用数据集名称</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{rownames(cars)} has {cars$hp} hp"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mazda RX4 has 110 hp
Mazda RX4 Wag has 110 hp
Datsun 710 has 93 hp
Hornet 4 Drive has 110 hp
Hornet Sportabout has 175 hp
Valiant has 105 hp</code></pre>
</div>
</div>
</section></section><section id="str_flatten" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="str_flatten">
<span class="header-section-number">5.3</span> <code>str_flatten()</code>
</h2>
<p><code><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c()</a></code> 和 <code><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue()</a></code> 可以很好地与 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> 配合使用，因为它们的输出与输入长度相同。如果想要一个能与 <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> 完美配合的函数，即总是返回单个字符串的函数，就可以用 <code><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten()</a></code> ：它接收单个字符向量，并以固定的分隔符将向量中的每个元素合并为一个字符。</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span>, last <span class="op">=</span> <span class="st">", and "</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "x, y, and z"</code></pre>
</div>
</div>
<p>例如，统计每个人喜欢的水果，把每个人喜欢的水果用逗号连接起来：</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">name</span>, <span class="op">~</span> <span class="va">fruit</span>,</span>
<span>  <span class="st">"Carmen"</span>, <span class="st">"banana"</span>,</span>
<span>  <span class="st">"Carmen"</span>, <span class="st">"apple"</span>,</span>
<span>  <span class="st">"Marvin"</span>, <span class="st">"nectarine"</span>,</span>
<span>  <span class="st">"Terence"</span>, <span class="st">"cantaloupe"</span>,</span>
<span>  <span class="st">"Terence"</span>, <span class="st">"papaya"</span>,</span>
<span>  <span class="st">"Terence"</span>, <span class="st">"mandarin"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>fruits <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten</a></span><span class="op">(</span><span class="va">fruit</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  name    fruits                      
  &lt;chr&gt;   &lt;chr&gt;                       
1 Carmen  banana, apple               
2 Marvin  nectarine                   
3 Terence cantaloupe, papaya, mandarin</code></pre>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 也可以用str_c()并指定collapse参数</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>fruits <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span><span class="va">fruit</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  name    fruits                      
  &lt;chr&gt;   &lt;chr&gt;                       
1 Carmen  banana, apple               
2 Marvin  nectarine                   
3 Terence cantaloupe, papaya, mandarin</code></pre>
</div>
</div>
</section></section><section id="分割字符" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> 分割字符</h1>
<p><img src="images/截屏2024-03-07 20.03.28.png" class="img-fluid" width="521"></p>
<p><code>str_split(string, pattern, simplify, i)</code> 可以根据某个<strong>分割符</strong>将字符向量中的每一个对象分割成n列。其中：</p>
<ul>
<li><p><code>string</code>：待分割的字符向量。其中每个对象包含的分割符数量可以是不同的。</p></li>
<li><p><code>pattern</code>：指定分割符。</p></li>
<li><p><code>simplify</code>：默认“FALSE”，返回一个字符向量列表。设置为“TRUE”时（常用），则返回字符矩阵（character matrix）。</p></li>
</ul>
<p>可以在 <code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code> 外通过添加 <code>[x, y]</code> 来提取拆分后的指定列或行的字符。</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  fruits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"apples-oranges-pears-bananas"</span>,</span>
<span>    <span class="st">"pineapples-mangos-guavas"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">fruits</span>, <span class="st">"-"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]         [,2]      [,3]     [,4]     
[1,] "apples"     "oranges" "pears"  "bananas"
[2,] "pineapples" "mangos"  "guavas" ""       </code></pre>
</div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">fruits</span>, <span class="st">"-"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "oranges" "mangos" </code></pre>
</div>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="st">"2nd_fruit"</span> <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">fruits</span>, <span class="st">"-"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  fruits                       `2nd_fruit`
  &lt;chr&gt;                        &lt;chr&gt;      
1 apples-oranges-pears-bananas oranges    
2 pineapples-mangos-guavas     mangos     </code></pre>
</div>
</div>
<section id="sec-字符列的分割" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="sec-字符列的分割">
<span class="header-section-number">6.1</span> 字符列的分割</h2>
<p><img src="images/clipboard-4083897435.png" class="img-fluid"></p>
<p><code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_position()</a></code> 、 <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code> 以及 <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_regex()</a></code> 用于将某一列根据分割符（<code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code>）、固定宽度（<code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_position()</a></code>）或正则表达式（<code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_regex()</a></code>）拆分为多列。这些函数包括在 <a href="../r_basic/tidyr.html"><code>tidyr</code> 包</a>中，因为它们的操作对象是数据框（列），而不是单个字符向量。把这些函数中的“wider”替换成“longer”就构成了另外三个类似函数，用于将某一列根据分割符、固定宽度或正则表达式拆分为多行（不常用）。</p>
<section id="separate_wider_delim" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="separate_wider_delim">
<span class="header-section-number">6.1.1</span> <code>separate_wider_delim()</code>
</h3>
<p>将数据框中的某列根据某个符号（<code>delim</code>）拆分成几列：</p>
<div id="tbl-separate_wider_delim" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-separate_wider_delim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: 字符列的分割案例
</figcaption><div aria-describedby="tbl-separate_wider_delim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a10-1-2022"</span>, <span class="st">"b10-2-2011"</span>, <span class="st">"e15-1-2015"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  x         
  &lt;chr&gt;     
1 a10-1-2022
2 b10-2-2011
3 e15-1-2015</code></pre>
</div>
</div>
</figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df3</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"code"</span>, <span class="st">"edition"</span>, <span class="st">"year"</span><span class="op">)</span>,</span>
<span>    cols_remove <span class="op">=</span> <span class="cn">F</span> <span class="co"># 不要移除原始列</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  code  edition year  x         
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     
1 a10   1       2022  a10-1-2022
2 b10   2       2011  b10-2-2011
3 e15   1       2015  e15-1-2015</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
这个效果是否用上面的 <code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code> 也可以实现？
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>如果用上面的 <code><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split()</a></code> 实现同样目的的话需要如下代码：</p>
<div class="cell">
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    code <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">x</span>, pattern <span class="op">=</span> <span class="st">"-"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>    edition <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">x</span>, pattern <span class="op">=</span> <span class="st">"-"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">x</span>, pattern <span class="op">=</span> <span class="st">"-"</span>, simplify <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  x          code  edition year 
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
1 a10-1-2022 a10   1       2022 
2 b10-2-2011 b10   2       2011 
3 e15-1-2015 e15   1       2015 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>如果拆分后某几列的数据不需要，可以将其指定为“NA”，这样在输出结果中指定为“NA”的列将不会显示：</p>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df3</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"code"</span>, <span class="cn">NA</span>, <span class="st">"year"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  code  year 
  &lt;chr&gt; &lt;chr&gt;
1 a10   2022 
2 b10   2011 
3 e15   2015 </code></pre>
</div>
</div>
<p>在上面的 <a href="#tbl-separate_wider_delim" class="quarto-xref">Table&nbsp;1</a> 中，待分割列有<strong>固定的分隔符</strong>分隔我们想要提取的变量，这种情况用 <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code> 可以便捷的分割这些变量。但是在下面的 <a href="#tbl-separate_wider_delim_regex" class="quarto-xref">Table&nbsp;2</a> 中待分割列中的变量间由不同的分隔符分隔，这个时候我们可以<strong>通过正则表达式来定义分隔符</strong>。<code>delim</code> 参数支持通过 <code><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex()</a></code> 包装的<a href="../r_basic/regular_expressions.html">正则表达式</a>：</p>
<div id="tbl-separate_wider_delim_regex" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-separate_wider_delim_regex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: 在separate_wider_delim()中应用正则表达式
</figcaption><div aria-describedby="tbl-separate_wider_delim_regex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a10-1_2022 January"</span>, <span class="st">"b10-2_2011 February"</span>, <span class="st">"e15-1_2015 March"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  x                  
  &lt;chr&gt;              
1 a10-1_2022 January 
2 b10-2_2011 February
3 e15-1_2015 March   </code></pre>
</div>
</div>
</figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df4</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">regex</a></span><span class="op">(</span><span class="st">"-|_|\\s"</span><span class="op">)</span>, <span class="co"># 或者写成 "-|_| "</span></span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"code"</span>, <span class="st">"edition"</span>, <span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span>,</span>
<span>    cols_remove <span class="op">=</span> <span class="cn">F</span> </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  code  edition year  month    x                  
  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;              
1 a10   1       2022  January  a10-1_2022 January 
2 b10   2       2011  February b10-2_2011 February
3 e15   1       2015  March    e15-1_2015 March   </code></pre>
</div>
</div>
</section><section id="separate_wider_regex" class="level3" data-number="6.1.2"><h3 data-number="6.1.2" class="anchored" data-anchor-id="separate_wider_regex">
<span class="header-section-number">6.1.2</span> <code>separate_wider_regex()</code>
</h3>
<p><strong>根据正则表达式拆分列</strong>：</p>
<div class="cell">
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">str</span>,</span>
<span>  <span class="st">"&lt;Sheryl&gt;-F_34"</span>,</span>
<span>  <span class="st">"&lt;Kisha&gt;-F_45"</span>, </span>
<span>  <span class="st">"&lt;Brandon&gt;-N_33"</span>,</span>
<span>  <span class="st">"&lt;Sharon&gt;-F_38"</span>, </span>
<span>  <span class="st">"&lt;Penny&gt;-F_58"</span>,</span>
<span>  <span class="st">"&lt;Justin&gt;-M_41"</span>, </span>
<span>  <span class="st">"&lt;Patricia&gt;-F_84"</span>, </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 给予赋值的对象会被写入新列，其他字符会被删除</span></span>
<span><span class="va">df_age</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_regex</a></span><span class="op">(</span></span>
<span>    <span class="va">str</span>,</span>
<span>    patterns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"&lt;"</span>, </span>
<span>      name <span class="op">=</span> <span class="st">".+"</span>, </span>
<span>      <span class="st">"&gt;-"</span>, </span>
<span>      gender <span class="op">=</span> <span class="st">"."</span>,</span>
<span>      <span class="st">"_"</span>,</span>
<span>      age <span class="op">=</span> <span class="st">".+"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  name     gender age  
  &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;
1 Sheryl   F      34   
2 Kisha    F      45   
3 Brandon  N      33   
4 Sharon   F      38   
5 Penny    F      58   
6 Justin   M      41   
7 Patricia F      84   </code></pre>
</div>
</div>
</section><section id="separate_wider_position" class="level3" data-number="6.1.3"><h3 data-number="6.1.3" class="anchored" data-anchor-id="separate_wider_position">
<span class="header-section-number">6.1.3</span> <code>separate_wider_position()</code>
</h3>
<p>拆分指定长度的字符构成新列：</p>
<div class="cell">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"202215TX"</span>, <span class="st">"202122LA"</span>, <span class="st">"202325CA"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">df4</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_position</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">4</span>, age <span class="op">=</span> <span class="fl">2</span>, state <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  year  age   state
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 2022  15    TX   
2 2021  22    LA   
3 2023  25    CA   </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code><a href="https://tidyr.tidyverse.org/reference/separate_longer_delim.html">separate_longer_delim()</a></code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>将tibble中的某个字符列根据某个符号（<code>delim</code>）拆分成几行：</p>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a,b,c"</span>, <span class="st">"d,e"</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  x    
  &lt;chr&gt;
1 a,b,c
2 d,e  
3 f    </code></pre>
</div>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_longer_delim.html">separate_longer_delim</a></span><span class="op">(</span><span class="va">x</span>, delim <span class="op">=</span> <span class="st">","</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  x    
  &lt;chr&gt;
1 a    
2 b    
3 c    
4 d    
5 e    
6 f    </code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="拆分错误调试" class="level3" data-number="6.1.4"><h3 data-number="6.1.4" class="anchored" data-anchor-id="拆分错误调试">
<span class="header-section-number">6.1.4</span> 拆分错误调试</h3>
<p>在使用 <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code> 时，如果需要拆分的字符串中某些字符根据指定分割符拆封后片段数不足，则会发生报错：</p>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1-1-1"</span>, <span class="st">"1-1-2"</span>, <span class="st">"1-3"</span>, <span class="st">"1-3-2"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="sourceCode" id="cb109"><pre class="sourceCode md code-with-copy"><code class="sourceCode markdown"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>Error in <span class="in">`separate_wider_delim()`</span>:</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>! Expected 3 pieces in each element of <span class="in">`x`</span>.</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>! 2 values were too short.</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>ℹ Use <span class="in">`too_few = "debug"`</span> to diagnose the problem.</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>ℹ Use <span class="in">`too_few = "align_start"/"align_end"`</span> to silence this message.</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>Run <span class="in">`rlang::last_trace()`</span> to see where the error occurred.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>对于这种情况，可以手动检查数据问题，但是在实际应用中需要转换的字符列可能非常长，我们难以知道到底在哪一行出现了问题。这个时候，我们可以按照错误提示所说的那样，通过添加 <code>too_few = "debug"</code> 参数来进入调试模式：</p>
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">debug</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>    too_few <span class="op">=</span> <span class="st">"debug"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">debug</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  x     y     z     x_ok  x_pieces x_remainder
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;      
1 1-1-1 1     1     TRUE         3 ""         
2 1-1-2 1     2     TRUE         3 ""         
3 1-3   3     &lt;NA&gt;  FALSE        2 ""         
4 1-3-2 3     2     TRUE         3 ""         
5 1     &lt;NA&gt;  &lt;NA&gt;  FALSE        1 ""         </code></pre>
</div>
</div>
<p>使用调试模式时，输出的结果会多出三列：“x_ok”、“x_pieces” 和 “x_remainder”（前缀“x”是输入的变量名）：</p>
<ul>
<li><p>“x_ok”列：“TRUE”代表这一行能够被成功分割；而“FALSE”代表这一行分割失败。</p></li>
<li><p>“x_pieces”列：告诉我们这一行能够被分割成多少片段。</p></li>
<li><p>“x_remainder”列：在指定了 <code>too_many</code> 参数时有用。它告诉我们每一行多出来的具体字符（见下文）。</p></li>
</ul>
<p>因此，利用“x_ok”我们可以方便的找出转换失败的行：</p>
<div class="cell">
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">debug</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">x_ok</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  x     y     z     x_ok  x_pieces x_remainder
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;      
1 1-3   3     &lt;NA&gt;  FALSE        2 ""         
2 1     &lt;NA&gt;  &lt;NA&gt;  FALSE        1 ""         </code></pre>
</div>
</div>
<p>在发现了这些错误之处后，可以在原始数据中修复这些问题，然后重新运行 <code><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim()</a></code> ，并确保删除 <code>too_few = "debug"</code>。</p>
<p>在其他情况下，我们可能想用 “NA” 填补缺失的部分。这就是 <code>too_few = "align_start"</code> 和 <code>too_few = "align_end"</code> 的作用，它们可以控制 “NA” 填充的位置（一般用 <code>"align_start"</code>）：</p>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>    too_few <span class="op">=</span> <span class="st">"align_start"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  x     y     z    
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 1     1     1    
2 1     1     2    
3 1     3     &lt;NA&gt; 
4 1     3     2    
5 1     &lt;NA&gt;  &lt;NA&gt; </code></pre>
</div>
</div>
<p>在上面这个案例中我们指定了 <code>too_few</code> 参数，它告诉程序如何处理分割后片段数少于 <code>name</code> 中所定义的新列数的情况，是debug还是用“NA”填充。另一种情况是指定 <code>too_many</code> 参数，它告诉程序如何处理分割后片段数超出 <code>name</code> 中所定义的新列数的情况，是debug（<code>too_many = "debug"</code>）、舍弃（<code>too_many = "drop"</code>），还是合并（<code>too_many = "merge"</code>）多出来的片段。下面是一个案例：</p>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1-1-1"</span>, <span class="st">"1-1-2"</span>, <span class="st">"1-3-5-6"</span>, <span class="st">"1-3-2"</span>, <span class="st">"1-3-5-7-9"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">debug</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>    too_many <span class="op">=</span> <span class="st">"debug"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">debug</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  x         y     z     x_ok  x_pieces x_remainder
  &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;      
1 1-1-1     1     1     TRUE         3 ""         
2 1-1-2     1     2     TRUE         3 ""         
3 1-3-5-6   3     5     FALSE        4 "-6"       
4 1-3-2     3     2     TRUE         3 ""         
5 1-3-5-7-9 3     5     FALSE        5 "-7-9"     </code></pre>
</div>
</div>
<p>我们同样可以通过“x_ok”列寻找转换失败的行。在定义 <code>too_many</code> 的情况下，“x_remainder”就会发挥它的作用，这一列告诉我们每一行超出来的具体字符。</p>
<p>接下来我们可以决定如何处理超出来的片段：</p>
<div class="cell">
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 删除超出的片段</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>    too_many <span class="op">=</span> <span class="st">"drop"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  x     y     z    
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 1     1     1    
2 1     1     2    
3 1     3     5    
4 1     3     2    
5 1     3     5    </code></pre>
</div>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 合并超出的片段</span></span>
<span><span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html">separate_wider_delim</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"-"</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span><span class="op">)</span>,</span>
<span>    too_many <span class="op">=</span> <span class="st">"merge"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  x     y     z    
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 1     1     1    
2 1     1     2    
3 1     3     5-6  
4 1     3     2    
5 1     3     5-7-9</code></pre>
</div>
</div>
</section></section></section><section id="计算字符长度" class="level1" data-number="7"><h1 data-number="7">
<span class="header-section-number">7</span> 计算字符长度</h1>
<p><img src="images/截屏2024-03-07 18.30.01.png" class="img-fluid" width="440"></p>
<p><code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code> 可以返回字符串中每一个字符的长度（空格算一个字符）：</p>
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"R for data science"</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 18 NA</code></pre>
</div>
</div>
<p>下面我们用“babynames”数据集，来演示如何利用 <code><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length()</a></code> + <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>，来统计婴儿名字长度的分布情况，然后使用 <code><a href="https://rdrr.io/r/base/funprog.html">Filter()</a></code> 来查看最长的名字：</p>
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">babynames</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,924,665 × 5
    year sex   name          n   prop
   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
 1  1880 F     Mary       7065 0.0724
 2  1880 F     Anna       2604 0.0267
 3  1880 F     Emma       2003 0.0205
 4  1880 F     Elizabeth  1939 0.0199
 5  1880 F     Minnie     1746 0.0179
 6  1880 F     Margaret   1578 0.0162
 7  1880 F     Ida        1472 0.0151
 8  1880 F     Alice      1414 0.0145
 9  1880 F     Bertha     1320 0.0135
10  1880 F     Sarah      1288 0.0132
# ℹ 1,924,655 more rows</code></pre>
</div>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">babynames</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span>, wt <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 2
   length        n
    &lt;int&gt;    &lt;int&gt;
 1      2   338150
 2      3  8589596
 3      4 48506739
 4      5 87011607
 5      6 90749404
 6      7 72120767
 7      8 25404066
 8      9 11926551
 9     10  1306159
10     11  2135827
11     12    16295
12     13    10845
13     14     3681
14     15      830</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注意 <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> 中的 <code>wt</code><a href="../r_basic/vector_transform.html#sec-wt">（加权）参数</a>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>如果不指定该参数，那么 <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> 返回的计算结果将是各个长度的名字在该表格中的计数（行数），但是该表格不是一个婴儿一行，而是在 “n” 列中提供了每一个姓名下的婴儿总数，所以需要用这个数字来对计数进行加权。</p>
<div class="cell">
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 和上表对比</span></span>
<span><span class="va">babynames</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 2
   length      n
    &lt;int&gt;  &lt;int&gt;
 1      2   4660
 2      3  41274
 3      4 177838
 4      5 404291
 5      6 546519
 6      7 424360
 7      8 213803
 8      9  78946
 9     10  23437
10     11   6461
11     12   1610
12     13    946
13     14    390
14     15    130</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 查看最长的名字</span></span>
<span><span class="va">babynames</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_length.html">str_length</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">name</span>, wt <span class="op">=</span> <span class="va">n</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 2
   name                n
   &lt;chr&gt;           &lt;int&gt;
 1 Franciscojavier   123
 2 Christopherjohn   118
 3 Johnchristopher   118
 4 Christopherjame   108
 5 Christophermich    52
 6 Ryanchristopher    45
 7 Mariadelosangel    28
 8 Jonathanmichael    25
 9 Christianjoseph    22
10 Christopherjose    22
# ℹ 24 more rows</code></pre>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.3 (2024-02-29)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Sonoma 14.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Asia/Shanghai
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] babynames_1.0.1 lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  
 [5] dplyr_1.1.4     purrr_1.0.2     readr_2.1.5     tidyr_1.3.1    
 [9] tibble_3.2.1    ggplot2_3.5.0   tidyverse_2.0.0

loaded via a namespace (and not attached):
 [1] gtable_0.3.4      jsonlite_1.8.8    crayon_1.5.2      compiler_4.3.3   
 [5] tidyselect_1.2.0  scales_1.3.0      yaml_2.3.8        fastmap_1.1.1    
 [9] R6_2.5.1          labeling_0.4.3    generics_0.1.3    knitr_1.45       
[13] htmlwidgets_1.6.4 munsell_0.5.0     pillar_1.9.0      tzdb_0.4.0       
[17] rlang_1.1.3       utf8_1.2.4        stringi_1.8.3     xfun_0.42        
[21] timechange_0.3.0  cli_3.6.2         withr_3.0.0       magrittr_2.0.3   
[25] digest_0.6.34     grid_4.3.3        rstudioapi_0.15.0 hms_1.1.3        
[29] lifecycle_1.0.4   vctrs_0.6.5       evaluate_0.23     glue_1.7.0       
[33] farver_2.1.1      codetools_0.2-19  fansi_1.0.6       colorspace_2.1-0 
[37] rmarkdown_2.25    tools_4.3.3       pkgconfig_2.0.3   htmltools_0.5.7  </code></pre>
</div>
</div>
</div>
</div>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/djhcod\.github\.io\/r-notes\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="djhcod/r-notes" data-repo-id="R_kgDOKw7GMg" data-category="General" data-category-id="DIC_kwDOKw7GMs4Cbz4B" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../r_basic/vector_transform.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">不同类型向量的处理</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../r_basic/regular_expressions.html" class="pagination-link" aria-label="正则表达式">
        <span class="nav-page-text">正则表达式</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb133" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "基于stringr的字符串处理"</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 参考：</span><span class="ot">&lt;https://r4ds.hadley.nz/strings&gt;</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![](images/logo-2-01.png)</span><span class="ot">{width="145"}</span><span class="co">](https://stringr.tidyverse.org)</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>本章主要介绍基于 <span class="co">[</span><span class="ot">`stringr` 包</span><span class="co">](https://stringr.tidyverse.org)</span>的字符串和字符向量的处理。我们需要记住 <span class="in">`stringr`</span> 中用于字符串处理的函数大多都以&nbsp;<span class="in">`str_`</span>&nbsp;开头，这样我们在 RStudio 通过键入&nbsp;<span class="in">`str_`</span>&nbsp;就能方便的浏览并选择我们需要的函数：</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/stringr-autocomplete.png)</span>{width="643"}</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>和字符处理密切相关的一个内容是**正则表达式（regular expressions）**，由于这一部分内容较多，我们将在<span class="co">[</span><span class="ot">下一章</span><span class="co">](/r_basic/regular_expressions.qmd)</span>介绍。</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># 加载包</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(babynames)</span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>本章用到的案例数据集“babynames”记录了美国婴儿的姓名分布数据。</span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>babynames</span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a><span class="fu"># 查找字符</span></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a>下面是 <span class="in">`stringr`</span> 包中用于查找字符的函数，它们接受**字符向量**输入，常常和**正则表达式**配合使用：</span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-36"><a href="#cb133-36" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-07%2017.24.08.png)</span>{width="474"}</span>
<span id="cb133-37"><a href="#cb133-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-38"><a href="#cb133-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_dect()` 和 `str_starts()`</span></span>
<span id="cb133-39"><a href="#cb133-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-40"><a href="#cb133-40" aria-hidden="true" tabindex="-1"></a><span class="in">`str_dect(string, pattern)`</span> 查找 <span class="in">`string`</span> 中是否有包含目标字符 <span class="in">`pattern`</span> 的对象，**返回一个逻辑向量**。`str_starts(string, pattern)` 查找 `string` 中是否有**开头**为目标字符 <span class="in">`pattern`</span> 的对象。</span>
<span id="cb133-41"><a href="#cb133-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-44"><a href="#cb133-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-45"><a href="#cb133-45" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> babynames<span class="sc">$</span>name[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb133-46"><a href="#cb133-46" aria-hidden="true" tabindex="-1"></a>names</span>
<span id="cb133-47"><a href="#cb133-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-48"><a href="#cb133-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 查找“names”中是否有以“M”开头的对象</span></span>
<span id="cb133-49"><a href="#cb133-49" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(names, <span class="st">"^M"</span>)</span>
<span id="cb133-50"><a href="#cb133-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-51"><a href="#cb133-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 也可以用str_starts()</span></span>
<span id="cb133-52"><a href="#cb133-52" aria-hidden="true" tabindex="-1"></a><span class="fu">str_starts</span>(names, <span class="st">"M"</span>)</span>
<span id="cb133-53"><a href="#cb133-53" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-54"><a href="#cb133-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-55"><a href="#cb133-55" aria-hidden="true" tabindex="-1"></a>【练习】统计每年有多少名婴儿的名字中包含了“x”，并用折线图可视化这些婴儿每年的占比情况：</span>
<span id="cb133-56"><a href="#cb133-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-59"><a href="#cb133-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-60"><a href="#cb133-60" aria-hidden="true" tabindex="-1"></a>babynames <span class="sc">%&gt;%</span>  </span>
<span id="cb133-61"><a href="#cb133-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x_count =</span> <span class="fu">str_detect</span>(name, <span class="st">"x"</span>) <span class="sc">*</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb133-62"><a href="#cb133-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb133-63"><a href="#cb133-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop_x =</span> <span class="fu">sum</span>(x_count) <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb133-64"><a href="#cb133-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> prop_x)) <span class="sc">+</span> </span>
<span id="cb133-65"><a href="#cb133-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb133-66"><a href="#cb133-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb133-67"><a href="#cb133-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-68"><a href="#cb133-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-69"><a href="#cb133-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_which()`</span></span>
<span id="cb133-70"><a href="#cb133-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-71"><a href="#cb133-71" aria-hidden="true" tabindex="-1"></a><span class="in">`str_which(string, pattern)`</span> 查找 <span class="in">`string`</span> 中是否有包含目标字符 <span class="in">`pattern`</span> 的对象，**返回匹配到的对象的位置**。</span>
<span id="cb133-72"><a href="#cb133-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-75"><a href="#cb133-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-76"><a href="#cb133-76" aria-hidden="true" tabindex="-1"></a><span class="fu">str_which</span>(names, <span class="st">"^M"</span>)</span>
<span id="cb133-77"><a href="#cb133-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-78"><a href="#cb133-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-79"><a href="#cb133-79" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb133-80"><a href="#cb133-80" aria-hidden="true" tabindex="-1"></a><span class="in">`stringr`</span> 包的字符查找函数中的 <span class="in">`pattern`</span> 是要区分大小写的，也意味着这些函数在查找时会区分大小写。</span>
<span id="cb133-81"><a href="#cb133-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-82"><a href="#cb133-82" aria-hidden="true" tabindex="-1"></a>上述函数都可以添加一个 <span class="in">`negate = TRUE`</span> 参数，表示查找没有包含目标字符的对象，如：</span>
<span id="cb133-83"><a href="#cb133-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-86"><a href="#cb133-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-87"><a href="#cb133-87" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(names, <span class="st">"^M"</span>, <span class="at">negate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-88"><a href="#cb133-88" aria-hidden="true" tabindex="-1"></a><span class="fu">str_which</span>(names, <span class="st">"^M"</span>, <span class="at">negate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-89"><a href="#cb133-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-90"><a href="#cb133-90" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-91"><a href="#cb133-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-92"><a href="#cb133-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_view()`</span></span>
<span id="cb133-93"><a href="#cb133-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-94"><a href="#cb133-94" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-10%2010.44.21.png)</span>{width="463"}</span>
<span id="cb133-95"><a href="#cb133-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-96"><a href="#cb133-96" aria-hidden="true" tabindex="-1"></a><span class="in">`str_view(string, pattern)`</span> 是一个比较特殊的字符查找函数，它返回的结果以HTML渲染样式来返回 <span class="in">`string`</span> 中所有匹配的字符，并且**会将其中的 `pattern` 以“\&lt;\&gt;”标记出来**：</span>
<span id="cb133-97"><a href="#cb133-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-100"><a href="#cb133-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-101"><a href="#cb133-101" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(names, <span class="st">"^M"</span>)</span>
<span id="cb133-102"><a href="#cb133-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-103"><a href="#cb133-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-104"><a href="#cb133-104" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb133-105"><a href="#cb133-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## `base` 包中的字符查找函数</span></span>
<span id="cb133-106"><a href="#cb133-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-107"><a href="#cb133-107" aria-hidden="true" tabindex="-1"></a><span class="fu">### **`%in%`**</span></span>
<span id="cb133-108"><a href="#cb133-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-109"><a href="#cb133-109" aria-hidden="true" tabindex="-1"></a>查找字符向量中是否有**任何**目标字符串。它会把每个字符串当成判断的最小单位，即**完全匹配**，所以不能用来判断/查找"长字符串中是否含有特定的短字符串"。例如：</span>
<span id="cb133-110"><a href="#cb133-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-113"><a href="#cb133-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-114"><a href="#cb133-114" aria-hidden="true" tabindex="-1"></a>places <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"中国四川"</span>,<span class="st">"中国北京"</span>,<span class="st">"中国安徽"</span>,<span class="st">"北京天安门"</span>)</span>
<span id="cb133-115"><a href="#cb133-115" aria-hidden="true" tabindex="-1"></a><span class="st">"中国四川"</span> <span class="sc">%in%</span> places</span>
<span id="cb133-116"><a href="#cb133-116" aria-hidden="true" tabindex="-1"></a><span class="st">"中国"</span> <span class="sc">%in%</span> places</span>
<span id="cb133-117"><a href="#cb133-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-118"><a href="#cb133-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-119"><a href="#cb133-119" aria-hidden="true" tabindex="-1"></a><span class="fu">### **`grep()`函数**</span></span>
<span id="cb133-120"><a href="#cb133-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-121"><a href="#cb133-121" aria-hidden="true" tabindex="-1"></a>grep 的全称是“global search regular expression and print out the line”，类似于 <span class="in">`stringr`</span> 包中的 <span class="in">`str_which()`</span> ，返回匹配到的目标字符的位置。当添加了 <span class="in">`value = TRUE`</span> 参数时，类似于 <span class="in">`str_subset()`</span> 函数（见<span class="co">[</span><span class="ot">下文</span><span class="co">](#sec-str_sub)</span>），返回包含目标字符的所有对象。</span>
<span id="cb133-122"><a href="#cb133-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-125"><a href="#cb133-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-126"><a href="#cb133-126" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(</span>
<span id="cb133-127"><a href="#cb133-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"^M"</span>, <span class="co"># 需要找找的字符</span></span>
<span id="cb133-128"><a href="#cb133-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> names, <span class="co"># 从哪里查找</span></span>
<span id="cb133-129"><a href="#cb133-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">ignore.case =</span> F, <span class="co"># 是否忽略大小写，默认为FALSE</span></span>
<span id="cb133-130"><a href="#cb133-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> F, <span class="co"># 默认为FALSE，表示返回匹配到的字符所在的位置；TRUE则返回查找到的值</span></span>
<span id="cb133-131"><a href="#cb133-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">invert =</span> F <span class="co"># 如果为TRUE，则返回未匹配到的字符的值或位置</span></span>
<span id="cb133-132"><a href="#cb133-132" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb133-133"><a href="#cb133-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-134"><a href="#cb133-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-135"><a href="#cb133-135" aria-hidden="true" tabindex="-1"></a><span class="fu">### **`grepl()`**</span></span>
<span id="cb133-136"><a href="#cb133-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-137"><a href="#cb133-137" aria-hidden="true" tabindex="-1"></a><span class="in">`grepl()`</span> 类似于 <span class="in">`stringr`</span> 包中的 <span class="in">`str_detect()`</span> ，返回是否匹配到目标字符的逻辑向量：</span>
<span id="cb133-138"><a href="#cb133-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-141"><a href="#cb133-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-142"><a href="#cb133-142" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(</span>
<span id="cb133-143"><a href="#cb133-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">"^M"</span>,</span>
<span id="cb133-144"><a href="#cb133-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> names</span>
<span id="cb133-145"><a href="#cb133-145" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb133-146"><a href="#cb133-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-147"><a href="#cb133-147" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-148"><a href="#cb133-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-149"><a href="#cb133-149" aria-hidden="true" tabindex="-1"></a><span class="fu"># 截取字符</span></span>
<span id="cb133-150"><a href="#cb133-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-151"><a href="#cb133-151" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-07%2018.08.32.png)</span>{width="459"}</span>
<span id="cb133-152"><a href="#cb133-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-153"><a href="#cb133-153" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_sub()` {#sec-str_sub}</span></span>
<span id="cb133-154"><a href="#cb133-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-155"><a href="#cb133-155" aria-hidden="true" tabindex="-1"></a><span class="in">`str_sub(string，start，end)`</span> 用于提取指定长度和位置的字符串，其中 <span class="in">`start`</span> 和 <span class="in">`end`</span> 是截取字符串应该开始和结束的位置。返回的字符串的长度 = <span class="in">`end`</span> - <span class="in">`start`</span> + 1。<span class="in">`base`</span> 包中与之对应的函数是 <span class="in">`substr()`</span> 。</span>
<span id="cb133-156"><a href="#cb133-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-159"><a href="#cb133-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-160"><a href="#cb133-160" aria-hidden="true" tabindex="-1"></a>fruit_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A_p ple"</span>, <span class="st">" Banana"</span>, <span class="st">"Pear"</span>, <span class="cn">NA</span>)</span>
<span id="cb133-161"><a href="#cb133-161" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(fruit_list, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb133-162"><a href="#cb133-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-163"><a href="#cb133-163" aria-hidden="true" tabindex="-1"></a><span class="co"># 负号表示距末尾多少个字符截取：</span></span>
<span id="cb133-164"><a href="#cb133-164" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(fruit_list, <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb133-165"><a href="#cb133-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-166"><a href="#cb133-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-167"><a href="#cb133-167" aria-hidden="true" tabindex="-1"></a><span class="in">`str_sub()`</span> 在其后方添加赋值后还可以实现对特定位置字符的替换，见<span class="co">[</span><span class="ot">下文</span><span class="co">](#sec-替换字符)</span>。</span>
<span id="cb133-168"><a href="#cb133-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-169"><a href="#cb133-169" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_subset()`</span></span>
<span id="cb133-170"><a href="#cb133-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-171"><a href="#cb133-171" aria-hidden="true" tabindex="-1"></a><span class="in">`str_subset(string, pattern)`</span> 返回 <span class="in">`string`</span> 中包含 <span class="in">`pattern`</span> 的所有对象。功能类似于添加了 <span class="in">`value = TRUE`</span> 参数时的 <span class="in">`grep()`</span> 函数。</span>
<span id="cb133-172"><a href="#cb133-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-175"><a href="#cb133-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-176"><a href="#cb133-176" aria-hidden="true" tabindex="-1"></a><span class="co"># 返回“names”中开头为“M”的对象</span></span>
<span id="cb133-177"><a href="#cb133-177" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(names, <span class="st">"^M"</span>)</span>
<span id="cb133-178"><a href="#cb133-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-179"><a href="#cb133-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-180"><a href="#cb133-180" aria-hidden="true" tabindex="-1"></a><span class="fu"># 替换字符 {#sec-替换字符}</span></span>
<span id="cb133-181"><a href="#cb133-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-182"><a href="#cb133-182" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-07%2018.37.53.png)</span>{width="499"}</span>
<span id="cb133-183"><a href="#cb133-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-184"><a href="#cb133-184" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_sub() &lt;- value`</span></span>
<span id="cb133-185"><a href="#cb133-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-186"><a href="#cb133-186" aria-hidden="true" tabindex="-1"></a>用 <span class="in">`str_sub() &lt;- value`</span> 可以实现对特定位置字符的替换。例如将“fruit_list”中的第1-3位字符替换成“<span class="sc">\*\*\*</span>”：</span>
<span id="cb133-187"><a href="#cb133-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-190"><a href="#cb133-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-191"><a href="#cb133-191" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(fruit_list, <span class="dv">1</span>, <span class="dv">3</span>) <span class="ot">&lt;-</span> <span class="st">"***"</span></span>
<span id="cb133-192"><a href="#cb133-192" aria-hidden="true" tabindex="-1"></a>fruit_list</span>
<span id="cb133-193"><a href="#cb133-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-194"><a href="#cb133-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-195"><a href="#cb133-195" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_replace()`</span></span>
<span id="cb133-196"><a href="#cb133-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-197"><a href="#cb133-197" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`str_replace(string, pattern, replacement)`</span> 将 <span class="in">`string`</span> 中的**第一个** <span class="in">`pattern`</span> 替换成 <span class="in">`replacement`</span> 。</span>
<span id="cb133-198"><a href="#cb133-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-199"><a href="#cb133-199" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`str_replace_all(string, pattern, replacement)`</span> 将 <span class="in">`string`</span> 中的**所有** <span class="in">`pattern`</span> 替换成 <span class="in">`replacement`</span> 。</span>
<span id="cb133-200"><a href="#cb133-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-203"><a href="#cb133-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-204"><a href="#cb133-204" aria-hidden="true" tabindex="-1"></a>fruit_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A_p p le"</span>, <span class="st">" B anana"</span>, <span class="st">"Pear "</span>, <span class="cn">NA</span>)</span>
<span id="cb133-205"><a href="#cb133-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-206"><a href="#cb133-206" aria-hidden="true" tabindex="-1"></a><span class="co"># 将“fruit_list”中的第一个空格替换成“#”</span></span>
<span id="cb133-207"><a href="#cb133-207" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(fruit_list, <span class="at">pattern =</span> <span class="st">" "</span>, <span class="at">replacement =</span> <span class="st">"#"</span>)</span>
<span id="cb133-208"><a href="#cb133-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-209"><a href="#cb133-209" aria-hidden="true" tabindex="-1"></a><span class="co"># 将“fruit_list”中的所有空格替换成“#”</span></span>
<span id="cb133-210"><a href="#cb133-210" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(fruit_list, <span class="at">pattern =</span> <span class="st">" "</span>, <span class="at">replacement =</span> <span class="st">"#"</span>)</span>
<span id="cb133-211"><a href="#cb133-211" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-212"><a href="#cb133-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-213"><a href="#cb133-213" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_remove()`</span></span>
<span id="cb133-214"><a href="#cb133-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-215"><a href="#cb133-215" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`str_remove(string, pattern)`</span> 将 <span class="in">`string`</span> 中的**第一个** <span class="in">`pattern`</span> 删除。</span>
<span id="cb133-216"><a href="#cb133-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-217"><a href="#cb133-217" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`str_remove_all(string, pattern)`</span> 将 <span class="in">`string`</span> 中的**所有** <span class="in">`pattern`</span> 删除。</span>
<span id="cb133-218"><a href="#cb133-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-221"><a href="#cb133-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-222"><a href="#cb133-222" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除“fruit_list”中的第一个空格</span></span>
<span id="cb133-223"><a href="#cb133-223" aria-hidden="true" tabindex="-1"></a><span class="fu">str_remove</span>(fruit_list, <span class="at">pattern =</span> <span class="st">" "</span>)</span>
<span id="cb133-224"><a href="#cb133-224" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除“fruit_list”中的所有空格</span></span>
<span id="cb133-225"><a href="#cb133-225" aria-hidden="true" tabindex="-1"></a><span class="fu">str_remove_all</span>(fruit_list, <span class="at">pattern =</span> <span class="st">" "</span>)</span>
<span id="cb133-226"><a href="#cb133-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-227"><a href="#cb133-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-228"><a href="#cb133-228" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb133-229"><a href="#cb133-229" aria-hidden="true" tabindex="-1"></a><span class="fu">## base 包中的字符替换函数</span></span>
<span id="cb133-230"><a href="#cb133-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-231"><a href="#cb133-231" aria-hidden="true" tabindex="-1"></a>在 base 包中与 <span class="in">`str_replace_all()`</span> 和 <span class="in">`str_remove_all()`</span> 对应的函数是 <span class="in">`gsub()`</span> ：</span>
<span id="cb133-232"><a href="#cb133-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-235"><a href="#cb133-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-236"><a href="#cb133-236" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="at">x =</span> fruit_list, <span class="at">pattern =</span> <span class="st">" "</span>, <span class="at">replacement =</span> <span class="st">"#"</span>)</span>
<span id="cb133-237"><a href="#cb133-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-238"><a href="#cb133-238" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-239"><a href="#cb133-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-240"><a href="#cb133-240" aria-hidden="true" tabindex="-1"></a><span class="fu">## 转换大小写</span></span>
<span id="cb133-241"><a href="#cb133-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-242"><a href="#cb133-242" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-07%2017.12.05.png)</span>{width="429"}</span>
<span id="cb133-243"><a href="#cb133-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-246"><a href="#cb133-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-247"><a href="#cb133-247" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_upper</span>(<span class="fu">c</span>(<span class="st">"abc"</span>, <span class="st">"def"</span>))</span>
<span id="cb133-248"><a href="#cb133-248" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_lower</span>(<span class="fu">c</span>(<span class="st">"ABC"</span>, <span class="st">"DEF"</span>))</span>
<span id="cb133-249"><a href="#cb133-249" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_title</span>(<span class="fu">c</span>(<span class="st">"ABC"</span>, <span class="st">"DEF"</span>))</span>
<span id="cb133-250"><a href="#cb133-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-251"><a href="#cb133-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-252"><a href="#cb133-252" aria-hidden="true" tabindex="-1"></a><span class="in">`base`</span> 包中与之对应的函数是 <span class="in">`toupper()`</span> 和 <span class="in">`tolower()`</span> 。</span>
<span id="cb133-253"><a href="#cb133-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-254"><a href="#cb133-254" aria-hidden="true" tabindex="-1"></a><span class="fu"># 拼接字符 {#sec-拼接字符串}</span></span>
<span id="cb133-255"><a href="#cb133-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-256"><a href="#cb133-256" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-07%2019.18%20拷贝.jpg)</span>{width="422"}</span>
<span id="cb133-257"><a href="#cb133-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-258"><a href="#cb133-258" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_c()`</span></span>
<span id="cb133-259"><a href="#cb133-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-260"><a href="#cb133-260" aria-hidden="true" tabindex="-1"></a><span class="in">`str_c()`</span> 和 <span class="in">`str_glue()`</span> 用于拼接字符。<span class="in">`str_c()`</span> 与 <span class="in">`base`</span> 包的 <span class="in">`paste0()`</span> 的用法非常相似，但前者遵循 tidyverse 规则，不会对缺失值进行处理，能够更好的与 <span class="in">`mutate()`</span> 配合使用：</span>
<span id="cb133-261"><a href="#cb133-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-264"><a href="#cb133-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-265"><a href="#cb133-265" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Flora"</span>, <span class="st">"David"</span>, <span class="st">"Terra"</span>, <span class="cn">NA</span>, <span class="st">"Eric"</span>, <span class="cn">NA</span>))</span>
<span id="cb133-266"><a href="#cb133-266" aria-hidden="true" tabindex="-1"></a>df  <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">greeting =</span> <span class="fu">str_c</span>(<span class="st">"Hi "</span>, name, <span class="st">"!"</span>))</span>
<span id="cb133-267"><a href="#cb133-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-268"><a href="#cb133-268" aria-hidden="true" tabindex="-1"></a><span class="co"># 用paste0()的效果</span></span>
<span id="cb133-269"><a href="#cb133-269" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">greeting =</span> <span class="fu">paste0</span>(<span class="st">"Hi "</span>, name, <span class="st">"!"</span>))</span>
<span id="cb133-270"><a href="#cb133-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-271"><a href="#cb133-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-272"><a href="#cb133-272" aria-hidden="true" tabindex="-1"></a>::: callout-caution</span>
<span id="cb133-273"><a href="#cb133-273" aria-hidden="true" tabindex="-1"></a>从上面的例子中可以发现，<span class="in">`str_c()`</span> 和 <span class="in">`paste0()`</span> 的一个最重要的区别是 **`str_c()` 会忽略缺失值，而 `paste0()` 会将缺失值也作为一个字符处理。**</span>
<span id="cb133-274"><a href="#cb133-274" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-275"><a href="#cb133-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-276"><a href="#cb133-276" aria-hidden="true" tabindex="-1"></a>如果希望在遇到缺失值时以其他字符替换显示，可以使用 <span class="in">`coalesce(x, "y")`</span> ，它会将x中的所有缺失值替换成“y”。根据需要，可以在 <span class="in">`str_c()`</span> 内部或外部使用它：</span>
<span id="cb133-277"><a href="#cb133-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-280"><a href="#cb133-280" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-281"><a href="#cb133-281" aria-hidden="true" tabindex="-1"></a><span class="co"># 演示coalesc()的作用</span></span>
<span id="cb133-282"><a href="#cb133-282" aria-hidden="true" tabindex="-1"></a><span class="fu">coalesce</span>(df<span class="sc">$</span>name, <span class="st">"you"</span>)</span>
<span id="cb133-283"><a href="#cb133-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-284"><a href="#cb133-284" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb133-285"><a href="#cb133-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-286"><a href="#cb133-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">greeting1 =</span> <span class="fu">str_c</span>(<span class="st">"Hi "</span>, <span class="fu">coalesce</span>(name, <span class="st">"you"</span>), <span class="st">"!"</span>),</span>
<span id="cb133-287"><a href="#cb133-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">greeting2 =</span> <span class="fu">coalesce</span>(<span class="fu">str_c</span>(<span class="st">"Hi "</span>, name, <span class="st">"!"</span>), <span class="st">"Hi someone!"</span>), </span>
<span id="cb133-288"><a href="#cb133-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">"used"</span></span>
<span id="cb133-289"><a href="#cb133-289" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-290"><a href="#cb133-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-291"><a href="#cb133-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-292"><a href="#cb133-292" aria-hidden="true" tabindex="-1"></a>可以通过添加 <span class="in">`sep`</span> 参数，以固定的分隔符分隔多个字符向量，类似于 <span class="in">`paste()`</span> 中的 <span class="in">`sep`</span> 参数（两者对待缺失值的行为不一样）：</span>
<span id="cb133-293"><a href="#cb133-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-296"><a href="#cb133-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-297"><a href="#cb133-297" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb133-298"><a href="#cb133-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-299"><a href="#cb133-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">18</span>, <span class="cn">NA</span>, <span class="dv">22</span>),</span>
<span id="cb133-300"><a href="#cb133-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">116</span>, <span class="dv">170</span>, <span class="cn">NA</span>, <span class="dv">180</span>, <span class="cn">NA</span>, <span class="dv">177</span>)</span>
<span id="cb133-301"><a href="#cb133-301" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-302"><a href="#cb133-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-303"><a href="#cb133-303" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb133-304"><a href="#cb133-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-305"><a href="#cb133-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">combine =</span> <span class="fu">str_c</span>(<span class="fu">coalesce</span>(name, <span class="st">"unknown"</span>), age, height, <span class="at">sep =</span> <span class="st">"-"</span>)</span>
<span id="cb133-306"><a href="#cb133-306" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-307"><a href="#cb133-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-308"><a href="#cb133-308" aria-hidden="true" tabindex="-1"></a><span class="co"># 用paste()替换str_c()</span></span>
<span id="cb133-309"><a href="#cb133-309" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb133-310"><a href="#cb133-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-311"><a href="#cb133-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">combine =</span> <span class="fu">paste</span>(<span class="fu">coalesce</span>(name, <span class="st">"unknown"</span>), age, height, <span class="at">sep =</span> <span class="st">"-"</span>)</span>
<span id="cb133-312"><a href="#cb133-312" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-313"><a href="#cb133-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-314"><a href="#cb133-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-315"><a href="#cb133-315" aria-hidden="true" tabindex="-1"></a>如果给 <span class="in">`str_c()`</span> 只提供了**一个字符向量**，这个时候如果需要将该向量内的字符以固定的分隔符**合并为一个字符**，则需要指定 <span class="in">`collapse`</span> 参数。这种情况可以和 <span class="in">`summarize()`</span> 配合使用，并且一般会使用另一个字符连接函数 <span class="in">`str_flatten()`</span> （见）。</span>
<span id="cb133-316"><a href="#cb133-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-319"><a href="#cb133-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-320"><a href="#cb133-320" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="fu">coalesce</span>(df<span class="sc">$</span>name, <span class="st">"unknown"</span>), <span class="at">collapse =</span> <span class="st">"-"</span>)</span>
<span id="cb133-321"><a href="#cb133-321" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(df<span class="sc">$</span>name, <span class="at">collapse =</span> <span class="st">"-"</span>)</span>
<span id="cb133-322"><a href="#cb133-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-323"><a href="#cb133-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-324"><a href="#cb133-324" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_glue()` 和 `str_glu_data()`</span></span>
<span id="cb133-325"><a href="#cb133-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-326"><a href="#cb133-326" aria-hidden="true" tabindex="-1"></a>如果你需要将很多字符串向量和多个固定字符粘贴起来，如果这时候仍然用 <span class="in">`str_c()`</span> 会让代码看上去比较混乱和难以理解。这种情况我们可以使用 <span class="in">`str_glue()`</span> 来简化代码。 <span class="in">`str_glue()`</span> 将需要调用的字符向量放到“{}”内，括号外可以输入任意自定义字符。</span>
<span id="cb133-327"><a href="#cb133-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-330"><a href="#cb133-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-331"><a href="#cb133-331" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb133-332"><a href="#cb133-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-333"><a href="#cb133-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">greeting =</span> <span class="fu">str_glue</span>(</span>
<span id="cb133-334"><a href="#cb133-334" aria-hidden="true" tabindex="-1"></a>      <span class="st">"My name is {name}, "</span>,</span>
<span id="cb133-335"><a href="#cb133-335" aria-hidden="true" tabindex="-1"></a>      <span class="st">"my age is {age}, "</span>,</span>
<span id="cb133-336"><a href="#cb133-336" aria-hidden="true" tabindex="-1"></a>      <span class="st">"my height is {height/100} meters."</span>,</span>
<span id="cb133-337"><a href="#cb133-337" aria-hidden="true" tabindex="-1"></a>      <span class="at">.na =</span> <span class="st">"**"</span></span>
<span id="cb133-338"><a href="#cb133-338" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb133-339"><a href="#cb133-339" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-340"><a href="#cb133-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-341"><a href="#cb133-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-342"><a href="#cb133-342" aria-hidden="true" tabindex="-1"></a>::: callout-caution</span>
<span id="cb133-343"><a href="#cb133-343" aria-hidden="true" tabindex="-1"></a><span class="in">`str_glue()`</span> 默认情况下会将缺失值转换为字符串 "NA"，这一点与 <span class="in">`str_c()`</span> 不一致。可以通过添加 <span class="in">`.na`</span> 参数指定将缺失值替换成什么。</span>
<span id="cb133-344"><a href="#cb133-344" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-345"><a href="#cb133-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-346"><a href="#cb133-346" aria-hidden="true" tabindex="-1"></a><span class="fu">### `str_glue_data()`</span></span>
<span id="cb133-347"><a href="#cb133-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-348"><a href="#cb133-348" aria-hidden="true" tabindex="-1"></a>如果你想脱离 <span class="in">`mutate()`</span>，在一个表格中简单的通过连接几列来**返回一个字符向量**，那么用 <span class="in">`str_glue_data()`</span> 可能更合适。其语法为：<span class="in">`str_glue_data(.x, ..., .sep, .na = "NA")`</span> 。</span>
<span id="cb133-349"><a href="#cb133-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-352"><a href="#cb133-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-353"><a href="#cb133-353" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">&lt;-</span> <span class="fu">head</span>(mtcars)</span>
<span id="cb133-354"><a href="#cb133-354" aria-hidden="true" tabindex="-1"></a>cars</span>
<span id="cb133-355"><a href="#cb133-355" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue_data</span>(cars, <span class="st">"{rownames(cars)} has {hp} hp"</span>)</span>
<span id="cb133-356"><a href="#cb133-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-357"><a href="#cb133-357" aria-hidden="true" tabindex="-1"></a><span class="co"># 在mutate()外使用str_glue()实现同样的目的需要反复调用数据集名称</span></span>
<span id="cb133-358"><a href="#cb133-358" aria-hidden="true" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">"{rownames(cars)} has {cars$hp} hp"</span>) </span>
<span id="cb133-359"><a href="#cb133-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-360"><a href="#cb133-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-361"><a href="#cb133-361" aria-hidden="true" tabindex="-1"></a><span class="fu">## `str_flatten()`</span></span>
<span id="cb133-362"><a href="#cb133-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-363"><a href="#cb133-363" aria-hidden="true" tabindex="-1"></a><span class="in">`str_c()`</span> 和 <span class="in">`str_glue()`</span> 可以很好地与 <span class="in">`mutate()`</span> 配合使用，因为它们的输出与输入长度相同。如果想要一个能与 <span class="in">`summarize()`</span> 完美配合的函数，即总是返回单个字符串的函数，就可以用 <span class="in">`str_flatten()`</span> ：它接收单个字符向量，并以固定的分隔符将向量中的每个元素合并为一个字符。</span>
<span id="cb133-364"><a href="#cb133-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-367"><a href="#cb133-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-368"><a href="#cb133-368" aria-hidden="true" tabindex="-1"></a><span class="fu">str_flatten</span>(<span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>), <span class="at">collapse =</span> <span class="st">", "</span>, <span class="at">last =</span> <span class="st">", and "</span>)</span>
<span id="cb133-369"><a href="#cb133-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-370"><a href="#cb133-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-371"><a href="#cb133-371" aria-hidden="true" tabindex="-1"></a>例如，统计每个人喜欢的水果，把每个人喜欢的水果用逗号连接起来：</span>
<span id="cb133-372"><a href="#cb133-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-375"><a href="#cb133-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-376"><a href="#cb133-376" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb133-377"><a href="#cb133-377" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> name, <span class="sc">~</span> fruit,</span>
<span id="cb133-378"><a href="#cb133-378" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Carmen"</span>, <span class="st">"banana"</span>,</span>
<span id="cb133-379"><a href="#cb133-379" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Carmen"</span>, <span class="st">"apple"</span>,</span>
<span id="cb133-380"><a href="#cb133-380" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Marvin"</span>, <span class="st">"nectarine"</span>,</span>
<span id="cb133-381"><a href="#cb133-381" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Terence"</span>, <span class="st">"cantaloupe"</span>,</span>
<span id="cb133-382"><a href="#cb133-382" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Terence"</span>, <span class="st">"papaya"</span>,</span>
<span id="cb133-383"><a href="#cb133-383" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Terence"</span>, <span class="st">"mandarin"</span></span>
<span id="cb133-384"><a href="#cb133-384" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-385"><a href="#cb133-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-386"><a href="#cb133-386" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb133-387"><a href="#cb133-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb133-388"><a href="#cb133-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">fruits =</span> <span class="fu">str_flatten</span>(fruit, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb133-389"><a href="#cb133-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-390"><a href="#cb133-390" aria-hidden="true" tabindex="-1"></a><span class="co"># 也可以用str_c()并指定collapse参数</span></span>
<span id="cb133-391"><a href="#cb133-391" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb133-392"><a href="#cb133-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb133-393"><a href="#cb133-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">fruits =</span> <span class="fu">str_c</span>(fruit, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb133-394"><a href="#cb133-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-395"><a href="#cb133-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-396"><a href="#cb133-396" aria-hidden="true" tabindex="-1"></a><span class="fu"># 分割字符</span></span>
<span id="cb133-397"><a href="#cb133-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-398"><a href="#cb133-398" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-07%2020.03.28.png)</span>{width="521"}</span>
<span id="cb133-399"><a href="#cb133-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-400"><a href="#cb133-400" aria-hidden="true" tabindex="-1"></a><span class="in">`str_split(string, pattern, simplify, i)`</span> 可以根据某个**分割符**将字符向量中的每一个对象分割成n列。其中：</span>
<span id="cb133-401"><a href="#cb133-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-402"><a href="#cb133-402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`string`</span>：待分割的字符向量。其中每个对象包含的分割符数量可以是不同的。</span>
<span id="cb133-403"><a href="#cb133-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-404"><a href="#cb133-404" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`pattern`</span>：指定分割符。</span>
<span id="cb133-405"><a href="#cb133-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-406"><a href="#cb133-406" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`simplify`</span>：默认“FALSE”，返回一个字符向量列表。设置为“TRUE”时（常用），则返回字符矩阵（character matrix）。</span>
<span id="cb133-407"><a href="#cb133-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-408"><a href="#cb133-408" aria-hidden="true" tabindex="-1"></a>可以在 <span class="in">`str_split()`</span> 外通过添加 <span class="in">`[x, y]`</span> 来提取拆分后的指定列或行的字符。</span>
<span id="cb133-409"><a href="#cb133-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-412"><a href="#cb133-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-413"><a href="#cb133-413" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb133-414"><a href="#cb133-414" aria-hidden="true" tabindex="-1"></a>  <span class="at">fruits =</span> <span class="fu">c</span>(</span>
<span id="cb133-415"><a href="#cb133-415" aria-hidden="true" tabindex="-1"></a>    <span class="st">"apples-oranges-pears-bananas"</span>,</span>
<span id="cb133-416"><a href="#cb133-416" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pineapples-mangos-guavas"</span></span>
<span id="cb133-417"><a href="#cb133-417" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb133-418"><a href="#cb133-418" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-419"><a href="#cb133-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-420"><a href="#cb133-420" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(df<span class="sc">$</span>fruits, <span class="st">"-"</span>, <span class="at">simplify =</span> T) </span>
<span id="cb133-421"><a href="#cb133-421" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(df<span class="sc">$</span>fruits, <span class="st">"-"</span>, <span class="at">simplify =</span> T)[,<span class="dv">2</span>] </span>
<span id="cb133-422"><a href="#cb133-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-423"><a href="#cb133-423" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb133-424"><a href="#cb133-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-425"><a href="#cb133-425" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2nd_fruit"</span> <span class="ot">=</span> <span class="fu">str_split</span>(fruits, <span class="st">"-"</span>, <span class="at">simplify =</span> T)[,<span class="dv">2</span>] </span>
<span id="cb133-426"><a href="#cb133-426" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-427"><a href="#cb133-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-428"><a href="#cb133-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-429"><a href="#cb133-429" aria-hidden="true" tabindex="-1"></a><span class="fu">## 字符列的分割 {#sec-字符列的分割}</span></span>
<span id="cb133-430"><a href="#cb133-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-431"><a href="#cb133-431" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/clipboard-4083897435.png)</span></span>
<span id="cb133-432"><a href="#cb133-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-433"><a href="#cb133-433" aria-hidden="true" tabindex="-1"></a><span class="in">`separate_wider_position()`</span> 、 <span class="in">`separate_wider_delim()`</span> 以及 <span class="in">`separate_wider_regex()`</span> 用于将某一列根据分割符（<span class="in">`separate_wider_delim()`</span>）、固定宽度（<span class="in">`separate_wider_position()`</span>）或正则表达式（<span class="in">`separate_wider_regex()`</span>）拆分为多列。这些函数包括在 <span class="co">[</span><span class="ot">`tidyr` 包</span><span class="co">](/r_basic/tidyr.qmd)</span>中，因为它们的操作对象是数据框（列），而不是单个字符向量。把这些函数中的“wider”替换成“longer”就构成了另外三个类似函数，用于将某一列根据分割符、固定宽度或正则表达式拆分为多行（不常用）。</span>
<span id="cb133-434"><a href="#cb133-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-435"><a href="#cb133-435" aria-hidden="true" tabindex="-1"></a><span class="fu">### `separate_wider_delim()`</span></span>
<span id="cb133-436"><a href="#cb133-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-437"><a href="#cb133-437" aria-hidden="true" tabindex="-1"></a>将数据框中的某列根据某个符号（<span class="in">`delim`</span>）拆分成几列：</span>
<span id="cb133-438"><a href="#cb133-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-441"><a href="#cb133-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-442"><a href="#cb133-442" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 字符列的分割案例</span></span>
<span id="cb133-443"><a href="#cb133-443" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-separate_wider_delim</span></span>
<span id="cb133-444"><a href="#cb133-444" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"a10-1-2022"</span>, <span class="st">"b10-2-2011"</span>, <span class="st">"e15-1-2015"</span>))</span>
<span id="cb133-445"><a href="#cb133-445" aria-hidden="true" tabindex="-1"></a>df3</span>
<span id="cb133-446"><a href="#cb133-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-447"><a href="#cb133-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-450"><a href="#cb133-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-451"><a href="#cb133-451" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">|&gt;</span> </span>
<span id="cb133-452"><a href="#cb133-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-453"><a href="#cb133-453" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-454"><a href="#cb133-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-455"><a href="#cb133-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"edition"</span>, <span class="st">"year"</span>),</span>
<span id="cb133-456"><a href="#cb133-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_remove =</span> F <span class="co"># 不要移除原始列</span></span>
<span id="cb133-457"><a href="#cb133-457" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-458"><a href="#cb133-458" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-459"><a href="#cb133-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-460"><a href="#cb133-460" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb133-461"><a href="#cb133-461" aria-hidden="true" tabindex="-1"></a><span class="fu">###### 这个效果是否用上面的 `str_split()` 也可以实现？</span></span>
<span id="cb133-462"><a href="#cb133-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-463"><a href="#cb133-463" aria-hidden="true" tabindex="-1"></a>如果用上面的 <span class="in">`str_split()`</span> 实现同样目的的话需要如下代码：</span>
<span id="cb133-464"><a href="#cb133-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-467"><a href="#cb133-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-468"><a href="#cb133-468" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">%&gt;%</span> </span>
<span id="cb133-469"><a href="#cb133-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-470"><a href="#cb133-470" aria-hidden="true" tabindex="-1"></a>    <span class="at">code =</span> <span class="fu">str_split</span>(x, <span class="at">pattern =</span> <span class="st">"-"</span>, <span class="at">simplify =</span> T)[,<span class="dv">1</span>],</span>
<span id="cb133-471"><a href="#cb133-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">edition =</span> <span class="fu">str_split</span>(x, <span class="at">pattern =</span> <span class="st">"-"</span>, <span class="at">simplify =</span> T)[,<span class="dv">2</span>],</span>
<span id="cb133-472"><a href="#cb133-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">str_split</span>(x, <span class="at">pattern =</span> <span class="st">"-"</span>, <span class="at">simplify =</span> T)[,<span class="dv">3</span>]</span>
<span id="cb133-473"><a href="#cb133-473" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-474"><a href="#cb133-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-475"><a href="#cb133-475" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-476"><a href="#cb133-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-477"><a href="#cb133-477" aria-hidden="true" tabindex="-1"></a>如果拆分后某几列的数据不需要，可以将其指定为“NA”，这样在输出结果中指定为“NA”的列将不会显示：</span>
<span id="cb133-478"><a href="#cb133-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-481"><a href="#cb133-481" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-482"><a href="#cb133-482" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">|&gt;</span> </span>
<span id="cb133-483"><a href="#cb133-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-484"><a href="#cb133-484" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-485"><a href="#cb133-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-486"><a href="#cb133-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="cn">NA</span>, <span class="st">"year"</span>)</span>
<span id="cb133-487"><a href="#cb133-487" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-488"><a href="#cb133-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-489"><a href="#cb133-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-490"><a href="#cb133-490" aria-hidden="true" tabindex="-1"></a>在上面的 @tbl-separate_wider_delim 中，待分割列有**固定的分隔符**分隔我们想要提取的变量，这种情况用 `separate_wider_delim()` 可以便捷的分割这些变量。但是在下面的 @tbl-separate_wider_delim_regex 中待分割列中的变量间由不同的分隔符分隔，这个时候我们可以**通过正则表达式来定义分隔符**。<span class="in">`delim`</span> 参数支持通过 <span class="in">`regex()`</span> 包装的<span class="co">[</span><span class="ot">正则表达式</span><span class="co">](/r_basic/regular_expressions.qmd)</span>：</span>
<span id="cb133-491"><a href="#cb133-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-494"><a href="#cb133-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-495"><a href="#cb133-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "在separate_wider_delim()中应用正则表达式"</span></span>
<span id="cb133-496"><a href="#cb133-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-separate_wider_delim_regex</span></span>
<span id="cb133-497"><a href="#cb133-497" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"a10-1_2022 January"</span>, <span class="st">"b10-2_2011 February"</span>, <span class="st">"e15-1_2015 March"</span>))</span>
<span id="cb133-498"><a href="#cb133-498" aria-hidden="true" tabindex="-1"></a>df4</span>
<span id="cb133-499"><a href="#cb133-499" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-500"><a href="#cb133-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-503"><a href="#cb133-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-504"><a href="#cb133-504" aria-hidden="true" tabindex="-1"></a>df4 <span class="sc">|&gt;</span> </span>
<span id="cb133-505"><a href="#cb133-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-506"><a href="#cb133-506" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-507"><a href="#cb133-507" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="fu">regex</span>(<span class="st">"-|_|</span><span class="sc">\\</span><span class="st">s"</span>), <span class="co"># 或者写成 "-|_| "</span></span>
<span id="cb133-508"><a href="#cb133-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"edition"</span>, <span class="st">"year"</span>, <span class="st">"month"</span>),</span>
<span id="cb133-509"><a href="#cb133-509" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_remove =</span> F </span>
<span id="cb133-510"><a href="#cb133-510" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-511"><a href="#cb133-511" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-512"><a href="#cb133-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-513"><a href="#cb133-513" aria-hidden="true" tabindex="-1"></a><span class="fu">### `separate_wider_regex()`</span></span>
<span id="cb133-514"><a href="#cb133-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-515"><a href="#cb133-515" aria-hidden="true" tabindex="-1"></a>**根据正则表达式拆分列**：</span>
<span id="cb133-516"><a href="#cb133-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-519"><a href="#cb133-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-520"><a href="#cb133-520" aria-hidden="true" tabindex="-1"></a>df_age <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb133-521"><a href="#cb133-521" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>str,</span>
<span id="cb133-522"><a href="#cb133-522" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;Sheryl&gt;-F_34"</span>,</span>
<span id="cb133-523"><a href="#cb133-523" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;Kisha&gt;-F_45"</span>, </span>
<span id="cb133-524"><a href="#cb133-524" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;Brandon&gt;-N_33"</span>,</span>
<span id="cb133-525"><a href="#cb133-525" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;Sharon&gt;-F_38"</span>, </span>
<span id="cb133-526"><a href="#cb133-526" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;Penny&gt;-F_58"</span>,</span>
<span id="cb133-527"><a href="#cb133-527" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;Justin&gt;-M_41"</span>, </span>
<span id="cb133-528"><a href="#cb133-528" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;Patricia&gt;-F_84"</span>, </span>
<span id="cb133-529"><a href="#cb133-529" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-530"><a href="#cb133-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-531"><a href="#cb133-531" aria-hidden="true" tabindex="-1"></a><span class="co"># 给予赋值的对象会被写入新列，其他字符会被删除</span></span>
<span id="cb133-532"><a href="#cb133-532" aria-hidden="true" tabindex="-1"></a>df_age <span class="sc">|&gt;</span> </span>
<span id="cb133-533"><a href="#cb133-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_regex</span>(</span>
<span id="cb133-534"><a href="#cb133-534" aria-hidden="true" tabindex="-1"></a>    str,</span>
<span id="cb133-535"><a href="#cb133-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">patterns =</span> <span class="fu">c</span>(</span>
<span id="cb133-536"><a href="#cb133-536" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;"</span>, </span>
<span id="cb133-537"><a href="#cb133-537" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">".+"</span>, </span>
<span id="cb133-538"><a href="#cb133-538" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&gt;-"</span>, </span>
<span id="cb133-539"><a href="#cb133-539" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender =</span> <span class="st">"."</span>,</span>
<span id="cb133-540"><a href="#cb133-540" aria-hidden="true" tabindex="-1"></a>      <span class="st">"_"</span>,</span>
<span id="cb133-541"><a href="#cb133-541" aria-hidden="true" tabindex="-1"></a>      <span class="at">age =</span> <span class="st">".+"</span></span>
<span id="cb133-542"><a href="#cb133-542" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb133-543"><a href="#cb133-543" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-544"><a href="#cb133-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-545"><a href="#cb133-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-546"><a href="#cb133-546" aria-hidden="true" tabindex="-1"></a><span class="fu">### `separate_wider_position()`</span></span>
<span id="cb133-547"><a href="#cb133-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-548"><a href="#cb133-548" aria-hidden="true" tabindex="-1"></a>拆分指定长度的字符构成新列：</span>
<span id="cb133-549"><a href="#cb133-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-552"><a href="#cb133-552" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-553"><a href="#cb133-553" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"202215TX"</span>, <span class="st">"202122LA"</span>, <span class="st">"202325CA"</span>)) </span>
<span id="cb133-554"><a href="#cb133-554" aria-hidden="true" tabindex="-1"></a>df4 <span class="sc">|&gt;</span> </span>
<span id="cb133-555"><a href="#cb133-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_position</span>(</span>
<span id="cb133-556"><a href="#cb133-556" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-557"><a href="#cb133-557" aria-hidden="true" tabindex="-1"></a>    <span class="at">widths =</span> <span class="fu">c</span>(<span class="at">year =</span> <span class="dv">4</span>, <span class="at">age =</span> <span class="dv">2</span>, <span class="at">state =</span> <span class="dv">2</span>)</span>
<span id="cb133-558"><a href="#cb133-558" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-559"><a href="#cb133-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-560"><a href="#cb133-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-561"><a href="#cb133-561" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb133-562"><a href="#cb133-562" aria-hidden="true" tabindex="-1"></a><span class="fu">### `separate_longer_delim()`</span></span>
<span id="cb133-563"><a href="#cb133-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-564"><a href="#cb133-564" aria-hidden="true" tabindex="-1"></a>将tibble中的某个字符列根据某个符号（<span class="in">`delim`</span>）拆分成几行：</span>
<span id="cb133-565"><a href="#cb133-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-568"><a href="#cb133-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-569"><a href="#cb133-569" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"a,b,c"</span>, <span class="st">"d,e"</span>, <span class="st">"f"</span>))</span>
<span id="cb133-570"><a href="#cb133-570" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb133-571"><a href="#cb133-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-572"><a href="#cb133-572" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">|&gt;</span> </span>
<span id="cb133-573"><a href="#cb133-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_longer_delim</span>(x, <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb133-574"><a href="#cb133-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-575"><a href="#cb133-575" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-576"><a href="#cb133-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-577"><a href="#cb133-577" aria-hidden="true" tabindex="-1"></a><span class="fu">### 拆分错误调试</span></span>
<span id="cb133-578"><a href="#cb133-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-579"><a href="#cb133-579" aria-hidden="true" tabindex="-1"></a>在使用 <span class="in">`separate_wider_delim()`</span> 时，如果需要拆分的字符串中某些字符根据指定分割符拆封后片段数不足，则会发生报错：</span>
<span id="cb133-580"><a href="#cb133-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-583"><a href="#cb133-583" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-584"><a href="#cb133-584" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"1-1-1"</span>, <span class="st">"1-1-2"</span>, <span class="st">"1-3"</span>, <span class="st">"1-3-2"</span>, <span class="st">"1"</span>))</span>
<span id="cb133-585"><a href="#cb133-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-586"><a href="#cb133-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-589"><a href="#cb133-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-590"><a href="#cb133-590" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb133-591"><a href="#cb133-591" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb133-592"><a href="#cb133-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-593"><a href="#cb133-593" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-594"><a href="#cb133-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-595"><a href="#cb133-595" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>)</span>
<span id="cb133-596"><a href="#cb133-596" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-597"><a href="#cb133-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-598"><a href="#cb133-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-599"><a href="#cb133-599" aria-hidden="true" tabindex="-1"></a><span class="in">``` md</span></span>
<span id="cb133-600"><a href="#cb133-600" aria-hidden="true" tabindex="-1"></a>Error in <span class="in">`separate_wider_delim()`</span>:</span>
<span id="cb133-601"><a href="#cb133-601" aria-hidden="true" tabindex="-1"></a>! Expected 3 pieces in each element of <span class="in">`x`</span>.</span>
<span id="cb133-602"><a href="#cb133-602" aria-hidden="true" tabindex="-1"></a>! 2 values were too short.</span>
<span id="cb133-603"><a href="#cb133-603" aria-hidden="true" tabindex="-1"></a>ℹ Use <span class="in">`too_few = "debug"`</span> to diagnose the problem.</span>
<span id="cb133-604"><a href="#cb133-604" aria-hidden="true" tabindex="-1"></a>ℹ Use <span class="in">`too_few = "align_start"/"align_end"`</span> to silence this message.</span>
<span id="cb133-605"><a href="#cb133-605" aria-hidden="true" tabindex="-1"></a>Run <span class="in">`rlang::last_trace()`</span> to see where the error occurred.</span>
<span id="cb133-606"><a href="#cb133-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-607"><a href="#cb133-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-608"><a href="#cb133-608" aria-hidden="true" tabindex="-1"></a>对于这种情况，可以手动检查数据问题，但是在实际应用中需要转换的字符列可能非常长，我们难以知道到底在哪一行出现了问题。这个时候，我们可以按照错误提示所说的那样，通过添加 <span class="in">`too_few = "debug"`</span> 参数来进入调试模式：</span>
<span id="cb133-609"><a href="#cb133-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-612"><a href="#cb133-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-613"><a href="#cb133-613" aria-hidden="true" tabindex="-1"></a>debug <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb133-614"><a href="#cb133-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-615"><a href="#cb133-615" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-616"><a href="#cb133-616" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-617"><a href="#cb133-617" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb133-618"><a href="#cb133-618" aria-hidden="true" tabindex="-1"></a>    <span class="at">too_few =</span> <span class="st">"debug"</span></span>
<span id="cb133-619"><a href="#cb133-619" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-620"><a href="#cb133-620" aria-hidden="true" tabindex="-1"></a>debug</span>
<span id="cb133-621"><a href="#cb133-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-622"><a href="#cb133-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-623"><a href="#cb133-623" aria-hidden="true" tabindex="-1"></a>使用调试模式时，输出的结果会多出三列：“x_ok”、“x_pieces” 和 “x_remainder”（前缀“x”是输入的变量名）：</span>
<span id="cb133-624"><a href="#cb133-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-625"><a href="#cb133-625" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>“x_ok”列：“TRUE”代表这一行能够被成功分割；而“FALSE”代表这一行分割失败。</span>
<span id="cb133-626"><a href="#cb133-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-627"><a href="#cb133-627" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>“x_pieces”列：告诉我们这一行能够被分割成多少片段。</span>
<span id="cb133-628"><a href="#cb133-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-629"><a href="#cb133-629" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>“x_remainder”列：在指定了 <span class="in">`too_many`</span> 参数时有用。它告诉我们每一行多出来的具体字符（见下文）。</span>
<span id="cb133-630"><a href="#cb133-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-631"><a href="#cb133-631" aria-hidden="true" tabindex="-1"></a>因此，利用“x_ok”我们可以方便的找出转换失败的行：</span>
<span id="cb133-632"><a href="#cb133-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-635"><a href="#cb133-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-636"><a href="#cb133-636" aria-hidden="true" tabindex="-1"></a>debug <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span>x_ok)</span>
<span id="cb133-637"><a href="#cb133-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-638"><a href="#cb133-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-639"><a href="#cb133-639" aria-hidden="true" tabindex="-1"></a>在发现了这些错误之处后，可以在原始数据中修复这些问题，然后重新运行 <span class="in">`separate_wider_delim()`</span> ，并确保删除 <span class="in">`too_few = "debug"`</span>。</span>
<span id="cb133-640"><a href="#cb133-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-641"><a href="#cb133-641" aria-hidden="true" tabindex="-1"></a>在其他情况下，我们可能想用 “NA” 填补缺失的部分。这就是 <span class="in">`too_few = "align_start"`</span> 和 <span class="in">`too_few = "align_end"`</span> 的作用，它们可以控制 “NA” 填充的位置（一般用 <span class="in">`"align_start"`</span>）：</span>
<span id="cb133-642"><a href="#cb133-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-645"><a href="#cb133-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-646"><a href="#cb133-646" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb133-647"><a href="#cb133-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-648"><a href="#cb133-648" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-649"><a href="#cb133-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-650"><a href="#cb133-650" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb133-651"><a href="#cb133-651" aria-hidden="true" tabindex="-1"></a>    <span class="at">too_few =</span> <span class="st">"align_start"</span></span>
<span id="cb133-652"><a href="#cb133-652" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-653"><a href="#cb133-653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-654"><a href="#cb133-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-655"><a href="#cb133-655" aria-hidden="true" tabindex="-1"></a>在上面这个案例中我们指定了 <span class="in">`too_few`</span> 参数，它告诉程序如何处理分割后片段数少于 <span class="in">`name`</span> 中所定义的新列数的情况，是debug还是用“NA”填充。另一种情况是指定 <span class="in">`too_many`</span> 参数，它告诉程序如何处理分割后片段数超出 <span class="in">`name`</span> 中所定义的新列数的情况，是debug（<span class="in">`too_many = "debug"`</span>）、舍弃（<span class="in">`too_many = "drop"`</span>），还是合并（<span class="in">`too_many = "merge"`</span>）多出来的片段。下面是一个案例：</span>
<span id="cb133-656"><a href="#cb133-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-659"><a href="#cb133-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-660"><a href="#cb133-660" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">"1-1-1"</span>, <span class="st">"1-1-2"</span>, <span class="st">"1-3-5-6"</span>, <span class="st">"1-3-2"</span>, <span class="st">"1-3-5-7-9"</span>))</span>
<span id="cb133-661"><a href="#cb133-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-662"><a href="#cb133-662" aria-hidden="true" tabindex="-1"></a>debug <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb133-663"><a href="#cb133-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-664"><a href="#cb133-664" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-665"><a href="#cb133-665" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-666"><a href="#cb133-666" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb133-667"><a href="#cb133-667" aria-hidden="true" tabindex="-1"></a>    <span class="at">too_many =</span> <span class="st">"debug"</span></span>
<span id="cb133-668"><a href="#cb133-668" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-669"><a href="#cb133-669" aria-hidden="true" tabindex="-1"></a>debug</span>
<span id="cb133-670"><a href="#cb133-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-671"><a href="#cb133-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-672"><a href="#cb133-672" aria-hidden="true" tabindex="-1"></a>我们同样可以通过“x_ok”列寻找转换失败的行。在定义 <span class="in">`too_many`</span> 的情况下，“x_remainder”就会发挥它的作用，这一列告诉我们每一行超出来的具体字符。</span>
<span id="cb133-673"><a href="#cb133-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-674"><a href="#cb133-674" aria-hidden="true" tabindex="-1"></a>接下来我们可以决定如何处理超出来的片段：</span>
<span id="cb133-675"><a href="#cb133-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-678"><a href="#cb133-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-679"><a href="#cb133-679" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除超出的片段</span></span>
<span id="cb133-680"><a href="#cb133-680" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb133-681"><a href="#cb133-681" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-682"><a href="#cb133-682" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-683"><a href="#cb133-683" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-684"><a href="#cb133-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb133-685"><a href="#cb133-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">too_many =</span> <span class="st">"drop"</span></span>
<span id="cb133-686"><a href="#cb133-686" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-687"><a href="#cb133-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-688"><a href="#cb133-688" aria-hidden="true" tabindex="-1"></a><span class="co"># 合并超出的片段</span></span>
<span id="cb133-689"><a href="#cb133-689" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb133-690"><a href="#cb133-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb133-691"><a href="#cb133-691" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb133-692"><a href="#cb133-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">"-"</span>,</span>
<span id="cb133-693"><a href="#cb133-693" aria-hidden="true" tabindex="-1"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>),</span>
<span id="cb133-694"><a href="#cb133-694" aria-hidden="true" tabindex="-1"></a>    <span class="at">too_many =</span> <span class="st">"merge"</span></span>
<span id="cb133-695"><a href="#cb133-695" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-696"><a href="#cb133-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-697"><a href="#cb133-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-698"><a href="#cb133-698" aria-hidden="true" tabindex="-1"></a><span class="fu"># 计算字符长度</span></span>
<span id="cb133-699"><a href="#cb133-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-700"><a href="#cb133-700" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-03-07%2018.30.01.png)</span>{width="440"}</span>
<span id="cb133-701"><a href="#cb133-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-702"><a href="#cb133-702" aria-hidden="true" tabindex="-1"></a><span class="in">`str_length()`</span> 可以返回字符串中每一个字符的长度（空格算一个字符）：</span>
<span id="cb133-703"><a href="#cb133-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-706"><a href="#cb133-706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-707"><a href="#cb133-707" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"R for data science"</span>, <span class="cn">NA</span>))</span>
<span id="cb133-708"><a href="#cb133-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-709"><a href="#cb133-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-710"><a href="#cb133-710" aria-hidden="true" tabindex="-1"></a>下面我们用“babynames”数据集，来演示如何利用 <span class="in">`str_length()`</span> + <span class="in">`count()`</span>，来统计婴儿名字长度的分布情况，然后使用 <span class="in">`Filter()`</span> 来查看最长的名字：</span>
<span id="cb133-711"><a href="#cb133-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-714"><a href="#cb133-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-715"><a href="#cb133-715" aria-hidden="true" tabindex="-1"></a>babynames</span>
<span id="cb133-716"><a href="#cb133-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-717"><a href="#cb133-717" aria-hidden="true" tabindex="-1"></a>babynames <span class="sc">|&gt;</span></span>
<span id="cb133-718"><a href="#cb133-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">length =</span> <span class="fu">str_length</span>(name), <span class="at">wt =</span> n)</span>
<span id="cb133-719"><a href="#cb133-719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-720"><a href="#cb133-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-721"><a href="#cb133-721" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution collapse="true"}</span>
<span id="cb133-722"><a href="#cb133-722" aria-hidden="true" tabindex="-1"></a><span class="fu">###### 注意 `count()` 中的 `wt`[（加权）参数](/r_basic/vector_transform.qmd#sec-wt)</span></span>
<span id="cb133-723"><a href="#cb133-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-724"><a href="#cb133-724" aria-hidden="true" tabindex="-1"></a>如果不指定该参数，那么 <span class="in">`count()`</span> 返回的计算结果将是各个长度的名字在该表格中的计数（行数），但是该表格不是一个婴儿一行，而是在 “n” 列中提供了每一个姓名下的婴儿总数，所以需要用这个数字来对计数进行加权。</span>
<span id="cb133-725"><a href="#cb133-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-728"><a href="#cb133-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-729"><a href="#cb133-729" aria-hidden="true" tabindex="-1"></a><span class="co"># 和上表对比</span></span>
<span id="cb133-730"><a href="#cb133-730" aria-hidden="true" tabindex="-1"></a>babynames <span class="sc">|&gt;</span></span>
<span id="cb133-731"><a href="#cb133-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">length =</span> <span class="fu">str_length</span>(name))</span>
<span id="cb133-732"><a href="#cb133-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-733"><a href="#cb133-733" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb133-734"><a href="#cb133-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-737"><a href="#cb133-737" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-738"><a href="#cb133-738" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看最长的名字</span></span>
<span id="cb133-739"><a href="#cb133-739" aria-hidden="true" tabindex="-1"></a>babynames <span class="sc">|&gt;</span> </span>
<span id="cb133-740"><a href="#cb133-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_length</span>(name) <span class="sc">==</span> <span class="fu">max</span>(<span class="fu">str_length</span>(name))) <span class="sc">|&gt;</span> </span>
<span id="cb133-741"><a href="#cb133-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(name, <span class="at">wt =</span> n, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb133-742"><a href="#cb133-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-743"><a href="#cb133-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-744"><a href="#cb133-744" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb133-745"><a href="#cb133-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-746"><a href="#cb133-746" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true" icon="false"}</span>
<span id="cb133-747"><a href="#cb133-747" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Info</span></span>
<span id="cb133-748"><a href="#cb133-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-751"><a href="#cb133-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb133-752"><a href="#cb133-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb133-753"><a href="#cb133-753" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb133-754"><a href="#cb133-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb133-755"><a href="#cb133-755" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
 This website was built with Quarto
  </li>  
</ul>
</div>   
    <div class="nav-footer-center">
<p>Copyright 2024, Du Junhong</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/djhcod/r-notes/blob/main/r_basic/stringr.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/djhcod/r-notes/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/djhcod">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>