<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>R语言学习笔记：从数据清洗到高级统计学和生物信息学 - Seurat常用函数清单</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../single_cell/seurat/seurat_tutorial.html" rel="next">
<link href="../../single_cell/seurat/seurat_intro.html" rel="prev">
<link href="../../images/logo.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G2HZEXHNCE"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-G2HZEXHNCE', { 'anonymize_ip': true});
</script><script type="application/json" class="js-hypothesis-config">
{
  "theme": "classic",
  "openSidebar": false,
  "showHighlights": "always",
  "enableExperimentalNewNoteButton": true
}
</script><script async="" src="https://hypothes.is/embed.js"></script>
<meta property="og:title" content="R语言学习笔记：从数据清洗到高级统计学和生物信息学 - Seurat常用函数清单">
<meta property="og:description" content="">
<meta property="og:image" content="https://djhcod.github.io/r-notes/single_cell/seurat/seurat_command_list_files/figure-html/unnamed-chunk-3-1.png">
<meta property="og:site-name" content="R语言学习笔记：从数据清洗到高级统计学和生物信息学">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="R语言学习笔记：从数据清洗到高级统计学和生物信息学 - Seurat常用函数清单">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://djhcod.github.io/r-notes/single_cell/seurat/seurat_command_list_files/figure-html/unnamed-chunk-3-1.png">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/logo.jpg" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">R语言学习笔记</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link active" href="../../index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../r_basic/r_basics.html" rel="" target="">
 <span class="menu-text">R语言基础</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">单细胞数据分析</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-">
<li>
    <a class="dropdown-item" href="../../single_cell/single_cell_intro.html" rel="" target="">
 <span class="dropdown-text">单细胞数据分析介绍</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../single_cell/seurat/seurat_intro.html" rel="" target="">
 <span class="dropdown-text">Seurat v5官方文档</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../single_cell/scRNA-seq_online/00_intro.html" rel="" target="">
 <span class="dropdown-text">scRNA-seq_online学习材料</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../single_cell/sc_supplementary/sc_supplementary_intro.html" rel="" target="">
 <span class="dropdown-text">单细胞补充内容</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="../../quarto_foundation/quarto_foundation.html" rel="" target="">
 <span class="menu-text">Quarto基础</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="https://bookdown.org" rel="" target=""><i class="bi bi-book-fill" role="img">
</i> 
 <span class="menu-text">Bookdown</span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/djhcod/r-notes" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../single_cell/single_cell_intro.html">单细胞数据分析</a></li><li class="breadcrumb-item"><a href="../../single_cell/seurat/seurat_intro.html">Seurat v5官方文档</a></li><li class="breadcrumb-item"><a href="../../single_cell/seurat/seurat_command_list.html">Seurat常用函数清单</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">主页</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../r_basic/r_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R语言基础</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r_basic/environment_configuration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Rstudio环境配置</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r_basic/data_input_output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据的读取与输出</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r_basic/basic_data_function.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据处理基本函数</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r_basic/dplyr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基于dplyr包的数据处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r_basic/character.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">字符的处理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../r_basic/loop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">循环</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../single_cell/single_cell_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞数据分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞测序技术介绍</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/generation_of_count_matrix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞RNA测序—从raw data到count matrix</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../single_cell/seurat/seurat_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat v5官方文档</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/seurat_command_list.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Seurat常用函数清单</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/seurat_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat细胞分群官方教程</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/data_visualization_methods_in_seurat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat中的数据可视化方法</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/sctransform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基于SCTransform的单细胞数据标准化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/cell_cycle_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">消除细胞周期的影响</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">整合（integration）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/integrative_analysis_in_seurat_v5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seurat v5单细胞数据整合分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/marker_gene_identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">寻找marker gene</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/de_vignette.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">寻找不同样本类型间同一细胞类型内的差异基因</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/seurat/mapping_and_annotating_query_datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基于参考集的细胞注释</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../single_cell/scRNA-seq_online/00_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">scRNA-seq_online学习材料</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/03_SC_quality_control-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数据导入与Seurat对象构建</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/04_SC_quality_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">质控</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/postQC_workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Single-cell RNA-seq Clustering Workflow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/05_theory_of_PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PCA原理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/06_SC_SCT_normalization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Normalization and regressing out unwanted variation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/06_integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞数据整合（Integration）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/07_SC_clustering_cells_SCT.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">细胞聚类（clustering analysis）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/08_SC_clustering_quality_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">细胞分群质量评估</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/scRNA-seq_online/09_merged_SC_marker_identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">寻找marker基因+细胞注释</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../single_cell/sc_supplementary/sc_supplementary_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">单细胞补充内容</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/sc_supplementary/read_sc_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">读取非标准格式的单细胞数据</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/sc_supplementary/universal_marker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">细胞分群通用marker</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/sc_supplementary/integrated_analysis_multiple_single_cell_datasets_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">多个单细胞数据集整合分析（上）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/sc_supplementary/integrated_analysis_multiple_single_cell_datasets_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">多个单细胞数据集整合分析（下）</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../single_cell/sc_supplementary/DecontX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">预测和去除单细胞转录组的环境游离RNA污染</span></a>
  </div>
</li>
      </ul>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../quarto_foundation/quarto_foundation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto基础</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto_foundation/yaml_settings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">YAML设置</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto_foundation/images_settings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">图片设置</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto_foundation/cross_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">交叉引用</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto_foundation/insert_other_content.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">插入其他内容</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto_foundation/quarto_shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">在Quarto中嵌入Shiny应用程序</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto_foundation/quarto_books.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto Books</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto_foundation/github_pages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">发布到GitHub Pages</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#%E6%A0%87%E5%87%86seurat%E6%B5%81%E7%A8%8B%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0" id="toc-标准seurat流程基本函数" class="nav-link active" data-scroll-target="#%E6%A0%87%E5%87%86seurat%E6%B5%81%E7%A8%8B%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0"><span class="header-section-number">1</span> 标准Seurat流程基本函数</a>
  <ul class="collapse">
<li><a href="#%E9%87%87%E7%94%A8sctransform%E6%A0%87%E5%87%86%E5%8C%96%E6%97%B6%E7%9A%84%E6%B5%81%E7%A8%8B" id="toc-采用sctransform标准化时的流程" class="nav-link" data-scroll-target="#%E9%87%87%E7%94%A8sctransform%E6%A0%87%E5%87%86%E5%8C%96%E6%97%B6%E7%9A%84%E6%B5%81%E7%A8%8B">采用<code>SCtransform</code>标准化时的流程：</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%8F%90%E5%8F%96seurat%E5%AF%B9%E8%B1%A1%E5%86%85%E7%9A%84%E5%90%84%E6%95%B0%E6%8D%AE" id="toc-提取seurat对象内的各数据" class="nav-link" data-scroll-target="#%E6%8F%90%E5%8F%96seurat%E5%AF%B9%E8%B1%A1%E5%86%85%E7%9A%84%E5%90%84%E6%95%B0%E6%8D%AE"><span class="header-section-number">2</span> 提取<code>Seurat</code>对象内的各数据</a>
  <ul class="collapse">
<li><a href="#%E8%8E%B7%E5%8F%96%E7%BB%86%E8%83%9E%E5%9F%BA%E5%9B%A0assayslayers%E5%90%8D%E7%A7%B0" id="toc-获取细胞基因assayslayers名称" class="nav-link" data-scroll-target="#%E8%8E%B7%E5%8F%96%E7%BB%86%E8%83%9E%E5%9F%BA%E5%9B%A0assayslayers%E5%90%8D%E7%A7%B0">获取细胞、基因、assays、layers名称</a></li>
  <li><a href="#%E8%8E%B7%E5%8F%96%E7%BB%86%E8%83%9E%E6%B3%A8%E9%87%8A%E4%BF%A1%E6%81%AFcell-identities" id="toc-获取细胞注释信息cell-identities" class="nav-link" data-scroll-target="#%E8%8E%B7%E5%8F%96%E7%BB%86%E8%83%9E%E6%B3%A8%E9%87%8A%E4%BF%A1%E6%81%AFcell-identities">获取细胞注释信息（cell identities）</a></li>
  <li><a href="#%E8%8E%B7%E5%8F%96meta.data" id="toc-获取meta.data" class="nav-link" data-scroll-target="#%E8%8E%B7%E5%8F%96meta.data">获取meta.data</a></li>
  <li><a href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E8%BE%BE%E9%87%8F%E4%BF%A1%E6%81%AF-stored-as-layers-in-seurat-v5" id="toc-获取表达量信息-stored-as-layers-in-seurat-v5" class="nav-link" data-scroll-target="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E8%BE%BE%E9%87%8F%E4%BF%A1%E6%81%AF-stored-as-layers-in-seurat-v5">获取表达量信息 (stored as layers in Seurat v5)</a></li>
  <li><a href="#%E8%8E%B7%E5%8F%96pca%E9%99%8D%E7%BB%B4%E4%BF%A1%E6%81%AF" id="toc-获取pca降维信息" class="nav-link" data-scroll-target="#%E8%8E%B7%E5%8F%96pca%E9%99%8D%E7%BB%B4%E4%BF%A1%E6%81%AF">获取PCA降维信息</a></li>
  <li><a href="#%E9%80%9A%E8%BF%87fetchdata%E4%BB%8Eseurat%E5%AF%B9%E8%B1%A1%E4%B8%AD%E8%8E%B7%E5%8F%96%E4%BB%BB%E6%84%8F%E4%BF%A1%E6%81%AF" id="toc-通过fetchdata从seurat对象中获取任意信息" class="nav-link" data-scroll-target="#%E9%80%9A%E8%BF%87fetchdata%E4%BB%8Eseurat%E5%AF%B9%E8%B1%A1%E4%B8%AD%E8%8E%B7%E5%8F%96%E4%BB%BB%E6%84%8F%E4%BF%A1%E6%81%AF">通过<code>FetchData</code>从Seurat对象中获取任意信息</a></li>
  </ul>
</li>
  <li>
<a href="#seurat%E5%AF%B9%E8%B1%A1%E5%8F%96%E5%AD%90%E9%9B%86%E5%92%8C%E5%90%88%E5%B9%B6" id="toc-seurat对象取子集和合并" class="nav-link" data-scroll-target="#seurat%E5%AF%B9%E8%B1%A1%E5%8F%96%E5%AD%90%E9%9B%86%E5%92%8C%E5%90%88%E5%B9%B6"><span class="header-section-number">3</span> Seurat对象取子集和合并</a>
  <ul class="collapse">
<li><a href="#sec-subset_seurat" id="toc-sec-subset_seurat" class="nav-link" data-scroll-target="#sec-subset_seurat">取子集</a></li>
  <li><a href="#%E5%88%86%E5%89%B2layers" id="toc-分割layers" class="nav-link" data-scroll-target="#%E5%88%86%E5%89%B2layers">分割layers</a></li>
  <li><a href="#%E5%88%86%E5%89%B2seurat" id="toc-分割seurat" class="nav-link" data-scroll-target="#%E5%88%86%E5%89%B2seurat">分割Seurat</a></li>
  <li><a href="#merge-objects-without-integration" id="toc-merge-objects-without-integration" class="nav-link" data-scroll-target="#merge-objects-without-integration">Merge objects (without integration)</a></li>
  <li><a href="#merge-objects-with-integration" id="toc-merge-objects-with-integration" class="nav-link" data-scroll-target="#merge-objects-with-integration">Merge objects (with integration)</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/djhcod/r-notes/blob/main/single_cell/seurat/seurat_command_list.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/djhcod/r-notes/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Seurat常用函数清单</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><blockquote class="blockquote">
<p>原文：<a href="https://satijalab.org/seurat/articles/essential_commands"><em>Seurat Command List</em></a></p>
<p>原文发布日期：2023年10月31日</p>
</blockquote>
<p>为了演示各函数的效果，这里的案例数据选取了在<a href="../../single_cell/seurat/seurat_tutorial.html">Seurat细胞分群官方教程</a>中用到的包含了2700个细胞的外周血单核细胞数据（<code>pbmc</code>）。数据可在<a href="https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz">此链接</a>下载。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-1_217afc1ad7dd2191ba982031b32d7462">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat">Seurat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 读取PBMC数据集</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/Read10X.html">Read10X</a></span><span class="op">(</span>data.dir <span class="op">=</span> <span class="st">"data/seurat_official/filtered_gene_bc_matrices/hg19"</span><span class="op">)</span></span>
<span><span class="co"># Initialize the Seurat object with the raw (non-normalized data).</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/CreateSeuratObject.html">CreateSeuratObject</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">counts</span>, </span>
<span>                           project <span class="op">=</span> <span class="st">"pbmc3k"</span>, </span>
<span>                           min.cells <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                           min.features <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">pbmc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
13714 features across 2700 samples within 1 assay 
Active assay: RNA (13714 features, 0 variable features)
 1 layer present: counts</code></pre>
</div>
</div>
<hr>
<section id="标准seurat流程基本函数" class="level2" data-number="1"><h2 data-number="1" class="anchored" data-anchor-id="标准seurat流程基本函数">
<span class="header-section-number">1</span> 标准Seurat流程基本函数</h2>
<p>见<a href="../../single_cell/seurat/seurat_tutorial.html">Seurat细胞分群官方教程</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-2_f972ba04b4f3c06120e3bd4c32e7c358">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html">NormalizeData</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html">FindNeighbors</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html">FindClusters</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, reduction <span class="op">=</span> <span class="st">"umap"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="采用sctransform标准化时的流程" class="level3"><h3 class="anchored" data-anchor-id="采用sctransform标准化时的流程">采用<code>SCtransform</code>标准化时的流程：</h3>
<p>详见<a href="../../single_cell/seurat/sctransform.html">基于SCTransform的单细胞数据标准化</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-3_94829bdebb7cdd258023c347f0d18034">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SCTransform.html">SCTransform</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html">FindNeighbors</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html">FindClusters</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html">DimPlot</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, reduction <span class="op">=</span> <span class="st">"umap"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="seurat_command_list_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>或者通过管道函数：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-4_692af08eadcd5aeeef7930c94f4cb34e">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SCTransform.html">SCTransform</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html">FindNeighbors</a></span><span class="op">(</span>dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html">FindClusters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html">RunUMAP</a></span><span class="op">(</span>dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr></section></section><section id="提取seurat对象内的各数据" class="level2" data-number="2"><h2 data-number="2" class="anchored" data-anchor-id="提取seurat对象内的各数据">
<span class="header-section-number">2</span> 提取<code>Seurat</code>对象内的各数据</h2>
<section id="获取细胞基因assayslayers名称" class="level3"><h3 class="anchored" data-anchor-id="获取细胞基因assayslayers名称">获取细胞、基因、assays、layers名称</h3>
<section id="获取细胞的barcode" class="level4"><h4 class="anchored" data-anchor-id="获取细胞的barcode">获取细胞的barcode：</h4>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-5_df7d5228c2b22455ec7fffe44c97c73e">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AAACATACAACCAC-1" "AAACATTGAGCTAC-1" "AAACATTGATCAGC-1" "AAACCGTGCTTCCG-1"
 [5] "AAACCGTGTATGCG-1" "AAACGCACTGGTAC-1" "AAACGCTGACCAGT-1" "AAACGCTGGTTCTT-1"
 [9] "AAACGCTGTAGCCA-1" "AAACGCTGTTTCTG-1"</code></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Cells.html">Cells</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="co"># 效果同上</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AAACATACAACCAC-1" "AAACATTGAGCTAC-1" "AAACATTGATCAGC-1" "AAACCGTGCTTCCG-1"
 [5] "AAACCGTGTATGCG-1" "AAACGCACTGGTAC-1" "AAACGCTGACCAGT-1" "AAACGCTGGTTCTT-1"
 [9] "AAACGCTGTAGCCA-1" "AAACGCTGTTTCTG-1"</code></pre>
</div>
</div>
</section><section id="获取基因feature名" class="level4"><h4 class="anchored" data-anchor-id="获取基因feature名">获取基因（feature）名。</h4>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-6_f28768d402e068f1b8ad9436b352014e">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Cells.html">Features</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AL627309.1"    "RP11-206L10.2" "LINC00115"     "NOC2L"        
 [5] "KLHL17"        "PLEKHN1"       "HES4"          "ISG15"        
 [9] "AGRN"          "C1orf159"     </code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="co"># 同上</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AL627309.1"    "RP11-206L10.2" "LINC00115"     "NOC2L"        
 [5] "KLHL17"        "PLEKHN1"       "HES4"          "ISG15"        
 [9] "AGRN"          "C1orf159"     </code></pre>
</div>
</div>
<p>可以指定提取哪一个assay下的基因名，如果未指定，则提取默认assay内的基因名。这里的pbmc数据经过了<strong><code>SCTransform</code>，</strong>所以有两个assay，默认的归一化之后的“SCT”assay，另一个是原始的“RNA”assay。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-7_7cf1b431be77e279dd9589ceef74c4a8">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 获取“SCT” assay下的基因名</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Cells.html">Features</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"SCT"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AL627309.1"    "RP11-206L10.2" "LINC00115"     "NOC2L"        
 [5] "KLHL17"        "PLEKHN1"       "HES4"          "ISG15"        
 [9] "AGRN"          "C1orf159"     </code></pre>
</div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 获取“RNA” assay下的基因名</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Cells.html">Features</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AL627309.1"    "AP006222.2"    "RP11-206L10.2" "RP11-206L10.9"
 [5] "LINC00115"     "NOC2L"         "KLHL17"        "PLEKHN1"      
 [9] "RP11-54O7.17"  "HES4"         </code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 或</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Cells.html">Features</a></span><span class="op">(</span><span class="va">pbmc</span>, assay <span class="op">=</span> <span class="st">"RNA"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AL627309.1"    "AP006222.2"    "RP11-206L10.2" "RP11-206L10.9"
 [5] "LINC00115"     "NOC2L"         "KLHL17"        "PLEKHN1"      
 [9] "RP11-54O7.17"  "HES4"         </code></pre>
</div>
</div>
<p>也可以通过添加<code>layer</code>参数，提取指定layer下的基因名：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-8_e14e41f143213edc0d00224c72156178">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 提取“counts” layer下的基因名</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Cells.html">Features</a></span><span class="op">(</span><span class="va">pbmc</span>, layer <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "AL627309.1"    "RP11-206L10.2" "LINC00115"     "NOC2L"        
 [5] "KLHL17"        "PLEKHN1"       "HES4"          "ISG15"        
 [9] "AGRN"          "C1orf159"     </code></pre>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 提取"scale.data"的基因名</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Cells.html">Features</a></span><span class="op">(</span><span class="va">pbmc</span>, layer <span class="op">=</span> <span class="st">"scale.data"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "NOC2L"    "HES4"     "ISG15"    "TNFRSF18" "TNFRSF4"  "CPSF3L"  
 [7] "MRPL20"   "ATAD3C"   "SSU72"    "MIB2"    </code></pre>
</div>
</div>
</section><section id="获取细胞和基因的数量" class="level4"><h4 class="anchored" data-anchor-id="获取细胞和基因的数量">获取细胞和基因的数量：</h4>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-9_610ec13b41435fb90a1b5c83f775d355">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="co"># 细胞数量</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2700</code></pre>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="co"># 基因（feature）数量</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12572</code></pre>
</div>
</div>
</section><section id="获取高变基因列表" class="level4"><h4 class="anchored" data-anchor-id="获取高变基因列表">获取高变基因列表</h4>
<p>详见<a href="../../single_cell/seurat/seurat_tutorial.html#sec-highly_variable_features">识别高变基因（highly variable features）</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-10_7b088c185245ba8a1b1e185c5cc71f35">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/VariableFeatures.html">VariableFeatures</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "S100A9" "GNLY"   "LYZ"    "S100A8" "NKG7"   "FTL"    "GZMB"   "IGLL5" 
 [9] "FTH1"   "CCL5"  </code></pre>
</div>
</div>
</section><section id="列出layers" class="level4"><h4 class="anchored" data-anchor-id="列出layers">列出layers</h4>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-11_890fd2d20743d1e0e9ccb9e217948bd8">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 列出所有的layers</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Layers.html">Layers</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "counts"     "data"       "scale.data"</code></pre>
</div>
</div>
</section><section id="获取设定assay" class="level4"><h4 class="anchored" data-anchor-id="获取设定assay">获取/设定assay：</h4>
<p>列出所有的assay，如”RNA” assay、运行<code>SCTransform</code>之后的”SCT” assay。一个Seurat对象可以包括多个assay对象，但是在某个时刻，只有一个assay对象是默认激活的。</p>
<p>实际应用场景见<a href="../../single_cell/seurat/marker_gene_identification.html#sec-findmarkers_function">此章节</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-12_434a2441beee1219cabc08b7a9aa099b">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 列出所有的assay</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/ObjectAccess.html">Assays</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RNA" "SCT"</code></pre>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 获取目前的默认assay名称</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/DefaultAssay.html">DefaultAssay</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SCT"</code></pre>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 设定默认assay</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/DefaultAssay.html">DefaultAssay</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"RNA"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/DefaultAssay.html">DefaultAssay</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"SCT"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="转换不同版本的seurat对象" class="level4"><h4 class="anchored" data-anchor-id="转换不同版本的seurat对象">转换不同版本的Seurat对象：</h4>
<p>上面我们使用的pbmc对象使用V5版本的Seurat包创建的，可以通过如下命令查看：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-13_fe1eecaef931e70c8839ba35898741aa">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 查看Seurat对象是用哪个版本的Seurat包创建的</span></span>
<span><span class="va">pbmc</span><span class="op">@</span><span class="va">version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '5.0.1'</code></pre>
</div>
</div>
<p>这里我们导入在<a href="../../single_cell/scRNA-seq_online/07_SC_clustering_cells_SCT.html#sec-Load_case_data">后续章节</a>中用到的案例数据，这个Seurat对象是使用V4版本的<code>Seurat</code>包创建的。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-14_ce427ca3ced55160906d34436231921f">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">bzfile</a></span><span class="op">(</span><span class="st">"data/scRNA-seq_online/additional_data/seurat_integrated.RData.bz2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seurat_integrated</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
31130 features across 29629 samples within 3 assays 
Active assay: integrated (3000 features, 3000 variable features)
 2 layers present: data, scale.data
 2 other assays present: RNA, SCT
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">seurat_integrated</span><span class="op">@</span><span class="va">version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '4.1.0'</code></pre>
</div>
</div>
<p><img src="images/截屏2024-01-15 19.49.57.png" class="img-fluid"></p>
<p>可以看到，这个seurat_integrated对象的“RNA” assay没有layers结构，是典型的V5版本之前的Seurat对象的结构。我们可以通过as()函数将V4或V3版本的“RNA” assay转换成V5版本的“RNA” assay：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-15_77cb9f5115cf50858a70bc46037217dc">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># convert a v4 or v3 assay to a v5 assay</span></span>
<span><span class="va">seurat_integrated</span><span class="op">[[</span><span class="st">"RNA5"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">seurat_integrated</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                                  Class <span class="op">=</span> <span class="st">"Assay5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/DefaultAssay.html">DefaultAssay</a></span><span class="op">(</span><span class="va">seurat_integrated</span><span class="op">)</span> <span class="op">=</span> <span class="st">"RNA5"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/截屏2024-01-15 19.54.40.png" class="img-fluid"></p>
<p>转换后seurat_integrated[[“RNA5”]]里面是V5版的Seurat结构。如果不想要原来的“RNA” assay可以将其删除：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-16_a461e659602d9db7e6a89601337c2cc8">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">seurat_integrated</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>也可以将V5版本的“RNA” assay转换成V4或V3版本的“RNA” assay：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-17_413b66079b92bcfacd458e7bd8a20a02">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># convert a v5 assay to a v4 or v3 assay</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA3"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html">as</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span>, Class <span class="op">=</span> <span class="st">"Assay"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/截屏2024-01-15 20.01.30.png" class="img-fluid"></p>
</section></section><section id="获取细胞注释信息cell-identities" class="level3"><h3 class="anchored" data-anchor-id="获取细胞注释信息cell-identities">获取细胞注释信息（cell identities）</h3>
<section id="查看cell-identities" class="level4"><h4 class="anchored" data-anchor-id="查看cell-identities">查看cell identities：</h4>
<p>即<strong>细胞的类型</strong>，在Seurat对象中，细胞可能有好几种不同方法注释的类型，但是在某一时刻，只有一种细胞类型是默认激活的。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-18_ef2356ab7a3add763984f5bbe139ae59">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 AAACCGTGCTTCCG-1 
               4                2                0                5 
AAACCGTGTATGCG-1 
               6 
Levels: 0 1 2 3 4 5 6 7 8 9 10 11 12</code></pre>
</div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1   2   3   4   5   6   7   8   9  10  11  12 
491 485 361 316 229 182 157 153 138 100  42  34  12 </code></pre>
</div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 查看目前cell identities的水平</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "0"  "1"  "2"  "3"  "4"  "5"  "6"  "7"  "8"  "9"  "10" "11" "12"</code></pre>
</div>
</div>
</section><section id="设定细胞identities" class="level4"><h4 class="anchored" data-anchor-id="设定细胞identities">设定细胞identities：</h4>
<p>实际应用场景见<a href="../../single_cell/seurat/marker_gene_identification.html#sec-findmarkers_function">后续章节</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-19_8e1fab86ca57b78cd10775fe9048d2ed">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 将meta.data中的"seurat_clusters"列设置为cell identities</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"seurat_clusters"</span></span>
<span></span>
<span><span class="co"># 重命名细胞注释标签或重新排序细胞类型标签</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>, </span>
<span>                       levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>,</span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pDC"</span>, <span class="st">"Mk"</span>, <span class="st">"DC"</span>, <span class="st">"CD14 Mono"</span>, <span class="st">"CD16 Mono"</span>, </span>
<span>                                  <span class="st">"B Activated"</span>, <span class="st">"B"</span>, <span class="st">"CD8 T"</span>, <span class="st">"NK"</span>, <span class="st">"T activated"</span>, </span>
<span>                                  <span class="st">"CD4 Naive T"</span>, <span class="st">"CD4 Memory T"</span>, <span class="st">"epi"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] CD16 Mono    DC           pDC          B Activated  B           
 [6] CD8 T        Mk           CD14 Mono    T activated  CD4 Naive T 
[11] CD4 Memory T NK           epi         
13 Levels: pDC Mk DC CD14 Mono CD16 Mono B Activated B CD8 T NK ... epi</code></pre>
</div>
</div>
<p>将目前的cell identities保存到meta.data新的一列中：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-20_b6734e5b14c102fd0684d3d5e82a2d83">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 将目前的cell identities储存到meta.data的"old.ident"列中</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"old.ident"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>重命名某个cell identities：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-21_cf24868eeda694fff77de6cd0db554ab">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">RenameIdents</a></span><span class="op">(</span><span class="va">pbmc</span>, </span>
<span>                     <span class="st">"B"</span> <span class="op">=</span> <span class="st">"B cell"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html">Idents</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] CD16 Mono    DC           pDC          B Activated  B cell      
 [6] CD8 T        Mk           CD14 Mono    T activated  CD4 Naive T 
[11] CD4 Memory T NK           epi         
13 Levels: B cell pDC Mk DC CD14 Mono CD16 Mono B Activated CD8 T ... epi</code></pre>
</div>
</div>
</section></section><section id="获取meta.data" class="level3"><h3 class="anchored" data-anchor-id="获取meta.data">获取meta.data</h3>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-22_7149756d0df88e88ddef6ada31e0bce2">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># View metadata data frame, stored in object@meta.data</span></span>
<span><span class="va">pbmc</span><span class="op">@</span><span class="va">meta.data</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 orig.ident nCount_RNA nFeature_RNA nCount_SCT nFeature_SCT
AAACATACAACCAC-1     pbmc3k       2419          779       2275          769
AAACATTGAGCTAC-1     pbmc3k       4903         1352       2597         1126
AAACATTGATCAGC-1     pbmc3k       3147         1129       2469         1111
AAACCGTGCTTCCG-1     pbmc3k       2639          960       2343          942
AAACCGTGTATGCG-1     pbmc3k        980          521       1901          551
AAACGCACTGGTAC-1     pbmc3k       2163          781       2148          767
                 SCT_snn_res.0.8 seurat_clusters nCount_RNA3 nFeature_RNA3
AAACATACAACCAC-1               4               4        2419           779
AAACATTGAGCTAC-1               2               2        4903          1352
AAACATTGATCAGC-1               0               0        3147          1129
AAACCGTGCTTCCG-1               5               5        2639           960
AAACCGTGTATGCG-1               6               6         980           521
AAACGCACTGGTAC-1               0               0        2163           781
                   old.ident
AAACATACAACCAC-1   CD16 Mono
AAACATTGAGCTAC-1          DC
AAACATTGATCAGC-1         pDC
AAACCGTGCTTCCG-1 B Activated
AAACCGTGTATGCG-1           B
AAACGCACTGGTAC-1         pDC</code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 或</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 orig.ident nCount_RNA nFeature_RNA nCount_SCT nFeature_SCT
AAACATACAACCAC-1     pbmc3k       2419          779       2275          769
AAACATTGAGCTAC-1     pbmc3k       4903         1352       2597         1126
AAACATTGATCAGC-1     pbmc3k       3147         1129       2469         1111
AAACCGTGCTTCCG-1     pbmc3k       2639          960       2343          942
AAACCGTGTATGCG-1     pbmc3k        980          521       1901          551
AAACGCACTGGTAC-1     pbmc3k       2163          781       2148          767
                 SCT_snn_res.0.8 seurat_clusters nCount_RNA3 nFeature_RNA3
AAACATACAACCAC-1               4               4        2419           779
AAACATTGAGCTAC-1               2               2        4903          1352
AAACATTGATCAGC-1               0               0        3147          1129
AAACCGTGCTTCCG-1               5               5        2639           960
AAACCGTGTATGCG-1               6               6         980           521
AAACGCACTGGTAC-1               0               0        2163           781
                   old.ident
AAACATACAACCAC-1   CD16 Mono
AAACATTGAGCTAC-1          DC
AAACATTGATCAGC-1         pDC
AAACCGTGCTTCCG-1 B Activated
AAACCGTGTATGCG-1           B
AAACGCACTGGTAC-1         pDC</code></pre>
</div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 如果是展示前6行的话也可以直接这样写：</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 orig.ident nCount_RNA nFeature_RNA nCount_SCT nFeature_SCT
AAACATACAACCAC-1     pbmc3k       2419          779       2275          769
AAACATTGAGCTAC-1     pbmc3k       4903         1352       2597         1126
AAACATTGATCAGC-1     pbmc3k       3147         1129       2469         1111
AAACCGTGCTTCCG-1     pbmc3k       2639          960       2343          942
AAACCGTGTATGCG-1     pbmc3k        980          521       1901          551
AAACGCACTGGTAC-1     pbmc3k       2163          781       2148          767
AAACGCTGACCAGT-1     pbmc3k       2175          782       2158          764
AAACGCTGGTTCTT-1     pbmc3k       2260          790       2204          773
AAACGCTGTAGCCA-1     pbmc3k       1275          532       1905          523
AAACGCTGTTTCTG-1     pbmc3k       1103          550       1988          557
                 SCT_snn_res.0.8 seurat_clusters nCount_RNA3 nFeature_RNA3
AAACATACAACCAC-1               4               4        2419           779
AAACATTGAGCTAC-1               2               2        4903          1352
AAACATTGATCAGC-1               0               0        3147          1129
AAACCGTGCTTCCG-1               5               5        2639           960
AAACCGTGTATGCG-1               6               6         980           521
AAACGCACTGGTAC-1               0               0        2163           781
AAACGCTGACCAGT-1               4               4        2175           782
AAACGCTGGTTCTT-1               4               4        2260           790
AAACGCTGTAGCCA-1               4               4        1275           532
AAACGCTGTTTCTG-1               7               7        1103           550
                   old.ident
AAACATACAACCAC-1   CD16 Mono
AAACATTGAGCTAC-1          DC
AAACATTGATCAGC-1         pDC
AAACCGTGCTTCCG-1 B Activated
AAACCGTGTATGCG-1           B
AAACGCACTGGTAC-1         pDC
AAACGCTGACCAGT-1   CD16 Mono
AAACGCTGGTTCTT-1   CD16 Mono
AAACGCTGTAGCCA-1   CD16 Mono
AAACGCTGTTTCTG-1       CD8 T</code></pre>
</div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retrieve specific values from the metadata</span></span>
<span><span class="va">pbmc</span><span class="op">$</span><span class="va">nCount_RNA</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1 AAACCGTGCTTCCG-1 
            2419             4903             3147             2639 
AAACCGTGTATGCG-1 
             980 </code></pre>
</div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbmc</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"nCount_RNA"</span>, <span class="st">"nFeature_RNA"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 nCount_RNA nFeature_RNA
AAACATACAACCAC-1       2419          779
AAACATTGAGCTAC-1       4903         1352
AAACATTGATCAGC-1       3147         1129
AAACCGTGCTTCCG-1       2639          960
AAACCGTGTATGCG-1        980          521</code></pre>
</div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add metadata, see ?AddMetaData</span></span>
<span><span class="va">random_group_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Cancer"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Control"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pbmc</span><span class="op">$</span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="va">random_group_labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="获取表达量信息-stored-as-layers-in-seurat-v5" class="level3"><h3 class="anchored" data-anchor-id="获取表达量信息-stored-as-layers-in-seurat-v5">获取表达量信息 (stored as layers in Seurat v5)</h3>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-23_8a591efdb8f3cb711afe2f1c622eddb5">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Retrieve data in an expression matrix RNA counts matrix</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">counts</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5 x 5 sparse Matrix of class "dgCMatrix"
              AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1
AL627309.1                   .                .                .
AP006222.2                   .                .                .
RP11-206L10.2                .                .                .
RP11-206L10.9                .                .                .
LINC00115                    .                .                .
              AAACCGTGCTTCCG-1 AAACCGTGTATGCG-1
AL627309.1                   .                .
AP006222.2                   .                .
RP11-206L10.2                .                .
RP11-206L10.9                .                .
LINC00115                    .                .</code></pre>
</div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 或</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Layers.html">LayerData</a></span><span class="op">(</span><span class="va">pbmc</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, layer <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5 x 5 sparse Matrix of class "dgCMatrix"
              AAACATACAACCAC-1 AAACATTGAGCTAC-1 AAACATTGATCAGC-1
AL627309.1                   .                .                .
AP006222.2                   .                .                .
RP11-206L10.2                .                .                .
RP11-206L10.9                .                .                .
LINC00115                    .                .                .
              AAACCGTGCTTCCG-1 AAACCGTGTATGCG-1
AL627309.1                   .                .
AP006222.2                   .                .
RP11-206L10.2                .                .
RP11-206L10.9                .                .
LINC00115                    .                .</code></pre>
</div>
</div>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-24_df45e211d292d233d780195e9e838c93">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set expression data assume new.data is a new expression matrix</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="va">new.data</span></span>
<span><span class="co"># 或</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Layers.html">LayerData</a></span><span class="op">(</span><span class="va">pbmc</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, layer <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new.data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="获取pca降维信息" class="level3"><h3 class="anchored" data-anchor-id="获取pca降维信息">获取PCA降维信息</h3>
<p>实际应用场景见<a href="../../single_cell/scRNA-seq_online/08_SC_clustering_quality_control.html#sec-Effect_of_pcs_clustering">分析主成分（PCs）对细胞分群的影响</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-25_737ae6108ab650570e0451c92206859a">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 获取细胞在所有主成分上的评分（坐标）</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Embeddings.html">Embeddings</a></span><span class="op">(</span><span class="va">pbmc</span>, reduction <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       PC_1       PC_2       PC_3       PC_4        PC_5
AAACATACAACCAC-1 -10.165852   1.087645   5.471643 -0.4546899  0.41257085
AAACATTGAGCTAC-1  -5.814405 -11.244759 -13.092125 -0.4389098  0.05922870
AAACATTGATCAGC-1  -8.565823   1.643337   5.732506  2.4871682  2.55774745
AAACCGTGCTTCCG-1  25.632631  -1.695688  -2.335731  3.8829838  0.02413971
AAACCGTGTATGCG-1  -2.536685  21.282498  -9.103048 -5.1031745 -2.71944035</code></pre>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 或</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">'pca'</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">cell.embeddings</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       PC_1       PC_2       PC_3       PC_4        PC_5
AAACATACAACCAC-1 -10.165852   1.087645   5.471643 -0.4546899  0.41257085
AAACATTGAGCTAC-1  -5.814405 -11.244759 -13.092125 -0.4389098  0.05922870
AAACATTGATCAGC-1  -8.565823   1.643337   5.732506  2.4871682  2.55774745
AAACCGTGCTTCCG-1  25.632631  -1.695688  -2.335731  3.8829838  0.02413971
AAACCGTGTATGCG-1  -2.536685  21.282498  -9.103048 -5.1031745 -2.71944035</code></pre>
</div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 获取基因在所有主成分上的评分（坐标）</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Loadings.html">Loadings</a></span><span class="op">(</span><span class="va">pbmc</span>, reduction <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              PC_1         PC_2        PC_3        PC_4         PC_5
S100A9  0.19825859 -0.008571611  0.09650808 -0.28883733 -0.005721886
GNLY   -0.02330150  0.195582622 -0.10436066 -0.06562367 -0.093134754
LYZ     0.23833773 -0.023491803  0.06414334 -0.26984270 -0.010442604
S100A8  0.16884448 -0.007179440  0.09962703 -0.29729996 -0.001143372
NKG7   -0.04601942  0.296816129 -0.13906341 -0.08608150 -0.061192287</code></pre>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 或</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"pca"</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">feature.loadings</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              PC_1         PC_2        PC_3        PC_4         PC_5
S100A9  0.19825859 -0.008571611  0.09650808 -0.28883733 -0.005721886
GNLY   -0.02330150  0.195582622 -0.10436066 -0.06562367 -0.093134754
LYZ     0.23833773 -0.023491803  0.06414334 -0.26984270 -0.010442604
S100A8  0.16884448 -0.007179440  0.09962703 -0.29729996 -0.001143372
NKG7   -0.04601942  0.296816129 -0.13906341 -0.08608150 -0.061192287</code></pre>
</div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 提取PCA信息中的第二主成分，并展示对该主成分影响最大的前5个基因名</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"pca"</span><span class="op">]</span><span class="op">]</span>, dims <span class="op">=</span> <span class="fl">2</span>, nfeatures <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>PC_ 2 
Positive:  NKG7, CCL5, GZMB, GNLY, GZMA 
Negative:  HLA-DRA, CD74, CD79A, HLA-DPB1, HLA-DQA1 </code></pre>
</div>
</div>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-26_18bbb285d5a0aa94883d3da5d9ecac7b">
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Create custom dimensional reduction loadings matrix is optional</span></span>
<span><span class="va">new_reduction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/CreateDimReducObject.html">CreateDimReducObject</a></span><span class="op">(</span>embeddings <span class="op">=</span> <span class="va">new.embeddings</span>, </span>
<span>                                      loadings <span class="op">=</span> <span class="va">new.loadings</span>, </span>
<span>                                      key <span class="op">=</span> <span class="st">"custom_pca"</span><span class="op">)</span></span>
<span><span class="co"># 或</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"custom_pca"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">new_reduction</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="通过fetchdata从seurat对象中获取任意信息" class="level3"><h3 class="anchored" data-anchor-id="通过fetchdata从seurat对象中获取任意信息">通过<code>FetchData</code>从Seurat对象中获取任意信息</h3>
<p><code>FetchData</code> can access anything from expression matrices, cell embeddings, or metadata use the previously listed commands to access entire matrices。通过FetchData可以提取包括表达量数据、PCA分数以及meta.data内的任何变量并形成一个数据框。实际应用场景见<a href="../../single_cell/scRNA-seq_online/08_SC_clustering_quality_control.html#sec-Effect_of_pcs_clustering">分析主成分（PCs）对细胞分群的影响</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-27_e36cad597f5681a89194c475ba7c9c54">
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/FetchData.html">FetchData</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pbmc</span>, </span>
<span>          vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"PC_1"</span>, <span class="st">"nFeature_RNA"</span>, <span class="st">"MS4A1"</span><span class="op">)</span>, </span>
<span>          layer <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       PC_1 nFeature_RNA MS4A1
AAACATACAACCAC-1 -10.165852          779     0
AAACATTGAGCTAC-1  -5.814405         1352     4
AAACATTGATCAGC-1  -8.565823         1129     0
AAACCGTGCTTCCG-1  25.632631          960     0
AAACCGTGTATGCG-1  -2.536685          521     0
AAACGCACTGGTAC-1  -6.559842          781     0</code></pre>
</div>
</div>
<hr></section></section><section id="seurat对象取子集和合并" class="level2" data-number="3"><h2 data-number="3" class="anchored" data-anchor-id="seurat对象取子集和合并">
<span class="header-section-number">3</span> Seurat对象取子集和合并</h2>
<section id="sec-subset_seurat" class="level3"><h3 class="anchored" data-anchor-id="sec-subset_seurat">取子集</h3>
<p>实际应用见<a href="../../single_cell/seurat/seurat_tutorial.html#过滤细胞">过滤细胞</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-28_0f28cc7428d41467006114da8558ba24">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 根据meta data中的信息取子集</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc</span>, subset <span class="op">=</span> <span class="va">groups</span> <span class="op">==</span> <span class="st">"Cancer"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 1350 samples within 3 assays 
Active assay: SCT (12572 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 2 other assays present: RNA, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 提取特定cell identities, also see ?SubsetData</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc</span>, idents <span class="op">=</span> <span class="st">"B cell"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 157 samples within 3 assays 
Active assay: SCT (12572 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 2 other assays present: RNA, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 反选</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc</span>, idents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CD4 Naive T"</span>, <span class="st">"CD8 T"</span><span class="op">)</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 2505 samples within 3 assays 
Active assay: SCT (12572 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 2 other assays present: RNA, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 根据特定gene/feature表达水平取子集</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc</span>, subset <span class="op">=</span> <span class="va">S100A9</span> <span class="op">&gt;</span> <span class="fl">1.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 519 samples within 3 assays 
Active assay: SCT (12572 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 2 other assays present: RNA, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 采用多个标准取子集</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc</span>, subset <span class="op">=</span> <span class="va">S100A9</span> <span class="op">&gt;</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">PC_1</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 517 samples within 3 assays 
Active assay: SCT (12572 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 2 other assays present: RNA, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc</span>, subset <span class="op">=</span> <span class="va">S100A9</span> <span class="op">&gt;</span> <span class="fl">1.5</span>, idents <span class="op">=</span> <span class="st">"CD8 T"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 45 samples within 3 assays 
Active assay: SCT (12572 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 2 other assays present: RNA, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Downsample the number of cells per identity class</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc</span>, downsample <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 1088 samples within 3 assays 
Active assay: SCT (12572 features, 3000 variable features)
 3 layers present: counts, data, scale.data
 2 other assays present: RNA, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
</div>
</section><section id="分割layers" class="level3"><h3 class="anchored" data-anchor-id="分割layers">分割layers</h3>
<p>In Seurat v5, users can now split in object directly into different layers keeps expression data in one object, but splits multiple samples into layers can proceed directly to integration workflow after splitting layers。实际应用场景见<a href="../../single_cell/seurat/integration.html">数据整合</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-29_aef074e8b80b100366c842b0f3661071">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/DefaultAssay.html">DefaultAssay</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"RNA"</span></span>
<span><span class="co"># 按照meta.data中的stim列分割layer</span></span>
<span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span>, f <span class="op">=</span> <span class="va">pbmc</span><span class="op">$</span><span class="va">groups</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/截屏2024-01-15 18.36.23.png" class="img-fluid"></p>
<p>如果需要，例如在整合之后，可以将各layers再次合并在一起：</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-30_2077ea7cbbe8494df2ca044dc71149bf">
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/SplitLayers.html">JoinLayers</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="分割seurat" class="level3"><h3 class="anchored" data-anchor-id="分割seurat">分割Seurat</h3>
<p>In line with prior workflows, you can also split your Seurat object into a <strong>list</strong> of multiple objects based on a metadata column creates a list of two objects。通过<code><a href="https://satijalab.org/seurat/reference/SplitObject.html">SplitObject()</a></code>分割Seurat之后生成的是包含多个Seurat对象的列表。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-31_33d585cce23aa8cbbb5ff751f0f0ae5e">
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">seurat_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/SplitObject.html">SplitObject</a></span><span class="op">(</span><span class="va">pbmc</span>, split.by <span class="op">=</span> <span class="st">"groups"</span><span class="op">)</span></span>
<span><span class="va">seurat_list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Cancer
An object of class Seurat 
40000 features across 1350 samples within 3 assays 
Active assay: RNA (13714 features, 0 variable features)
 1 layer present: counts
 2 other assays present: SCT, RNA3
 2 dimensional reductions calculated: pca, umap

$Control
An object of class Seurat 
40000 features across 1350 samples within 3 assays 
Active assay: RNA (13714 features, 0 variable features)
 1 layer present: counts
 2 other assays present: SCT, RNA3
 2 dimensional reductions calculated: pca, umap</code></pre>
</div>
</div>
<p><img src="images/截屏2024-01-15 18.42.35.png" class="img-fluid"></p>
</section><section id="merge-objects-without-integration" class="level3"><h3 class="anchored" data-anchor-id="merge-objects-without-integration">Merge objects (without integration)</h3>
<p>In Seurat v5, merging creates a single object, but <strong>keeps the expression information split into different layers</strong> for integration. If not proceeding with integration, rejoin the layers after merging. 实际应用场景，见<a href="../../single_cell/sc_supplementary/read_sc_data.html">后续章节</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-32_35d961575e80807e389eea91ff224a6b">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Merge two Seurat objects</span></span>
<span><span class="va">merged_pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">seurat_list</span><span class="op">[[</span><span class="st">"Control"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                     y <span class="op">=</span> <span class="va">seurat_list</span><span class="op">[[</span><span class="st">"Cancer"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/截屏2024-01-15 18.19.15.png" class="img-fluid"></p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-33_5a94787ad67e6e883bd0ea07e20bc0b9">
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Example to merge more than two Seurat objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pbmc1</span>, </span>
<span>      y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pbmc2</span>, <span class="va">pbmc3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="merge-objects-with-integration" class="level3"><h3 class="anchored" data-anchor-id="merge-objects-with-integration">Merge objects (with integration)</h3>
<p>关于单细胞数据的整合，参考<a href="../../single_cell/seurat/integration.html">后续章节</a>。</p>
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-34_dfcb66e922a2af7fec707258a75d3a80">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">merged_pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html">NormalizeData</a></span><span class="op">(</span><span class="va">merged_pbmc</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">merged_pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html">FindVariableFeatures</a></span><span class="op">(</span><span class="va">merged_pbmc</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">merged_pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html">ScaleData</a></span><span class="op">(</span><span class="va">merged_pbmc</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">merged_pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html">RunPCA</a></span><span class="op">(</span><span class="va">merged_pbmc</span>, verbose <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">merged_pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/IntegrateLayers.html">IntegrateLayers</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">merged_pbmc</span>, </span>
<span>                               method <span class="op">=</span> <span class="va">RPCAIntegration</span>, </span>
<span>                               orig.reduction <span class="op">=</span> <span class="st">"pca"</span>, </span>
<span>                               new.reduction <span class="op">=</span> <span class="st">"integrated.rpca"</span>,</span>
<span>                               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now that integration is complete, rejoin layers</span></span>
<span><span class="va">merged_pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/SplitLayers.html">JoinLayers</a></span><span class="op">(</span><span class="va">merged_pbmc</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">merged_pbmc</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
40000 features across 2700 samples within 3 assays 
Active assay: RNA (13714 features, 2000 variable features)
 3 layers present: data, counts, scale.data
 2 other assays present: SCT, RNA3
 2 dimensional reductions calculated: pca, integrated.rpca</code></pre>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Additional resources
</div>
</div>
<div class="callout-body-container callout-body">
<p>Users who are particularly interested in some of the technical changes to data storage in Seurat v5 can explore the following resources:</p>
<ul>
<li><p><a href="https://mojaveazure.github.io/seurat-object/">SeuratObject manual</a></p></li>
<li><p><a href="https://satijalab.org/seurat/articles/seurat5_essential_commands">Seurat v5 and Assay5 introductory vignette</a></p></li>
</ul>
</div>
</div>
<hr>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-hash="seurat_command_list_cache/html/unnamed-chunk-35_bfce99e829032d4a353d3d8a9398f881">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.2 (2023-10-31)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Sonoma 14.3

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Asia/Shanghai
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] Seurat_5.0.1       SeuratObject_5.0.1 sp_2.1-2          

loaded via a namespace (and not attached):
  [1] RColorBrewer_1.1-3          rstudioapi_0.15.0          
  [3] jsonlite_1.8.8              magrittr_2.0.3             
  [5] spatstat.utils_3.0-4        farver_2.1.1               
  [7] rmarkdown_2.25              zlibbioc_1.48.0            
  [9] vctrs_0.6.5                 ROCR_1.0-11                
 [11] DelayedMatrixStats_1.24.0   spatstat.explore_3.2-5     
 [13] RCurl_1.98-1.14             S4Arrays_1.2.0             
 [15] htmltools_0.5.7             SparseArray_1.2.3          
 [17] sctransform_0.4.1           parallelly_1.36.0          
 [19] KernSmooth_2.23-22          htmlwidgets_1.6.4          
 [21] ica_1.0-3                   plyr_1.8.9                 
 [23] plotly_4.10.4               zoo_1.8-12                 
 [25] igraph_1.6.0                mime_0.12                  
 [27] lifecycle_1.0.4             pkgconfig_2.0.3            
 [29] Matrix_1.6-5                R6_2.5.1                   
 [31] fastmap_1.1.1               GenomeInfoDbData_1.2.11    
 [33] MatrixGenerics_1.14.0       fitdistrplus_1.1-11        
 [35] future_1.33.1               shiny_1.8.0                
 [37] digest_0.6.34               colorspace_2.1-0           
 [39] patchwork_1.2.0             S4Vectors_0.40.2           
 [41] tensor_1.5                  RSpectra_0.16-1            
 [43] irlba_2.3.5.1               GenomicRanges_1.54.1       
 [45] labeling_0.4.3              progressr_0.14.0           
 [47] fansi_1.0.6                 spatstat.sparse_3.0-3      
 [49] httr_1.4.7                  polyclip_1.10-6            
 [51] abind_1.4-5                 compiler_4.3.2             
 [53] withr_3.0.0                 fastDummies_1.7.3          
 [55] R.utils_2.12.3              MASS_7.3-60.0.1            
 [57] DelayedArray_0.28.0         tools_4.3.2                
 [59] lmtest_0.9-40               httpuv_1.6.13              
 [61] future.apply_1.11.1         goftest_1.2-3              
 [63] R.oo_1.25.0                 glmGamPoi_1.14.0           
 [65] glue_1.7.0                  nlme_3.1-164               
 [67] promises_1.2.1              grid_4.3.2                 
 [69] Rtsne_0.17                  cluster_2.1.6              
 [71] reshape2_1.4.4              generics_0.1.3             
 [73] gtable_0.3.4                spatstat.data_3.0-4        
 [75] R.methodsS3_1.8.2           tidyr_1.3.0                
 [77] data.table_1.14.10          XVector_0.42.0             
 [79] utf8_1.2.4                  BiocGenerics_0.48.1        
 [81] spatstat.geom_3.2-7         RcppAnnoy_0.0.21           
 [83] ggrepel_0.9.5               RANN_2.6.1                 
 [85] pillar_1.9.0                stringr_1.5.1              
 [87] spam_2.10-0                 RcppHNSW_0.5.0             
 [89] later_1.3.2                 splines_4.3.2              
 [91] dplyr_1.1.4                 lattice_0.22-5             
 [93] survival_3.5-7              deldir_2.0-2               
 [95] tidyselect_1.2.0            miniUI_0.1.1.1             
 [97] pbapply_1.7-2               knitr_1.45                 
 [99] gridExtra_2.3               IRanges_2.36.0             
[101] SummarizedExperiment_1.32.0 scattermore_1.2            
[103] stats4_4.3.2                xfun_0.41                  
[105] Biobase_2.62.0              matrixStats_1.2.0          
[107] stringi_1.8.3               lazyeval_0.2.2             
[109] yaml_2.3.8                  evaluate_0.23              
[111] codetools_0.2-19            tibble_3.2.1               
[113] cli_3.6.2                   uwot_0.1.16                
[115] xtable_1.8-4                reticulate_1.34.0          
[117] munsell_0.5.0               Rcpp_1.0.12                
[119] GenomeInfoDb_1.38.5         globals_0.16.2             
[121] spatstat.random_3.2-2       png_0.1-8                  
[123] parallel_4.3.2              ellipsis_0.3.2             
[125] ggplot2_3.4.4               dotCall64_1.1-1            
[127] sparseMatrixStats_1.14.0    bitops_1.0-7               
[129] listenv_0.9.0               viridisLite_0.4.2          
[131] scales_1.3.0                ggridges_0.5.5             
[133] crayon_1.5.2                leiden_0.4.3.1             
[135] purrr_1.0.2                 rlang_1.1.3                
[137] cowplot_1.1.2              </code></pre>
</div>
</div>
</div>
</div>
</div>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/djhcod\.github\.io\/r-notes\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><script src="https://giscus.app/client.js" data-repo="djhcod/r-notes" data-repo-id="R_kgDOKw7GMg" data-category="General" data-category-id="DIC_kwDOKw7GMs4Cbz4B" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../single_cell/seurat/seurat_intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Seurat v5官方文档</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../single_cell/seurat/seurat_tutorial.html" class="pagination-link">
        <span class="nav-page-text">Seurat细胞分群官方教程</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb109" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Seurat常用函数清单"</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 原文：</span><span class="co">[</span><span class="ot">*Seurat Command List*</span><span class="co">](https://satijalab.org/seurat/articles/essential_commands)</span></span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 原文发布日期：2023年10月31日</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>为了演示各函数的效果，这里的案例数据选取了在<span class="co">[</span><span class="ot">Seurat细胞分群官方教程</span><span class="co">](/single_cell/seurat/seurat_tutorial.qmd)</span>中用到的包含了2700个细胞的外周血单核细胞数据（<span class="in">`pbmc`</span>）。数据可在<span class="co">[</span><span class="ot">此链接</span><span class="co">](https://cf.10xgenomics.com/samples/cell/pbmc3k/pbmc3k_filtered_gene_bc_matrices.tar.gz)</span>下载。</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Seurat)</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 读取PBMC数据集</span></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">Read10X</span>(<span class="at">data.dir =</span> <span class="st">"data/seurat_official/filtered_gene_bc_matrices/hg19"</span>)</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the Seurat object with the raw (non-normalized data).</span></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(<span class="at">counts =</span> counts, </span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">project =</span> <span class="st">"pbmc3k"</span>, </span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>                           <span class="at">min.cells =</span> <span class="dv">3</span>, </span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">min.features =</span> <span class="dv">200</span>)</span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>pbmc</span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## 标准Seurat流程基本函数</span></span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a>见<span class="co">[</span><span class="ot">Seurat细胞分群官方教程</span><span class="co">](/single_cell/seurat/seurat_tutorial.qmd)</span>。</span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">NormalizeData</span>(<span class="at">object =</span> pbmc)</span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">FindVariableFeatures</span>(<span class="at">object =</span> pbmc)</span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">ScaleData</span>(<span class="at">object =</span> pbmc)</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">RunPCA</span>(<span class="at">object =</span> pbmc)</span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">FindNeighbors</span>(<span class="at">object =</span> pbmc, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">FindClusters</span>(<span class="at">object =</span> pbmc)</span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(<span class="at">object =</span> pbmc, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(<span class="at">object =</span> pbmc, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a><span class="fu">### 采用`SCtransform`标准化时的流程：</span></span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-48"><a href="#cb109-48" aria-hidden="true" tabindex="-1"></a>详见<span class="co">[</span><span class="ot">基于SCTransform的单细胞数据标准化</span><span class="co">](/single_cell/seurat/sctransform.qmd)</span>。</span>
<span id="cb109-49"><a href="#cb109-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-52"><a href="#cb109-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-53"><a href="#cb109-53" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">SCTransform</span>(<span class="at">object =</span> pbmc, <span class="at">verbose =</span> F)</span>
<span id="cb109-54"><a href="#cb109-54" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">RunPCA</span>(<span class="at">object =</span> pbmc, <span class="at">verbose =</span> F)</span>
<span id="cb109-55"><a href="#cb109-55" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">FindNeighbors</span>(<span class="at">object =</span> pbmc, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">verbose =</span> F)</span>
<span id="cb109-56"><a href="#cb109-56" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">FindClusters</span>(<span class="at">object =</span> pbmc, <span class="at">verbose =</span> F)</span>
<span id="cb109-57"><a href="#cb109-57" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(<span class="at">object =</span> pbmc, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">verbose =</span> F)</span>
<span id="cb109-58"><a href="#cb109-58" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(<span class="at">object =</span> pbmc, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span>
<span id="cb109-59"><a href="#cb109-59" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-60"><a href="#cb109-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-61"><a href="#cb109-61" aria-hidden="true" tabindex="-1"></a>或者通过管道函数：</span>
<span id="cb109-62"><a href="#cb109-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-65"><a href="#cb109-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-66"><a href="#cb109-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb109-67"><a href="#cb109-67" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">SCTransform</span>(pbmc) <span class="sc">%&gt;%</span></span>
<span id="cb109-68"><a href="#cb109-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">RunPCA</span>() <span class="sc">%&gt;%</span></span>
<span id="cb109-69"><a href="#cb109-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">FindNeighbors</span>(<span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-70"><a href="#cb109-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">FindClusters</span>() <span class="sc">%&gt;%</span></span>
<span id="cb109-71"><a href="#cb109-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">RunUMAP</span>(<span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb109-72"><a href="#cb109-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-73"><a href="#cb109-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-74"><a href="#cb109-74" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb109-75"><a href="#cb109-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-76"><a href="#cb109-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## 提取`Seurat`对象内的各数据</span></span>
<span id="cb109-77"><a href="#cb109-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-78"><a href="#cb109-78" aria-hidden="true" tabindex="-1"></a><span class="fu">### 获取细胞、基因、assays、layers名称</span></span>
<span id="cb109-79"><a href="#cb109-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-80"><a href="#cb109-80" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 获取细胞的barcode：</span></span>
<span id="cb109-81"><a href="#cb109-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-84"><a href="#cb109-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-85"><a href="#cb109-85" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pbmc)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-86"><a href="#cb109-86" aria-hidden="true" tabindex="-1"></a><span class="fu">Cells</span>(pbmc)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="co"># 效果同上</span></span>
<span id="cb109-87"><a href="#cb109-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-88"><a href="#cb109-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-89"><a href="#cb109-89" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 获取基因（feature）名。</span></span>
<span id="cb109-90"><a href="#cb109-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-93"><a href="#cb109-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-94"><a href="#cb109-94" aria-hidden="true" tabindex="-1"></a><span class="fu">Features</span>(pbmc)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-95"><a href="#cb109-95" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(pbmc)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="co"># 同上</span></span>
<span id="cb109-96"><a href="#cb109-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-97"><a href="#cb109-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-98"><a href="#cb109-98" aria-hidden="true" tabindex="-1"></a>可以指定提取哪一个assay下的基因名，如果未指定，则提取默认assay内的基因名。这里的pbmc数据经过了**`SCTransform`，**所以有两个assay，默认的归一化之后的“SCT”assay，另一个是原始的“RNA”assay。</span>
<span id="cb109-99"><a href="#cb109-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-102"><a href="#cb109-102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-103"><a href="#cb109-103" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取“SCT” assay下的基因名</span></span>
<span id="cb109-104"><a href="#cb109-104" aria-hidden="true" tabindex="-1"></a><span class="fu">Features</span>(pbmc[[<span class="st">"SCT"</span>]])[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-105"><a href="#cb109-105" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取“RNA” assay下的基因名</span></span>
<span id="cb109-106"><a href="#cb109-106" aria-hidden="true" tabindex="-1"></a><span class="fu">Features</span>(pbmc[[<span class="st">"RNA"</span>]])[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-107"><a href="#cb109-107" aria-hidden="true" tabindex="-1"></a><span class="co"># 或</span></span>
<span id="cb109-108"><a href="#cb109-108" aria-hidden="true" tabindex="-1"></a><span class="fu">Features</span>(pbmc, <span class="at">assay =</span> <span class="st">"RNA"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-109"><a href="#cb109-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-110"><a href="#cb109-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-111"><a href="#cb109-111" aria-hidden="true" tabindex="-1"></a>也可以通过添加<span class="in">`layer`</span>参数，提取指定layer下的基因名：</span>
<span id="cb109-112"><a href="#cb109-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-115"><a href="#cb109-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-116"><a href="#cb109-116" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取“counts” layer下的基因名</span></span>
<span id="cb109-117"><a href="#cb109-117" aria-hidden="true" tabindex="-1"></a><span class="fu">Features</span>(pbmc, <span class="at">layer =</span> <span class="st">"counts"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-118"><a href="#cb109-118" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取"scale.data"的基因名</span></span>
<span id="cb109-119"><a href="#cb109-119" aria-hidden="true" tabindex="-1"></a><span class="fu">Features</span>(pbmc, <span class="at">layer =</span> <span class="st">"scale.data"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-120"><a href="#cb109-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-121"><a href="#cb109-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-122"><a href="#cb109-122" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 获取细胞和基因的数量：</span></span>
<span id="cb109-123"><a href="#cb109-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-126"><a href="#cb109-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-127"><a href="#cb109-127" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(pbmc) <span class="co"># 细胞数量</span></span>
<span id="cb109-128"><a href="#cb109-128" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(pbmc) <span class="co"># 基因（feature）数量</span></span>
<span id="cb109-129"><a href="#cb109-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-130"><a href="#cb109-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-131"><a href="#cb109-131" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 获取高变基因列表</span></span>
<span id="cb109-132"><a href="#cb109-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-133"><a href="#cb109-133" aria-hidden="true" tabindex="-1"></a>详见<span class="co">[</span><span class="ot">识别高变基因（highly variable features）</span><span class="co">](/single_cell/seurat/seurat_tutorial.qmd#sec-highly_variable_features)</span>。</span>
<span id="cb109-134"><a href="#cb109-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-137"><a href="#cb109-137" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-138"><a href="#cb109-138" aria-hidden="true" tabindex="-1"></a><span class="fu">VariableFeatures</span>(pbmc)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-139"><a href="#cb109-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-140"><a href="#cb109-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-141"><a href="#cb109-141" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 列出layers</span></span>
<span id="cb109-142"><a href="#cb109-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-145"><a href="#cb109-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-146"><a href="#cb109-146" aria-hidden="true" tabindex="-1"></a><span class="co"># 列出所有的layers</span></span>
<span id="cb109-147"><a href="#cb109-147" aria-hidden="true" tabindex="-1"></a><span class="fu">Layers</span>(pbmc)</span>
<span id="cb109-148"><a href="#cb109-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-149"><a href="#cb109-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-150"><a href="#cb109-150" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 获取/设定assay：</span></span>
<span id="cb109-151"><a href="#cb109-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-152"><a href="#cb109-152" aria-hidden="true" tabindex="-1"></a>列出所有的assay，如"RNA" assay、运行<span class="in">`SCTransform`</span>之后的"SCT" assay。一个Seurat对象可以包括多个assay对象，但是在某个时刻，只有一个assay对象是默认激活的。</span>
<span id="cb109-153"><a href="#cb109-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-154"><a href="#cb109-154" aria-hidden="true" tabindex="-1"></a>实际应用场景见<span class="co">[</span><span class="ot">此章节</span><span class="co">](/single_cell/seurat/marker_gene_identification.qmd#sec-findmarkers_function)</span>。</span>
<span id="cb109-155"><a href="#cb109-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-158"><a href="#cb109-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-159"><a href="#cb109-159" aria-hidden="true" tabindex="-1"></a><span class="co"># 列出所有的assay</span></span>
<span id="cb109-160"><a href="#cb109-160" aria-hidden="true" tabindex="-1"></a><span class="fu">Assays</span>(pbmc)</span>
<span id="cb109-161"><a href="#cb109-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-162"><a href="#cb109-162" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取目前的默认assay名称</span></span>
<span id="cb109-163"><a href="#cb109-163" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(pbmc)</span>
<span id="cb109-164"><a href="#cb109-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-165"><a href="#cb109-165" aria-hidden="true" tabindex="-1"></a><span class="co"># 设定默认assay</span></span>
<span id="cb109-166"><a href="#cb109-166" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(pbmc) <span class="ot">&lt;-</span> <span class="st">"RNA"</span></span>
<span id="cb109-167"><a href="#cb109-167" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(pbmc) <span class="ot">&lt;-</span> <span class="st">"SCT"</span></span>
<span id="cb109-168"><a href="#cb109-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-169"><a href="#cb109-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-170"><a href="#cb109-170" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 转换不同版本的Seurat对象：</span></span>
<span id="cb109-171"><a href="#cb109-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-172"><a href="#cb109-172" aria-hidden="true" tabindex="-1"></a>上面我们使用的pbmc对象使用V5版本的Seurat包创建的，可以通过如下命令查看：</span>
<span id="cb109-173"><a href="#cb109-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-176"><a href="#cb109-176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-177"><a href="#cb109-177" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看Seurat对象是用哪个版本的Seurat包创建的</span></span>
<span id="cb109-178"><a href="#cb109-178" aria-hidden="true" tabindex="-1"></a>pbmc<span class="sc">@</span>version</span>
<span id="cb109-179"><a href="#cb109-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-180"><a href="#cb109-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-181"><a href="#cb109-181" aria-hidden="true" tabindex="-1"></a>这里我们导入在<span class="co">[</span><span class="ot">后续章节</span><span class="co">](/single_cell/scRNA-seq_online/07_SC_clustering_cells_SCT.qmd#sec-Load_case_data)</span>中用到的案例数据，这个Seurat对象是使用V4版本的<span class="in">`Seurat`</span>包创建的。</span>
<span id="cb109-182"><a href="#cb109-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-185"><a href="#cb109-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-186"><a href="#cb109-186" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache-lazy: false</span></span>
<span id="cb109-187"><a href="#cb109-187" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">bzfile</span>(<span class="st">"data/scRNA-seq_online/additional_data/seurat_integrated.RData.bz2"</span>))</span>
<span id="cb109-188"><a href="#cb109-188" aria-hidden="true" tabindex="-1"></a>seurat_integrated</span>
<span id="cb109-189"><a href="#cb109-189" aria-hidden="true" tabindex="-1"></a>seurat_integrated<span class="sc">@</span>version</span>
<span id="cb109-190"><a href="#cb109-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-191"><a href="#cb109-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-192"><a href="#cb109-192" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-01-15%2019.49.57.png)</span></span>
<span id="cb109-193"><a href="#cb109-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-194"><a href="#cb109-194" aria-hidden="true" tabindex="-1"></a>可以看到，这个seurat_integrated对象的“RNA” assay没有layers结构，是典型的V5版本之前的Seurat对象的结构。我们可以通过as()函数将V4或V3版本的“RNA” assay转换成V5版本的“RNA” assay：</span>
<span id="cb109-195"><a href="#cb109-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-198"><a href="#cb109-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-199"><a href="#cb109-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache-lazy: false</span></span>
<span id="cb109-200"><a href="#cb109-200" aria-hidden="true" tabindex="-1"></a><span class="co"># convert a v4 or v3 assay to a v5 assay</span></span>
<span id="cb109-201"><a href="#cb109-201" aria-hidden="true" tabindex="-1"></a>seurat_integrated[[<span class="st">"RNA5"</span>]] <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="at">object =</span> seurat_integrated[[<span class="st">"RNA"</span>]], </span>
<span id="cb109-202"><a href="#cb109-202" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">Class =</span> <span class="st">"Assay5"</span>)</span>
<span id="cb109-203"><a href="#cb109-203" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(seurat_integrated) <span class="ot">=</span> <span class="st">"RNA5"</span></span>
<span id="cb109-204"><a href="#cb109-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-205"><a href="#cb109-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-206"><a href="#cb109-206" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-01-15%2019.54.40.png)</span></span>
<span id="cb109-207"><a href="#cb109-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-208"><a href="#cb109-208" aria-hidden="true" tabindex="-1"></a>转换后seurat_integrated<span class="sc">\[\[</span>"RNA5"<span class="sc">\]\]</span>里面是V5版的Seurat结构。如果不想要原来的“RNA” assay可以将其删除：</span>
<span id="cb109-209"><a href="#cb109-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-212"><a href="#cb109-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-213"><a href="#cb109-213" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache-lazy: false</span></span>
<span id="cb109-214"><a href="#cb109-214" aria-hidden="true" tabindex="-1"></a>seurat_integrated[[<span class="st">"RNA"</span>]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb109-215"><a href="#cb109-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-216"><a href="#cb109-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-217"><a href="#cb109-217" aria-hidden="true" tabindex="-1"></a>也可以将V5版本的“RNA” assay转换成V4或V3版本的“RNA” assay：</span>
<span id="cb109-218"><a href="#cb109-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-221"><a href="#cb109-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-222"><a href="#cb109-222" aria-hidden="true" tabindex="-1"></a><span class="co"># convert a v5 assay to a v4 or v3 assay</span></span>
<span id="cb109-223"><a href="#cb109-223" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"RNA3"</span>]] <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="at">object =</span> pbmc[[<span class="st">"RNA"</span>]], <span class="at">Class =</span> <span class="st">"Assay"</span>)</span>
<span id="cb109-224"><a href="#cb109-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-225"><a href="#cb109-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-226"><a href="#cb109-226" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-01-15%2020.01.30.png)</span></span>
<span id="cb109-227"><a href="#cb109-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-228"><a href="#cb109-228" aria-hidden="true" tabindex="-1"></a><span class="fu">### 获取细胞注释信息（cell identities）</span></span>
<span id="cb109-229"><a href="#cb109-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-230"><a href="#cb109-230" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 查看cell identities：</span></span>
<span id="cb109-231"><a href="#cb109-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-232"><a href="#cb109-232" aria-hidden="true" tabindex="-1"></a>即**细胞的类型**，在Seurat对象中，细胞可能有好几种不同方法注释的类型，但是在某一时刻，只有一种细胞类型是默认激活的。</span>
<span id="cb109-233"><a href="#cb109-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-236"><a href="#cb109-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-237"><a href="#cb109-237" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(pbmc)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-238"><a href="#cb109-238" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">Idents</span>(pbmc))</span>
<span id="cb109-239"><a href="#cb109-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-240"><a href="#cb109-240" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看目前cell identities的水平</span></span>
<span id="cb109-241"><a href="#cb109-241" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(pbmc)</span>
<span id="cb109-242"><a href="#cb109-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-243"><a href="#cb109-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-244"><a href="#cb109-244" aria-hidden="true" tabindex="-1"></a><span class="fu">#### 设定细胞identities：</span></span>
<span id="cb109-245"><a href="#cb109-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-246"><a href="#cb109-246" aria-hidden="true" tabindex="-1"></a>实际应用场景见<span class="co">[</span><span class="ot">后续章节</span><span class="co">](/single_cell/seurat/marker_gene_identification.qmd#sec-findmarkers_function)</span>。</span>
<span id="cb109-247"><a href="#cb109-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-250"><a href="#cb109-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-251"><a href="#cb109-251" aria-hidden="true" tabindex="-1"></a><span class="co"># 将meta.data中的"seurat_clusters"列设置为cell identities</span></span>
<span id="cb109-252"><a href="#cb109-252" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(pbmc) <span class="ot">&lt;-</span> <span class="st">"seurat_clusters"</span></span>
<span id="cb109-253"><a href="#cb109-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-254"><a href="#cb109-254" aria-hidden="true" tabindex="-1"></a><span class="co"># 重命名细胞注释标签或重新排序细胞类型标签</span></span>
<span id="cb109-255"><a href="#cb109-255" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(pbmc) <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">Idents</span>(pbmc), </span>
<span id="cb109-256"><a href="#cb109-256" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">levels</span>(pbmc),</span>
<span id="cb109-257"><a href="#cb109-257" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"pDC"</span>, <span class="st">"Mk"</span>, <span class="st">"DC"</span>, <span class="st">"CD14 Mono"</span>, <span class="st">"CD16 Mono"</span>, </span>
<span id="cb109-258"><a href="#cb109-258" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"B Activated"</span>, <span class="st">"B"</span>, <span class="st">"CD8 T"</span>, <span class="st">"NK"</span>, <span class="st">"T activated"</span>, </span>
<span id="cb109-259"><a href="#cb109-259" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"CD4 Naive T"</span>, <span class="st">"CD4 Memory T"</span>, <span class="st">"epi"</span>))</span>
<span id="cb109-260"><a href="#cb109-260" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(pbmc) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb109-261"><a href="#cb109-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-262"><a href="#cb109-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-263"><a href="#cb109-263" aria-hidden="true" tabindex="-1"></a>将目前的cell identities保存到meta.data新的一列中：</span>
<span id="cb109-264"><a href="#cb109-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-267"><a href="#cb109-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-268"><a href="#cb109-268" aria-hidden="true" tabindex="-1"></a><span class="co"># 将目前的cell identities储存到meta.data的"old.ident"列中</span></span>
<span id="cb109-269"><a href="#cb109-269" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"old.ident"</span>]] <span class="ot">&lt;-</span> <span class="fu">Idents</span>(pbmc) </span>
<span id="cb109-270"><a href="#cb109-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-271"><a href="#cb109-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-272"><a href="#cb109-272" aria-hidden="true" tabindex="-1"></a>重命名某个cell identities：</span>
<span id="cb109-273"><a href="#cb109-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-276"><a href="#cb109-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-277"><a href="#cb109-277" aria-hidden="true" tabindex="-1"></a>pbmc <span class="ot">&lt;-</span> <span class="fu">RenameIdents</span>(pbmc, </span>
<span id="cb109-278"><a href="#cb109-278" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"B"</span> <span class="ot">=</span> <span class="st">"B cell"</span>)</span>
<span id="cb109-279"><a href="#cb109-279" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(pbmc) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb109-280"><a href="#cb109-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-281"><a href="#cb109-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-282"><a href="#cb109-282" aria-hidden="true" tabindex="-1"></a><span class="fu">### 获取meta.data</span></span>
<span id="cb109-283"><a href="#cb109-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-286"><a href="#cb109-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-287"><a href="#cb109-287" aria-hidden="true" tabindex="-1"></a><span class="co"># View metadata data frame, stored in object@meta.data</span></span>
<span id="cb109-288"><a href="#cb109-288" aria-hidden="true" tabindex="-1"></a>pbmc<span class="sc">@</span>meta.data <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb109-289"><a href="#cb109-289" aria-hidden="true" tabindex="-1"></a><span class="co"># 或</span></span>
<span id="cb109-290"><a href="#cb109-290" aria-hidden="true" tabindex="-1"></a>pbmc[[]] <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb109-291"><a href="#cb109-291" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果是展示前6行的话也可以直接这样写：</span></span>
<span id="cb109-292"><a href="#cb109-292" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pbmc)</span>
<span id="cb109-293"><a href="#cb109-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-294"><a href="#cb109-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve specific values from the metadata</span></span>
<span id="cb109-295"><a href="#cb109-295" aria-hidden="true" tabindex="-1"></a>pbmc<span class="sc">$</span>nCount_RNA[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-296"><a href="#cb109-296" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="fu">c</span>(<span class="st">"nCount_RNA"</span>, <span class="st">"nFeature_RNA"</span>)]][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb109-297"><a href="#cb109-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-298"><a href="#cb109-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Add metadata, see ?AddMetaData</span></span>
<span id="cb109-299"><a href="#cb109-299" aria-hidden="true" tabindex="-1"></a>random_group_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Cancer"</span>, <span class="fu">nrow</span>(pbmc<span class="sc">@</span>meta.data)<span class="sc">/</span><span class="dv">2</span>), </span>
<span id="cb109-300"><a href="#cb109-300" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rep</span>(<span class="st">"Control"</span>, <span class="fu">nrow</span>(pbmc<span class="sc">@</span>meta.data)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb109-301"><a href="#cb109-301" aria-hidden="true" tabindex="-1"></a>pbmc<span class="sc">$</span>groups <span class="ot">&lt;-</span> random_group_labels</span>
<span id="cb109-302"><a href="#cb109-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-303"><a href="#cb109-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-304"><a href="#cb109-304" aria-hidden="true" tabindex="-1"></a><span class="fu">### 获取表达量信息 (stored as layers in Seurat v5)</span></span>
<span id="cb109-305"><a href="#cb109-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-308"><a href="#cb109-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-309"><a href="#cb109-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve data in an expression matrix RNA counts matrix</span></span>
<span id="cb109-310"><a href="#cb109-310" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"RNA"</span>]]<span class="sc">$</span>counts[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-311"><a href="#cb109-311" aria-hidden="true" tabindex="-1"></a><span class="co"># 或</span></span>
<span id="cb109-312"><a href="#cb109-312" aria-hidden="true" tabindex="-1"></a><span class="fu">LayerData</span>(pbmc, <span class="at">assay =</span> <span class="st">"RNA"</span>, <span class="at">layer =</span> <span class="st">"counts"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-313"><a href="#cb109-313" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-314"><a href="#cb109-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-317"><a href="#cb109-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-318"><a href="#cb109-318" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb109-319"><a href="#cb109-319" aria-hidden="true" tabindex="-1"></a><span class="co"># Set expression data assume new.data is a new expression matrix</span></span>
<span id="cb109-320"><a href="#cb109-320" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"RNA"</span>]]<span class="sc">$</span>counts <span class="ot">&lt;-</span> new.data</span>
<span id="cb109-321"><a href="#cb109-321" aria-hidden="true" tabindex="-1"></a><span class="co"># 或</span></span>
<span id="cb109-322"><a href="#cb109-322" aria-hidden="true" tabindex="-1"></a><span class="fu">LayerData</span>(pbmc, <span class="at">assay =</span> <span class="st">"RNA"</span>, <span class="at">layer =</span> <span class="st">"counts"</span>) <span class="ot">&lt;-</span> new.data</span>
<span id="cb109-323"><a href="#cb109-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-324"><a href="#cb109-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-325"><a href="#cb109-325" aria-hidden="true" tabindex="-1"></a><span class="fu">### 获取PCA降维信息</span></span>
<span id="cb109-326"><a href="#cb109-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-327"><a href="#cb109-327" aria-hidden="true" tabindex="-1"></a>实际应用场景见<span class="co">[</span><span class="ot">分析主成分（PCs）对细胞分群的影响</span><span class="co">](/single_cell/scRNA-seq_online/08_SC_clustering_quality_control.qmd#sec-Effect_of_pcs_clustering)</span>。</span>
<span id="cb109-328"><a href="#cb109-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-331"><a href="#cb109-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-332"><a href="#cb109-332" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取细胞在所有主成分上的评分（坐标）</span></span>
<span id="cb109-333"><a href="#cb109-333" aria-hidden="true" tabindex="-1"></a><span class="fu">Embeddings</span>(pbmc, <span class="at">reduction =</span> <span class="st">"pca"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-334"><a href="#cb109-334" aria-hidden="true" tabindex="-1"></a><span class="co"># 或</span></span>
<span id="cb109-335"><a href="#cb109-335" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">'pca'</span>]]<span class="sc">@</span>cell.embeddings[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-336"><a href="#cb109-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-337"><a href="#cb109-337" aria-hidden="true" tabindex="-1"></a><span class="co"># 获取基因在所有主成分上的评分（坐标）</span></span>
<span id="cb109-338"><a href="#cb109-338" aria-hidden="true" tabindex="-1"></a><span class="fu">Loadings</span>(pbmc, <span class="at">reduction =</span> <span class="st">"pca"</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-339"><a href="#cb109-339" aria-hidden="true" tabindex="-1"></a><span class="co"># 或</span></span>
<span id="cb109-340"><a href="#cb109-340" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"pca"</span>]]<span class="sc">@</span>feature.loadings[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb109-341"><a href="#cb109-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-342"><a href="#cb109-342" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取PCA信息中的第二主成分，并展示对该主成分影响最大的前5个基因名</span></span>
<span id="cb109-343"><a href="#cb109-343" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pbmc[[<span class="st">"pca"</span>]], <span class="at">dims =</span> <span class="dv">2</span>, <span class="at">nfeatures =</span> <span class="dv">5</span>)</span>
<span id="cb109-344"><a href="#cb109-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-345"><a href="#cb109-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-348"><a href="#cb109-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-349"><a href="#cb109-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb109-350"><a href="#cb109-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Create custom dimensional reduction loadings matrix is optional</span></span>
<span id="cb109-351"><a href="#cb109-351" aria-hidden="true" tabindex="-1"></a>new_reduction <span class="ot">&lt;-</span> <span class="fu">CreateDimReducObject</span>(<span class="at">embeddings =</span> new.embeddings, </span>
<span id="cb109-352"><a href="#cb109-352" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">loadings =</span> new.loadings, </span>
<span id="cb109-353"><a href="#cb109-353" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">key =</span> <span class="st">"custom_pca"</span>)</span>
<span id="cb109-354"><a href="#cb109-354" aria-hidden="true" tabindex="-1"></a><span class="co"># 或</span></span>
<span id="cb109-355"><a href="#cb109-355" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"custom_pca"</span>]] <span class="ot">&lt;-</span> new_reduction</span>
<span id="cb109-356"><a href="#cb109-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-357"><a href="#cb109-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-358"><a href="#cb109-358" aria-hidden="true" tabindex="-1"></a><span class="fu">### 通过`FetchData`从Seurat对象中获取任意信息</span></span>
<span id="cb109-359"><a href="#cb109-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-360"><a href="#cb109-360" aria-hidden="true" tabindex="-1"></a><span class="in">`FetchData`</span> can access anything from expression matrices, cell embeddings, or metadata use the previously listed commands to access entire matrices。通过FetchData可以提取包括表达量数据、PCA分数以及meta.data内的任何变量并形成一个数据框。实际应用场景见<span class="co">[</span><span class="ot">分析主成分（PCs）对细胞分群的影响</span><span class="co">](/single_cell/scRNA-seq_online/08_SC_clustering_quality_control.qmd#sec-Effect_of_pcs_clustering)</span>。</span>
<span id="cb109-361"><a href="#cb109-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-364"><a href="#cb109-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-365"><a href="#cb109-365" aria-hidden="true" tabindex="-1"></a><span class="fu">FetchData</span>(<span class="at">object =</span> pbmc, </span>
<span id="cb109-366"><a href="#cb109-366" aria-hidden="true" tabindex="-1"></a>          <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">"PC_1"</span>, <span class="st">"nFeature_RNA"</span>, <span class="st">"MS4A1"</span>), </span>
<span id="cb109-367"><a href="#cb109-367" aria-hidden="true" tabindex="-1"></a>          <span class="at">layer =</span> <span class="st">"counts"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb109-368"><a href="#cb109-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-369"><a href="#cb109-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-370"><a href="#cb109-370" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb109-371"><a href="#cb109-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-372"><a href="#cb109-372" aria-hidden="true" tabindex="-1"></a><span class="fu">## Seurat对象取子集和合并</span></span>
<span id="cb109-373"><a href="#cb109-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-374"><a href="#cb109-374" aria-hidden="true" tabindex="-1"></a><span class="fu">### 取子集 {#sec-subset_seurat}</span></span>
<span id="cb109-375"><a href="#cb109-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-376"><a href="#cb109-376" aria-hidden="true" tabindex="-1"></a>实际应用见<span class="co">[</span><span class="ot">过滤细胞</span><span class="co">](/single_cell/seurat/seurat_tutorial.qmd#过滤细胞)</span>。</span>
<span id="cb109-377"><a href="#cb109-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-380"><a href="#cb109-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-381"><a href="#cb109-381" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据meta data中的信息取子集</span></span>
<span id="cb109-382"><a href="#cb109-382" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(<span class="at">x =</span> pbmc, <span class="at">subset =</span> groups <span class="sc">==</span> <span class="st">"Cancer"</span>)</span>
<span id="cb109-383"><a href="#cb109-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-384"><a href="#cb109-384" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取特定cell identities, also see ?SubsetData</span></span>
<span id="cb109-385"><a href="#cb109-385" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(<span class="at">x =</span> pbmc, <span class="at">idents =</span> <span class="st">"B cell"</span>)</span>
<span id="cb109-386"><a href="#cb109-386" aria-hidden="true" tabindex="-1"></a><span class="co"># 反选</span></span>
<span id="cb109-387"><a href="#cb109-387" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(<span class="at">x =</span> pbmc, <span class="at">idents =</span> <span class="fu">c</span>(<span class="st">"CD4 Naive T"</span>, <span class="st">"CD8 T"</span>), <span class="at">invert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-388"><a href="#cb109-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-389"><a href="#cb109-389" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据特定gene/feature表达水平取子集</span></span>
<span id="cb109-390"><a href="#cb109-390" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(<span class="at">x =</span> pbmc, <span class="at">subset =</span> S100A9 <span class="sc">&gt;</span> <span class="fl">1.5</span>)</span>
<span id="cb109-391"><a href="#cb109-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-392"><a href="#cb109-392" aria-hidden="true" tabindex="-1"></a><span class="co"># 采用多个标准取子集</span></span>
<span id="cb109-393"><a href="#cb109-393" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(<span class="at">x =</span> pbmc, <span class="at">subset =</span> S100A9 <span class="sc">&gt;</span> <span class="fl">1.5</span> <span class="sc">&amp;</span> PC_1 <span class="sc">&gt;</span> <span class="dv">5</span>)</span>
<span id="cb109-394"><a href="#cb109-394" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(<span class="at">x =</span> pbmc, <span class="at">subset =</span> S100A9 <span class="sc">&gt;</span> <span class="fl">1.5</span>, <span class="at">idents =</span> <span class="st">"CD8 T"</span>)</span>
<span id="cb109-395"><a href="#cb109-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-396"><a href="#cb109-396" aria-hidden="true" tabindex="-1"></a><span class="co"># Downsample the number of cells per identity class</span></span>
<span id="cb109-397"><a href="#cb109-397" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(<span class="at">x =</span> pbmc, <span class="at">downsample =</span> <span class="dv">100</span>)</span>
<span id="cb109-398"><a href="#cb109-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-399"><a href="#cb109-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-400"><a href="#cb109-400" aria-hidden="true" tabindex="-1"></a><span class="fu">### 分割layers</span></span>
<span id="cb109-401"><a href="#cb109-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-402"><a href="#cb109-402" aria-hidden="true" tabindex="-1"></a>In Seurat v5, users can now split in object directly into different layers keeps expression data in one object, but splits multiple samples into layers can proceed directly to integration workflow after splitting layers。实际应用场景见<span class="co">[</span><span class="ot">数据整合</span><span class="co">](/single_cell/seurat/integration.qmd)</span>。</span>
<span id="cb109-403"><a href="#cb109-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-406"><a href="#cb109-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-407"><a href="#cb109-407" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(pbmc) <span class="ot">&lt;-</span> <span class="st">"RNA"</span></span>
<span id="cb109-408"><a href="#cb109-408" aria-hidden="true" tabindex="-1"></a><span class="co"># 按照meta.data中的stim列分割layer</span></span>
<span id="cb109-409"><a href="#cb109-409" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"RNA"</span>]] <span class="ot">&lt;-</span> <span class="fu">split</span>(pbmc[[<span class="st">"RNA"</span>]], <span class="at">f =</span> pbmc<span class="sc">$</span>groups)</span>
<span id="cb109-410"><a href="#cb109-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-411"><a href="#cb109-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-412"><a href="#cb109-412" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-01-15%2018.36.23.png)</span></span>
<span id="cb109-413"><a href="#cb109-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-414"><a href="#cb109-414" aria-hidden="true" tabindex="-1"></a>如果需要，例如在整合之后，可以将各layers再次合并在一起：</span>
<span id="cb109-415"><a href="#cb109-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-418"><a href="#cb109-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-419"><a href="#cb109-419" aria-hidden="true" tabindex="-1"></a>pbmc[[<span class="st">"RNA"</span>]] <span class="ot">&lt;-</span> <span class="fu">JoinLayers</span>(pbmc[[<span class="st">"RNA"</span>]])</span>
<span id="cb109-420"><a href="#cb109-420" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-421"><a href="#cb109-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-422"><a href="#cb109-422" aria-hidden="true" tabindex="-1"></a><span class="fu">### 分割Seurat</span></span>
<span id="cb109-423"><a href="#cb109-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-424"><a href="#cb109-424" aria-hidden="true" tabindex="-1"></a>In line with prior workflows, you can also split your Seurat object into a **list** of multiple objects based on a metadata column creates a list of two objects。通过<span class="in">`SplitObject()`</span>分割Seurat之后生成的是包含多个Seurat对象的列表。</span>
<span id="cb109-425"><a href="#cb109-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-428"><a href="#cb109-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-429"><a href="#cb109-429" aria-hidden="true" tabindex="-1"></a>seurat_list <span class="ot">&lt;-</span> <span class="fu">SplitObject</span>(pbmc, <span class="at">split.by =</span> <span class="st">"groups"</span>)</span>
<span id="cb109-430"><a href="#cb109-430" aria-hidden="true" tabindex="-1"></a>seurat_list</span>
<span id="cb109-431"><a href="#cb109-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-432"><a href="#cb109-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-433"><a href="#cb109-433" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-01-15%2018.42.35.png)</span></span>
<span id="cb109-434"><a href="#cb109-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-435"><a href="#cb109-435" aria-hidden="true" tabindex="-1"></a><span class="fu">### Merge objects (without integration)</span></span>
<span id="cb109-436"><a href="#cb109-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-437"><a href="#cb109-437" aria-hidden="true" tabindex="-1"></a>In Seurat v5, merging creates a single object, but **keeps the expression information split into different layers** for integration. If not proceeding with integration, rejoin the layers after merging. 实际应用场景，见<span class="co">[</span><span class="ot">后续章节</span><span class="co">](/single_cell/sc_supplementary/read_sc_data.qmd)</span>。</span>
<span id="cb109-438"><a href="#cb109-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-441"><a href="#cb109-441" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-442"><a href="#cb109-442" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge two Seurat objects</span></span>
<span id="cb109-443"><a href="#cb109-443" aria-hidden="true" tabindex="-1"></a>merged_pbmc <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x =</span> seurat_list[[<span class="st">"Control"</span>]], </span>
<span id="cb109-444"><a href="#cb109-444" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> seurat_list[[<span class="st">"Cancer"</span>]])</span>
<span id="cb109-445"><a href="#cb109-445" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-446"><a href="#cb109-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-447"><a href="#cb109-447" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/截屏2024-01-15%2018.19.15.png)</span></span>
<span id="cb109-448"><a href="#cb109-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-451"><a href="#cb109-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-452"><a href="#cb109-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb109-453"><a href="#cb109-453" aria-hidden="true" tabindex="-1"></a><span class="co"># Example to merge more than two Seurat objects</span></span>
<span id="cb109-454"><a href="#cb109-454" aria-hidden="true" tabindex="-1"></a><span class="fu">merge</span>(<span class="at">x =</span> pbmc1, </span>
<span id="cb109-455"><a href="#cb109-455" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">list</span>(pbmc2, pbmc3))</span>
<span id="cb109-456"><a href="#cb109-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-457"><a href="#cb109-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-458"><a href="#cb109-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Merge objects (with integration)</span></span>
<span id="cb109-459"><a href="#cb109-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-460"><a href="#cb109-460" aria-hidden="true" tabindex="-1"></a>关于单细胞数据的整合，参考<span class="co">[</span><span class="ot">后续章节</span><span class="co">](/single_cell/seurat/integration.qmd)</span>。</span>
<span id="cb109-461"><a href="#cb109-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-464"><a href="#cb109-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-465"><a href="#cb109-465" aria-hidden="true" tabindex="-1"></a>merged_pbmc <span class="ot">&lt;-</span> <span class="fu">NormalizeData</span>(merged_pbmc, <span class="at">verbose =</span> F)</span>
<span id="cb109-466"><a href="#cb109-466" aria-hidden="true" tabindex="-1"></a>merged_pbmc <span class="ot">&lt;-</span> <span class="fu">FindVariableFeatures</span>(merged_pbmc, <span class="at">verbose =</span> F)</span>
<span id="cb109-467"><a href="#cb109-467" aria-hidden="true" tabindex="-1"></a>merged_pbmc <span class="ot">&lt;-</span> <span class="fu">ScaleData</span>(merged_pbmc, <span class="at">verbose =</span> F)</span>
<span id="cb109-468"><a href="#cb109-468" aria-hidden="true" tabindex="-1"></a>merged_pbmc <span class="ot">&lt;-</span> <span class="fu">RunPCA</span>(merged_pbmc, <span class="at">verbose =</span> F)</span>
<span id="cb109-469"><a href="#cb109-469" aria-hidden="true" tabindex="-1"></a>merged_pbmc <span class="ot">&lt;-</span> <span class="fu">IntegrateLayers</span>(<span class="at">object =</span> merged_pbmc, </span>
<span id="cb109-470"><a href="#cb109-470" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method =</span> RPCAIntegration, </span>
<span id="cb109-471"><a href="#cb109-471" aria-hidden="true" tabindex="-1"></a>                               <span class="at">orig.reduction =</span> <span class="st">"pca"</span>, </span>
<span id="cb109-472"><a href="#cb109-472" aria-hidden="true" tabindex="-1"></a>                               <span class="at">new.reduction =</span> <span class="st">"integrated.rpca"</span>,</span>
<span id="cb109-473"><a href="#cb109-473" aria-hidden="true" tabindex="-1"></a>                               <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb109-474"><a href="#cb109-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-475"><a href="#cb109-475" aria-hidden="true" tabindex="-1"></a><span class="co"># now that integration is complete, rejoin layers</span></span>
<span id="cb109-476"><a href="#cb109-476" aria-hidden="true" tabindex="-1"></a>merged_pbmc[[<span class="st">"RNA"</span>]] <span class="ot">&lt;-</span> <span class="fu">JoinLayers</span>(merged_pbmc[[<span class="st">"RNA"</span>]])</span>
<span id="cb109-477"><a href="#cb109-477" aria-hidden="true" tabindex="-1"></a>merged_pbmc</span>
<span id="cb109-478"><a href="#cb109-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-479"><a href="#cb109-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-480"><a href="#cb109-480" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb109-481"><a href="#cb109-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-482"><a href="#cb109-482" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb109-483"><a href="#cb109-483" aria-hidden="true" tabindex="-1"></a><span class="fu">###### Additional resources</span></span>
<span id="cb109-484"><a href="#cb109-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-485"><a href="#cb109-485" aria-hidden="true" tabindex="-1"></a>Users who are particularly interested in some of the technical changes to data storage in Seurat v5 can explore the following resources:</span>
<span id="cb109-486"><a href="#cb109-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-487"><a href="#cb109-487" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">SeuratObject manual</span><span class="co">](https://mojaveazure.github.io/seurat-object/)</span></span>
<span id="cb109-488"><a href="#cb109-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-489"><a href="#cb109-489" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Seurat v5 and Assay5 introductory vignette</span><span class="co">](https://satijalab.org/seurat/articles/seurat5_essential_commands)</span></span>
<span id="cb109-490"><a href="#cb109-490" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb109-491"><a href="#cb109-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-492"><a href="#cb109-492" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb109-493"><a href="#cb109-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-494"><a href="#cb109-494" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true" icon="false"}</span>
<span id="cb109-495"><a href="#cb109-495" aria-hidden="true" tabindex="-1"></a><span class="fu">## Session Info</span></span>
<span id="cb109-496"><a href="#cb109-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-499"><a href="#cb109-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb109-500"><a href="#cb109-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb109-501"><a href="#cb109-501" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb109-502"><a href="#cb109-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb109-503"><a href="#cb109-503" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
 This website was built with Quarto
  </li>  
</ul>
</div>   
    <div class="nav-footer-center">Copyright 2024, Du Junhong</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/djhcod">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>